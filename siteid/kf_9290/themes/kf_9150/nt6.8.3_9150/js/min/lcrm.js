!function(a,b){var c=function(){},d="javascript:void();",e='filter:alpha(opacity=0);-moz-opacity:0;-webkit-opacity:0;-khtml-opacity:0;opacity:0;-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";',f="box-shadow:0 3px 2px 0 #aaa;-moz-box-shadow:0 3px 2px 0 #aaa;-webkit-box-shadow:0 3px 2px 0 #aaa;",g={action:1,trigger:0,token:"",showmode:1,location:"center-center",sizex:50,sizey:50,tempmode:0,tempcontent:"",bgcontent:"",effect:"",saletype:"",salemode:"",price:"",pricebegin:"",priceend:"",begintime:"",endtime:"",desc:"",sms:"",jumpurl:"",kfconfigcode:""},h={symbol:"￥",unit:"元",type:"现金券",mode:"满减券",valid:"下载后{$valid}有效",desctitle:"使用说明：",fullcut:"满{$begin}元减{$end}元",download:"下载",sms:{title:"免费短信下载",desc:"短信下载免费，我们会严格保密您手机号"},mail:{title:"发送至邮箱",desc:"优惠券会以邮件形式发送到您邮箱"},save:{title:"保存至本地电脑",desc:"优惠券会以文本文档格式另存到您本地电脑"},title:"亲，恭喜您获得优惠券哦！",smstitle:"免费短信下载优惠券",smslabel:"输入手机号码：",smserror:"手机号码有误，请重新输入！",smsbtntext:"免费短信下载",smsdesc:"优惠券码已发出，请注意查收短信！如果没有收到，您可以在{$time}之后要求系统重新发送",tempttitle:"您将收到以下短信：",temptdesc:"在提交订单时输入短信中的优惠券卡密，即可享受优惠",mailtitle:"邮箱下载优惠券",maillabel:"请输入邮箱地址：",mailerror:"邮箱地址有误，请重新输入！",mailbtntext:"提　　交",maildesc:"优惠券码已发出，[link href={$url}]去邮箱查收邮件[/link]，如果没有收到，您可以在{$time}之后要求系统重新发送",errormessage:"系统忙，发送失败",closelink:"[link href={$url}]已收到优惠券码，返回商城消费[/link]",resend:"重新发送",sended:"已发送",day:"{$time}天",hour:"{$time}小时",minute:"{$time}分钟",time:"{$time}秒"},i={"163.com":"mail.163.com","vip.163.com":"vip.163.com","126.com":"mail.126.com","qq.com":"mail.qq.com","vip.qq.com":"mail.qq.com","foxmail.com":"mail.qq.com","gmail.com":"mail.google.com","sohu.com":"mail.sohu.com","vip.sina.com":"vip.sina.com","sina.com.cn":"mail.sina.com.cn","sina.com":"mail.sina.com.cn","tom.com":"mail.tom.com","yahoo.com.cn":"mail.cn.yahoo.com","yahoo.cn":"mail.cn.yahoo.com","yeah.net":"www.yeah.net","21cn.com":"mail.21cn.com","hotmail.com":"www.hotmail.com","sogou.com":"mail.sogou.com","188.com":"www.188.com","139.com":"mail.10086.cn","189.cn":"webmail15.189.cn/webmail","wo.com.cn":"mail.wo.com.cn/smsmail","ntalker.com":"cnc.exmail.qq.com/login"},j=a.sourceURI+"/images/livecrm.png",k=a.sourceURI+"/images/coupons0.jpg",l=a.sourceURI+"/images/coupons1.jpg";a.require([j,k,l]),a.lcrm={params:null,hasComplete:new a.HASH,start:function(b,c,d,e){if(a.browser.mobile)return void a.Log("mobile don't support lcrm");var f=a.im.connect.currentPage.get();if(this.params=a.extend(g,b),1!==this.params.action||c||d||this.statistic(11),1==this.params.trigger&&!a.browser.mobile||!f)a.Log("$.lcrm.start(): save cache"),a.flashData.add(a.CON_LCRM_FIX+this.params.token,this.params);else{if(a.Log("$.lcrm.start(): execute"),this.params.trigger=0,this.hasComplete.contains(this.params.token))return;this.hasComplete.add(this.params.token,a.extend(this.params,{example:new a.liveCRM(this.params)}))}},statistic:function(b){var c=a.server.crmcenter+"rtmarket.php?",d=a.extend({},this.params);delete d.example,c+=a.toURI({m:"CouponLog",a:"log",siteid:a.global.siteid,uid:a.user.id,pcid:a.global.pcid,token:this.params.token,action:b||11,content:a.JSON.toJSONString(d)}),a.require(c+"#rnd")}},a.Dialog=a.Class.create(),a.liveCRM=a.Class.create(),a.Dialog.prototype={key:null,element:null,options:null,offset:null,initialize:function(b){this.offset=a.extend(a(window).offset(),{width:a(window).width(),height:a(window).height()}),this.options=a.extend({key:a.randomChar(),width:720,height:364,location:"center",zIndex:1000110,mask:1,effect:"fadein",title:null,buttons:1,fnClick:c,fnClose:c,fnOk:c,fnShow:c,fnHide:c,bind:c,html:""},b),this.create()},create:function(){var b,c,d,g,h,i,k,l=this;switch(a.Log("$.Dialog.create()"),a.browser.msie6?this.position="absolute":this.position="fixed",this.options.location){case"top-banner":break;case"bottom-banner":break;case"right-bottom":break;default:"fixed"===this.position?(this.options.left=Math.max(0,(this.offset.width-this.options.width)/2),this.options.top=Math.max(0,(this.offset.height-this.options.height)/2)):(this.options.left=Math.max(0,this.offset.left+(this.offset.width-this.options.width)/2),this.options.top=Math.max(0,this.offset.top+(this.offset.height-this.options.height)/2))}return c=[a.STYLE_BODY,f,"width:",this.options.width,"px;height:",this.options.height,"px;position:",this.position,";left:",this.options.left,"px;top:",this.options.top,"px;z-index:",+this.options.zIndex+1,";background:#FFFFFF;display:block;visibility:hidden;"].join(""),b=[a.STYLE_BODY,e,"width:100%;height:",this.offset.height,"px;","position:",this.position,";","left:0px;top:0px;z-index:",this.options.zIndex,";background:#000000;display:block;visibility:hidden;"].join(""),d=[a.STYLE_BODY,"background:#900;color:#fff;font:normal 14px/30px Arial,SimSun;"].join(""),g=[a.STYLE_BODY,"background:#fff;color:#333;width:100%;"].join(""),h=[a.STYLE_NBODY,"cursor:pointer;width:20px;height:20px;position:absolute;left:",this.options.width-25,"px;top:4px;background:url("+j+") no-repeat 0 0;",this.options.closeCss].join(""),i=[a.STYLE_NBODY,"cursor:pointer;width:120px;height:30px;margin:5px auto;",this.options.okCss].join(""),k=[null===this.options.title?"":'<div class="dialog-title" style="'+d+'"><span style="'+d+'margin:0 0 0 10px;">'+this.options.title+"</span></div>",'<div class="dialog-body" style="'+a.STYLE_BODY+'text-align:center;">'+this.options.html+"</div>",'<div class="dialog-button-close" style="'+h+'"></div>','<div class="dialog-button-ok" style="'+i+'"></div>'].join(""),this.options.mask&&(this.background=a({className:"dialog-background-"+this.options.key,style:b}).appendTo(!0).fixed(),this.iframe=a({tag:"IFRAME",className:"dialog-iframe-"+this.options.key,style:b}).appendTo(!0).fixed()),this.element=a({className:"dialog-container-"+this.options.key,style:c}).html(k).appendTo(!0).fixed().bind("click",function(){l.options.fnClick.call(l)}),/^[1|3]$/i.test(this.options.buttons)?a(".dialog-button-close",this.element).bind("click",function(b){a.Event.fixEvent(b).stopPropagation(),l.options.fnClose.call(l),l.hide()}):a(".dialog-button-close",this.element).display(),/^[2|3]$/i.test(this.options.buttons)?a(".dialog-button-ok",this.element).bind("click",function(b){a.Event.fixEvent(b).stopPropagation(),l.options.fnOk.call(l),l.hide()}):a(".dialog-button-ok",this.element).display(),a.Log("key: "+this.options.key+", top:"+this.options.top),this.options.bind.call(this,this.element,this.options),this.element},show:function(){var b=this;switch(a.Log("$.Dialog.show()"),this.background&&this.background.animate({visibility:"visible",opacity:{form:0,to:.6}}),this._funcSize=function(a){b.resizeCenter(a)},this.options.effect){case"fadein":this.element.animate({visibility:"visible",opacity:{form:0,to:1}},500,function(){b.options.fnShow.call(b),a.Event.addEvent(window,"resize",b._funcSize)});break;case"flyin":this.element.animate({visibility:"visible",to:{from:this.offset.top+this.offset.height+"px",to:this.options.top+"px"}},500,function(){b.options.fnShow.call(b),a.Event.addEvent(window,"resize",b._funcSize)});break;default:this.element.css({visibility:"visible"}),this.options.fnShow.call(this),a.Event.addEvent(window,"resize",b._funcSize)}return this.element},hide:function(){var b=this;switch(a.Log("$.Dialog.hide()"),this.background&&this.background.hide(function(){b.background.remove(),b.iframe.remove()}),this.options.effect){case"fadein":this.element.animate({opacity:{to:0}},500,function(){b.element.remove(),b.options.fnHide.call(b)});break;case"flyin":this.element.anim({top:{to:this.offset.viewY+this.offset.viewH+"px"}},500,function(){b.element.remove(),b.options.fnHide.call(b)});break;default:this.element.remove(),this.options.fnHide.call(this)}a.Event.removeEvent(window,"resize",this._funcSize)},resizeCenter:function(b){var c,d,e=a(window).offset();a.Log("$.Dialog.resizeCenter()"),"fixed"===this.position?(c=0,d=0):(c=e.left,d=e.top),this.options.mask&&(this.background.css({left:c+"px",top:d+"px",width:"100%",height:a(window).height()+"px"}),this.iframe.css({left:c+"px",top:d+"px",width:"100%",height:a(window).height()+"px"})),this.element.css({right:"auto",bottom:"auto",left:c+(a(window).width()-this.options.width)/2+"px",top:d+(a(window).height()-this.options.height)/2+"px"})}},a.liveCRM.prototype={id:"",element:null,background:null,iframe:null,offset:null,config:null,options:null,width:0,height:0,location:{},key:"",defRequest:null,timeID:null,diagDownCoupon:null,livecrm:null,baseURL:"",initialize:function(b){var c;this.key=a.randomChar(),this.id="lcrm-"+this.key,this.options=a.extend(this.options,g,b),this.baseURL=a.server.crmcenter+"rtmarket.php?",this.offset=a.extend(a(window).offset(),{width:a(window).width(),height:a(window).height()});var d=a.extend({},this.options);if(d.example&&delete d.example,a.Log("$.liveCRM.initialize()",1),""===this.options.token)return void a.Log("Active liveCRM is not configured. token:"+this.options.token,3);switch(this.defRequest={m:"Index",a:"Coupon",s:a.global.siteid,uid:a.user.id,t:"",pid:a.global.pcid,token:this.options.token},this.options.width=Math.min(a(window).width(),this.options.sizex),this.options.height=Math.min(a(window).height(),this.options.sizey),this.width=a(window).width(),this.height=a(window).height(),c=a.browser.msie6||a.browser.msie&&a.browser.Quirks?"absolute":"fixed",this.options.location){case"top-banner":this.location={position:"static",x:"left",y:"top",left:0,top:0},this.options.effect="heighten";break;case"bottom-banner":this.location={position:c,x:"left",y:"bottom",left:0,bottom:0};break;case"left-center":this.location={position:c,x:"left",y:"bottom",left:0,bottom:(this.height-this.options.height)/2};break;case"right-center":this.location={position:c,x:"left",y:"bottom",left:Math.max(0,this.offset.width-this.options.width),bottom:(this.height-this.options.height)/2};break;case"left-bottom":this.location={position:c,x:"left",y:"bottom",left:0,bottom:0};break;case"center-bottom":this.location={position:c,x:"left",y:"bottom",left:(this.width-this.options.width)/2,bottom:0};break;case"right-bottom":this.location={position:c,x:"left",y:"bottom",left:Math.max(0,this.offset.width-this.options.width),bottom:0};break;default:this.location={position:c,x:"left",y:"bottom",left:(this.width-this.options.width)/2,bottom:(this.height-this.options.height)/2}}a.isDefined(this.location.right)||(this.location.right=this.width-this.location.left-this.options.width),a.isDefined(this.location.bottom)||(this.location.bottom=this.height-this.location.top-this.options.height),a.isDefined(this.location.top)||(this.location.top=this.height-this.location.bottom-this.options.height-2),"absolute"===c&&(this.options.location.indexOf("right")>-1&&(this.location.left-=2),this.location.y="top"),this.create(),this.inputs=[]},statistic:function(b){a.Log("$.liveCRM.statistic(atype:"+b+")"),a.require(this.baseURL+a.toURI(a.extend({},this.defRequest,{t:b}))+"#rnd",function(b){b.error&&a.Log("Statistics call fails",3)})},create:function(){var b,c,d,f=this;return a.Log("$.liveCRM.create()"),c=[a.STYLE_BODY,"margin:0 auto;cursor:pointer;width:"+this.options.width+"px;","height:"+this.options.height+"px;"].join(""),b='<div class="lcrm-body" token="'+this.options.token+'" style="'+a.STYLE_BODY+'overflow:hidden;">',0!==this.options.tempmode?void a.Log("tempmode:"+this.options.tempmode,2):(b+='<img src="'+this.options.tempcontent+'" width="'+this.options.width+'" height="'+this.options.height+'" border="0" />',b+='</div><div class="lcrm-close" style="'+a.STYLE_BODY+";background:url("+j+') no-repeat 0 -330px; width:28px;height:28px;position:absolute;right:5px;top:5px;"></div>',0===this.options.showmode?(d=[a.STYLE_BODY,"width:100%;height:","top-banner"==this.options.location?1:this.options.height,"px;z-Index:1000100;visibility:hidden;text-align:center;position:"+this.location.position+";left:none;top:none;overflow:hidden;",/^#([0-9A-F]){6}/gi.test(this.options.bgcontent)?"background:"+this.options.bgcontent+";":/^https?:\/\/(.*?)/gi.test(this.options.bgcontent)?"background:url("+this.options.bgcontent+") repeat scroll 0 0;":""].join(""),this.background=a({className:this.id+"-background",style:d}).appendTo(!0),this.element=a({className:this.id+"-container",id:this.id,style:c}).appendTo(this.background).html(b)):"right-bottom"==this.options.location?(c+=["position:"+this.location.position+";visibility:visible;",this.location.x+":"+this.location[this.location.x]+"px;",this.location.y+":"+this.location[this.location.y]+"px;"].join(""),this.element=a({className:this.id+"-container-"+this.key,id:this.id,style:c+"z-Index:1000101;"}).appendTo(!0).html(b)):(d=[a.STYLE_BODY,e,"width:100%;height:"+this.offset.height+"px;visibility:visible;position:",this.location.position,";left:0;top:","fixed"==this.location.position?0:this.offset.top,"px;z-index:1000100;display:block;",/^#([0-9A-F]){6}/gi.test(this.options.bgcontent)?"background:"+this.options.bgcontent+";":/^https?:\/\/(.*?)/gi.test(this.options.bgcontent)?"background:url("+this.options.bgcontent+") repeat scroll 0 0;":""].join(""),c+=["position:"+this.location.position+";visibility:visible;",this.location.x+":"+this.location[this.location.x]+"px;",this.location.y+":"+this.location[this.location.y]+"px;"].join(""),this.background=a({className:this.id+"-background",style:d}).appendTo(!0),this.iframe=a({className:this.id+"-iframe",style:d,tag:"IFRAME"}).appendTo(!0),this.element=a({className:this.id+"-container",id:this.id,style:c+"z-Index:1000101;"}).appendTo(!0).html(b)),this.background&&this.background.bind("contextmenu",function(){return!1}).bind("selectstart",function(){return!1}),this.element.bind("click",function(a){f.actionEvent(a)}),this.element.find(".lcrm-close").bind("click",function(b){a.Event.fixEvent(b).stopPropagation(),f.close()}),this.show(function(){"top-banner"==f.options.location||"bottom-banner"==f.options.location&&"fixed"==this.location.position||(1===f.options.showmode&&"right-bottom"!=f.options.location&&f.element.fixed(),f.background&&f.background.fixed(),a.Event.addEvent(window,"resize",function(a){f.resizeCenter(a)}))}),!0)},resizeCenter:function(b){var c,d,e=a(window).offset(),f=a(window).width(),g=a(window).height();switch(a.Log("nTalk.liveCRM.resizeCenter()"),"fixed"==this.location.position?(c=0,d=0):(c=e.left,d=e.top),this.background&&this.background.length&&this.background.css({left:c+"px",top:d+"px",width:"100%",height:g+"px"}),this.iframe&&this.iframe.length&&this.iframe.css({left:c+"px",top:d+"px",width:"100%",height:g+"px"}),this.options.location){case"left-center":this.location[this.location.x]=c,this.location[this.location.y]=d+(g-this.options.height)/2;break;case"right-center":this.location[this.location.x]=c+(f-this.options.width),this.location[this.location.y]=d+(g-this.options.height)/2;break;case"left-bottom":this.location[this.location.x]=c,this.location[this.location.y]=d;break;case"center-bottom":this.location[this.location.x]=c+(f-this.options.width)/2,this.location[this.location.y]=d;break;case"right-bottom":this.location[this.location.x]=c+(f-this.options.width),this.location[this.location.y]=d;break;default:this.location[this.location.x]=c+(f-this.options.width)/2,this.location[this.location.y]=d+(g-this.options.height)/2}var h={left:"auto",top:"auto",right:"auto",bottom:"auto"};h[this.location.x]=Math.max(0,this.location[this.location.x])+"px",h[this.location.y]=Math.max(0,this.location[this.location.y])+"px",this.element.css(h)},show:function(b){var c,d=this,e={visibility:"visible"};if(a.Log("$.liveCRM.show()"),0===this.options.showmode?c=this.background:(c=this.element,this.background&&this.background.css({opacity:.6})),c){switch(this.options.effect){case"flyin":e[this.location.y]={from:("top"==this.location.y?this.offset.top+this.offset.height:0-this.options.height)+"px",to:("top"==this.location.y?this.offset.top+this.location.top:this.location[this.location.y])+"px"},c.animate(e,500,function(){b.call(d)});break;case"heighten":a(window).scrollTop(0),e.height={from:"1px",to:this.options.height+"px"},c.animate(e,500,function(){b.call(d)});break;default:e[this.location.y]=this.location[this.location.y]+"px",c.css(e),b.call(this)}this.statistic(20),"undefined"!=typeof ntcall_onShowInvitation&&ntcall_onShowInvitation(0,this.param.token),a.promptwindow.startPrompt("",h.title,!0)}},close:function(b){var c,d=this,e={};if(a.Log("$.liveCRM.close()"),0===this.options.showmode?c=this.background:(c=this.element,this.background&&this.background.animate({opacity:this.options.effect?{from:.6,to:0}:0},500,function(){d.background.remove(),d.iframe.remove()})),c)switch(this.options.effect){case"flyin":this.offset=a.extend(this.offset,a(window).offset()),e[this.location.y]={from:("top"==this.location.y?this.offset.top+this.location.top:0)+"px",to:("top"==this.location.y?this.offset.top+this.offset.height:0-this.options.height)+"px"},c.animate(e,600,function(){a(this).remove(),b&&b.call(d)});break;case"heighten":c.animate({height:{to:"1px"}},500,function(c){a(this).remove(),b&&b.call(d)});break;default:c.remove(),b&&b.call(d)}},actionEvent:function(){var b,d,e,g=this,i={mask:1,buttons:1,title:h.title,fnClose:c,fnOk:c,html:"",closeCss:"background:url("+j+") no-repeat 0px -298px;",bind:function(b){a(".market-fright-buttons .button",b).hover(function(b){a(this).css({"background-color":"#FFF2F2","border-color":"#A11D1B"})},function(b){a(this).css({"background-color":"#FFFFFF","border-color":"#959595"})}).bind("click",function(b){a.promptwindow.stopPrompt(),g.showDown(this.className)})}};b=this.options.ltdtime>0,d=[a.STYLE_BODY,f,"margin:10px 38px 15px 15px;padding:0;width:320px;height:74px;border:1px solid #959595;border-radius:5px;cursor:pointer;"].join(""),e=b?a.browser.oldmsie?"background:#000;filter:alpha(opacity=80)":"background:rgba(0,0,0,0.6);":"background:transparent;",i.html=['<div class="market-fleft-content" style="'+a.STYLE_BODY+'width:345px;height:auto;float:left;background:none;">','<div class="market-fleft-icon" style="'+a.STYLE_BODY+"width:250px;height:130px;margin:25px 40px 25px 55px;background:#B20000 url("+a.sourceURI+"/images/coupons"+this.options.salemode+'.jpg) -2px 0 no-repeat;">','<div class="markt-site" style="'+a.STYLE_BODY+'position:relative;height:30px;overflow:hidden;background:url() no-repeat;color:#000;border:0px dotted #fff;">',"</div>",'<div class="markt-price" style="'+a.STYLE_BODY+'margin:0 8px;position:relative;height:54px;overflow:hidden;background:none;text-align:center;border-left:0px dotted #fff;border-right:0px dotted #fff;">','<span style="'+a.STYLE_BODY+'background:none;color:#fff;font:bold 2em/140% Arial,SimSun;">'+h.symbol+"</span>",'<span style="'+a.STYLE_BODY+'background:none;color:#fff;font:bold 4em/140% Arial,SimSun;">',1==this.options.salemode?this.options.priceend:this.options.price,"</span>",'<span style="'+a.STYLE_BODY+'background:none;color:#fff;font:bold 2em/140% Arial,SimSun;">'+h.unit+"</span>",'<span style="'+a.STYLE_BODY+'background:none;color:#fff;font:bold 2em/140% Arial,SimSun;">'+(1===this.options.salemode?h.mode:h.type)+"</span>","</div>",'<div class="markt-fullcut" style="'+a.STYLE_BODY+'font-size:14px;font-weight:bold;margin:0 8px;position:relative;background:none;height:20px;text-align:right;color:#fff;padding:0 20px 0 0;border-left:0px dotted #fff;border-right:0px dotted #fff;">',1===this.options.salemode?a.utils.handleLinks(h.fullcut,{begin:this.options.pricebegin,end:this.options.priceend}):"","</div>",'<div class="markt-valid-date" style="margin:0;padding:0;border:none;font:normal 12px/160% Microsoft YaHei,Arial,SimSun;position:relative;height:26px;line-height:26px;padding:0 5px 0 0;color:#fff;text-align:right;border:0px dotted #fff;border-top:none;'+e+'">',b?a.utils.handleLinks(h.valid,{valid:this.formatValid(this.options.ltdtime)}):"","</div>","</div>",'<div class="market-fleft-title" style="'+a.STYLE_BODY+"padding:0 0 0 70px;font:bold 16px/160% Arial,SimSun;color:#666;background:url("+j+') no-repeat 52px -44px;">'+h.desctitle+"</div>",'<div class="market-fleft-desc"  style="'+a.STYLE_BODY+'margin:0 0 0 55px;color:#666;height:116px;overflow:hidden;word-break:break-all;word-wrap:break-word;">'+this.options.desc+"</div>","</div>",'<div class="market-fright-buttons" style="'+a.STYLE_BODY+'padding:40px 0 10px 0;width:375px;height:auto;float:right;background:none;">','<div class="button market-buttons-sms" style="'+d+"background:#fff url("+j+') no-repeat  18px -128px;">','<div style="'+a.STYLE_BODY+'margin:10px 0 0 74px;background:none;font:bold 16px/160% Arial,SimSun;">'+h.sms.title+"</div>",'<div style="'+a.STYLE_BODY+'margin:5px 0 0 74px;background:none;color:#999;height:20px;">'+h.sms.desc+"</div>","</div>",'<div class="button market-buttons-mail" style="'+d+"background:#fff url("+j+') no-repeat  18px -68px;">','<div style="'+a.STYLE_BODY+'margin:10px 0 0 74px;background:none;font:bold 16px/160% Arial,SimSun;">'+h.mail.title+"</div>",'<div style="'+a.STYLE_BODY+'margin:5px 0 0 74px;background:none;color:#999;height:20px;">'+h.mail.desc+"</div>","</div>",'<div class="button market-buttons-save" style="'+d+"background:#fff url("+j+') no-repeat  18px -210px;">','<div style="'+a.STYLE_BODY+'margin:10px 0 0 74px;background:none;font:bold 16px/160% Arial,SimSun;">'+h.save.title+"</div>",'<div style="'+a.STYLE_BODY+'margin:5px 0 0 74px;background:none;color:#999;height:20px;">'+h.save.desc+"</div>","</div>","</div>"].join(""),this.close.call(this,function(){switch(g.options.saletype){case 0:this.statistic(36);try{g.dialog=new a.Dialog(i),g.dialog.show()}catch(b){a.Log(b,3)}break;case 1:g.statistic(34),g.options.jumpurl?window.open(g.options.jumpurl):a.Log("jumpurl is null",3);break;default:a.global.chattype=9,g.statistic(33),a.im_openInPageChat(g.options.kfconfigcode,"","",{single:-1,manual:1})}})},disabled:function(b,c,d){var e;return this.inputs[b]||(this.inputs[b]=[]),this.inputs[b]["dialog-body-submit"]||(this.inputs[b]["dialog-body-submit"]={status:!1,_default:{cursor:"pointer","background-color":"#B20000","background-position":"5px 40px","border-bottom-color":"#3C0000","padding-left":"20px"},disable:{cursor:"auto","background-color":"#ADADAD","background-position":"5px 10px","border-bottom-color":"#909090","padding-left":"30px"}}),this.inputs[b]["dialog-body-input"]||(this.inputs[b]["dialog-body-input"]={status:!1,_default:{color:"#000","background-color":"#fff"},disable:{color:"#999","background-color":"#fafafa"}}),e=this.inputs[b][c],e.status=d,a("."+c,this.diagDownCoupon.element).css(e.status?e.disable:e._default).attr("disabled",e.status?"disabled":""),e.status},showDown:function(b){var e,g,i,k,l,m,n,o,p,q=this,r=b.indexOf("market-buttons-sms")>-1?"SMS":b.indexOf("market-buttons-mail")>-1?"MAIL":"",s={mask:0,buttons:1,zIndex:1000120,fnClose:c,fnOk:c,html:""};return n=[a.STYLE_BODY,f,"width:625px;height:80px;background:#FFF2F2;margin:45px auto 0;padding:10px;"].join(""),o=[a.STYLE_BODY,"margin:20px 0 0;"].join(""),p=[a.STYLE_BODY].join(""),r?(k="SMS"==r?h.smstitle:h.mailtitle,i="SMS"==r?h.smslabel:h.maillabel,l="SMS"==r?h.smsdesc:h.maildesc,m="SMS"==r?h.smsbtntext:h.mailbtntext,g="SMS"==r&&this.options.sms?['<div class="dialog-body-desc" style="'+n+'">','<div style="'+a.STYLE_BODY+'background:none;">','<span style="'+a.STYLE_BODY+'background:none;font:1.6em/160% Arial,SimSun;">'+h.tempttitle+"</span>",'<span style="'+a.STYLE_BODY+'background:none;font:1em/160% Arial,SimSun;">('+h.temptdesc+")</span>","</div>",'<div style="'+a.STYLE_BODY+'display:block;width:100%;background:#FBDDDD;font:1.2em/160% Arial,SimSun;word-break:break-all;word-wrap:break-word;">',this.options.sms,"</div>","</div>"].join(""):"","SMS"===r&&this.options.sms||(o+="margin:100px 0 0;"),e=[g,'<div class="dialog-body-inputarea" style="'+o+'">','<div style="'+a.STYLE_BODY+'float:left;width:260px;height:32px;text-align:right;line-height:30px;display:inline-block;">'+i+"</div>",'<input style="'+a.STYLE_BODY+'float:left;width:235px;height:30px;border:1px solid #ccc;font-size:15px"',"SMS"==r?' size="11" onkeyup="this.value=this.value.replace(/\\D/g,\'\')" onafterpaste="this.value=this.value.replace(/\\D/g,\'\')"':"",' type="text" name="dialog-body-input" class="dialog-body-input" value="" />','<div class="dialog-body-error" style="'+a.STYLE_BODY+'float:left;background:none;margin:0 0 0 5px;width:auto;display:inline-block;color:#f00;line-height:30px;"></div>','<div style="',a.STYLE_BODY,'margin:0;padding:0;border:0;font-size:0;line-height:0;clear:both;display:block;height:0px;"></div>',"</div>",'<div class="dialog-body-console" style="'+a.STYLE_BODY+'margin:20px 0 0 0;">',"<table><tr>",'<td align="right" width="50%"><div class="dialog-body-submit" style="',a.STYLE_BODY,"float:right;text-align:center;cursor:pointer;background:#B20000 url(",j,') no-repeat 5px 10px;color:#fff;padding:10px 20px;margin:0 0 0 0px;display:block;width:80px;*width:120px;">',m,"</div></td>",'<td align="left" width="50%"><div class="dialog-body-message" style="',a.STYLE_BODY,"background:none;color:#000;margin:0 50px 0 5px;width:290px;visibility:hidden;display:inline",a.browser.msie6?"":"-block",';">',a.utils.handleLinks(l,{url:"#",time:'<span class="dialog-timeinterval" style="'+a.STYLE_BODY+'color:#f00;display:inline;">0秒</span>'}),"</div></td></tr></table>","</div>",'<div class="dialog-body-link" style="'+p+'background:none;margin:20px 0 0 0;visibility:hidden;">','<div style="'+a.STYLE_BODY+'background:none;margin:0 0 0 260px;">',a.utils.handleLinks(h.closelink,{url:d}),"</div>","</div>"].join(""),s.title=k,s.html=e,s.closeCss="background:url("+j+") no-repeat 0px -298px;",s.bind=function(b,c){a(".dialog-body-submit",b).hover(function(b){q.inputs[c.key]["dialog-body-submit"].status||a(this).css({"background-color":"#E20000"})},function(b){q.inputs[c.key]["dialog-body-submit"].status||a(this).css({"background-color":"#B20000"})}).bind("click",function(e){a("div.dialog-body-message",b).css({color:"#000000",visibility:"hidden"}).html(a.utils.handleLinks(l,{url:d,time:'<span class="dialog-timeinterval" style="'+a.STYLE_BODY+'color:#f00;display:inline;">0秒</span>'})),q.inputs[c.key]["dialog-body-submit"].status||q.sendCoupon(r)}),a("div.dialog-body-link a",b).bind("click",function(a,b){q.dialog&&q.dialog.hide(),q.diagDownCoupon&&(q.diagDownCoupon.hide(),q.diagDownCoupon=null)})},s.fnShow=function(){},s.fnHide=function(){clearInterval(q.timeID),q.timeID=null,q.diagDownCoupon=null},this.timeinterval=50,this.diagDownCoupon=new a.Dialog(s),this.diagDownCoupon.show(),q.disabled(this.diagDownCoupon.options.key,"dialog-body-submit",!1),void q.disabled(this.diagDownCoupon.options.key,"dialog-body-input",!1)):(a.Log("download to pc"),void this.downCoupon({t:32}))},sendCoupon:function(b){var c=this.diagDownCoupon.element.find("input.dialog-body-input"),d=this.diagDownCoupon.element.find(".dialog-body-error"),e=new RegExp("^1[3|4|5|8][0-9]\\d{8}$","i"),f=new RegExp("^[a-zA-Z0-9\\._-]+@[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)+$","i"),g=c.val();switch(b){case"SMS":if(!g||!e.test(g))return d.html(h.smserror),void c.get(0).focus();d.html(""),a.Log("download to your phone"),this.downCoupon({t:30,phone:g});break;case"MAIL":if(!g||!f.test(g))return d.html(h.mailerror),void c.get(0).focus();d.html("");var j=a("div.dialog-body-message a").get(0);j&&(j.target="_blank",i[g.split("@")[1]]?j.href="http://"+i[g.split("@")[1]]||"mail."+g.split("@")[1]:j.href="http://mail."+g.split("@")[1]),a.Log("download to your mailbox"),this.downCoupon({t:31,email:g})}},downCoupon:function(b,c){var d=this,e=this.baseURL+a.toURI(a.extend({},this.defRequest,b));32===b.t?window.open(e):a.require(e+"#rnd",function(e){a.Log("type:"+b.t,2),"undefined"!=typeof ntkf_active_marketing_send_number&&a.isPlainObject(ntkf_active_marketing_send_number)&&a.Log(ntkf_active_marketing_send_number),e.error||"undefined"==typeof ntkf_active_marketing_send_number||!a.isPlainObject(ntkf_active_marketing_send_number)?(a("div.dialog-body-message").css({color:"#f00",visibility:"visible"}).html(h.errormessage),a(".dialog-body-submit").html(h.resend)):ntkf_active_marketing_send_number.result==-1?(a("div.dialog-body-message").css({color:"#f00",visibility:"visible"}).html(ntkf_active_marketing_send_number.error),a(".dialog-body-submit").html(h.resend)):d.diagDownCoupon&&(a(".dialog-body-submit",d.diagDownCoupon.element).html(h.sended),d.diagDownCoupon.element.find("div.dialog-body-message, div.dialog-body-link").css("visibility","visible"),d.diagDownCoupon.element.find("span.dialog-timeinterval").html(a.utils.handleLinks(h.time,{time:d.timeinterval})),d.disabled(d.diagDownCoupon.options.key,"dialog-body-submit",!0),d.disabled(d.diagDownCoupon.options.key,"dialog-body-input",!0),c&&c.call(d),d.interval())},null,{remove:!0})},interval:function(){var b=this;this.stopInterval(),this.timeID=setInterval(function(){if(b.diagDownCoupon||b.stopInterval(),a("span.dialog-timeinterval",b.diagDownCoupon?b.diagDownCoupon.element:null).html(a.utils.handleLinks(h.time,{time:(--b.timeinterval).toString()})),b.timeinterval<=0)return b.timeinterval=50,a(".dialog-body-submit",b.diagDownCoupon.element).html(h.resend),b.disabled(b.diagDownCoupon.options.key,"dialog-body-submit",!1),b.disabled(b.diagDownCoupon.options.key,"dialog-body-input",!1),a("div.dialog-body-message, div.dialog-body-link",b.diagDownCoupon.element).css("visibility","hidden"),clearInterval(b.timeID),void(b.timeID=null)},1e3)},stopInterval:function(){clearInterval(this.timeID),this.timeID=null},formatValid:function(b){var c=b;return c>86400?a.utils.handleLinks(h.day,{time:parseInt(10*c/60/60/24)/10}):c>3600?a.utils.handleLinks(h.hour,{time:parseInt(10*c/60/60)/10}):c>60?a.utils.handleLinks(h.minute,{time:parseInt(10*c/60)/10}):a.utils.handleLinks(h.time,{time:c||"0"})}}}(nTalk);