!function(a,b){function c(b){for(var c,d,e=0;e<b.length;e++)d=b[e],c=a("[nodeid="+d+"]"),c.css("display",a.relate_nodeid_display[d]||""),c.attr("el-show","show")}function d(b){for(var c,d=0;d<b.length;d++)c=a("[nodeid="+b[d]+"]"),c.css("display","none"),c.attr("el-show","hide")}function e(b,d){for(var e=0;e<d.length;e++){var f=d[e];switch(f){case"display":c([b+"-checked"]);break;case"effect":g([b],"checked");break;case"radio":a("[nodeid="+b+"-checked]").attr("checked","checked")}}}function f(b,c){for(var e=0;e<c.length;e++){var f=c[e];switch(f){case"display":d([b+"-checked"]);break;case"effect":g([b],"unchecked");break;case"radio":a("[nodeid="+b+"-checked]").attr("checked","")}}}function g(b,c){var d=a("[nodeid="+b+"]");for(cls in a.defaultEffect)if(cls.indexOf("count")>-1){var e=a("[nodeid="+b+"-count]");if(e.length>0){var f=a.defaultEffect[d[0].className][c],g=a.defaultEffect[e[0].className][c];h(d,b,g),e.html(parseInt(e.html())+g),e.css(f)}}else{d[0].className==cls?d:d.find("."+cls);d.css(a.defaultEffect[cls][c])}}function h(b,c,d){var e=a.generateHtml("span","nt-evaluation-checkout-count-add",c+"-count-add",d>0?"+"+d:d);b.insert(e);var f=a(".nt-evaluation-checkout-count-add"),g=-10,h=setInterval(function(){g--,f.css("top",g+"px")},20);setTimeout(function(){clearInterval(h),f.remove()},500)}a.EvaluateTree=function(a){this.evaluateData=a,this.evaluateNodes={},this.levelNodes={},this.init(),delete this.evaluateData},a.EvaluateTree.prototype={init:function(){var b=this,c=function(c){for(var d=function(e,f,g,h){var i,j,l;if(f){if(k=b.evaluateNodes[g],!k)for(var m=0,n=c.length;m<n;m++){var o=c[m];if("findQuestionParent"==h&&o.questionid==f){k=new a.EvaluateQuestionNode(o),i=o.parentid,j="a"+i,l="findAnswerParent",b.evaluateNodes[g]=k;break}if("findAnswerParent"==h&&o.answerid==f){k=new a.EvaluateAnswerNode(o),i=o.questionid,j="q"+i,l="findQuestionParent",b.evaluateNodes[g]=k;break}}k&&(k.childrenNodeIds.push(e),b.evaluateNodes[e].parentNodeId=g),i&&d(g,i,j,l)}},e=0,f=c.length;e<f;e++){var g,h,i,j,k,l,m=c[e];if(m.answerid){if(g="a"+m.answerid,b.evaluateNodes[g])continue;h=new a.EvaluateAnswerNode(m),j=m.questionid,l="q"+j,i="findQuestionParent"}if(m.parentid){if(g="q"+m.questionid,b.evaluateNodes[g])continue;h=new a.EvaluateQuestionNode(m),j=m.parentid,l="a"+j,i="findAnswerParent"}b.evaluateNodes[g]=h,d(g,j,l,i)}};c(this.evaluateData),this.setAllRelate()},getNode:function(a){return this.evaluateNodes[a]},setAllRelate:function(){var a=this;for(eIndex in this.evaluateNodes){var b=this.evaluateNodes[eIndex].childrenNodeIds,c=[].concat(b),d=function(b){for(idIndex in b){var e=a.evaluateNodes[b[idIndex]];c=c.concat(e.childrenNodeIds),e.childrenNodeIds.length>0&&d(e.childrenNodeIds)}};d(b),this.evaluateNodes[eIndex].allChildrenNodeIds=c;var e=this.evaluateNodes[eIndex].parentNodeId,f=[],g=function(b){var c=a.evaluateNodes[b];b&&f.push(b),c&&c.parentNodeId&&g(c.parentNodeId)};g(e),this.evaluateNodes[eIndex].allParentNodeIds=f}for(eIndex in this.evaluateNodes){var h=this.evaluateNodes[eIndex].allParentNodeIds.length;this.levelNodes[h]?this.levelNodes[h].push(eIndex):this.levelNodes[h]=[eIndex],this.maxLevel=this.levelNodes.length}},clearAnswerCount:function(){for(nodeid in this.evaluateNodes){var a=this.evaluateNodes[nodeid];"answer"==a.nodetype&&(a.count=0)}}},a.EvaluateQuestionNode=function(b){this.questionid=b.questionid,this.parentid=b.parentid,this.icon=b.icon,this.content=b.content,this.must=b.must,this.errorhint=b.errorhint,this.styleid=a.JSON.parseJSON(b.styleid),this.nodetype="question",this.parentNodeId="",this.allParentNodeIds=[],this.childrenNodeIds=[],this.allChildrenNodeIds=[]},a.EvaluateAnswerNode=function(b){this.answerid=b.answerid,this.questionid=b.questionid,this.icon=b.icon,this.content=b.content,this.type=b.type,this.score=b.score,this.defaultvalue=b.defaultvalue,this.styleid=a.JSON.parseJSON(b.styleid),this.nodetype="answer",this.parentNodeId="",this.allParentNodeIds=[],this.childrenNodeIds=[],this.allChildrenNodeIds=[],this.count=0,this.max=0,this.maxContent="0/"+this.max},a.evaluateBaseInfo={evaluateTitle:"Evaluation",submitButtonName:"evaluate",closeButtonName:"X"},a.evaluateMobileBaseInfo={evaluateTitle:"",submitButtonName:"evaluate",cancelButtonName:"cancel"},a.evaluateDomName="dom",a.evaluateStyle={6:{dom1:{className:"nt-evaluation-radio-checked",tag:"inputradio",mark:"-checked",content:{attr:"",value:""}},dom2:{className:"nt-evaluation-radio-content",tag:"span",mark:"",content:{attr:"content"}},dom3:{className:"nt-evaluation-radio-option",tag:"div",mark:"",content:[1,2]}},7:{dom1:{className:"nt-evaluation-textarea",tag:"textarea",mark:"",content:{attr:"content"}},dom2:{className:"nt-evaluation-textarea-length",tag:"div",mark:"-count",content:{attr:"maxContent"}},dom3:{className:"nt-evaluation-textarea-option",tag:"div",mark:"",content:[1,2]}},8:{dom1:{className:"nt-evaluation-question",tag:"div",mark:"",content:{attr:"content"}}}},a.evaluateMobileStyle={2:{dom1:{className:"nt-evaluation-radio-unchecked",tag:"div",mark:"",content:{attr:"",value:""}},dom2:{className:"nt-evaluation-radio-checked",tag:"div",mark:"-checked",content:{attr:"",value:""}},dom3:{className:"nt-evaluation-radio-content",tag:"span",mark:"",content:{attr:"content"}},dom4:{className:"nt-evaluation-radio-option",tag:"div",mark:"",content:[1,2,3]}},3:{dom1:{className:"nt-evaluation-textarea",tag:"textarea",mark:"",content:{attr:"content"}},dom2:{className:"nt-evaluation-textarea-length",tag:"div",mark:"-count",content:{attr:"maxContent"}},dom3:{className:"nt-evaluation-textarea-option",tag:"div",mark:"",content:[1,2]}},4:{dom1:{className:"nt-evaluation-question",tag:"div",mark:"",content:{attr:"content"}}}},a.defaultStyle={evaluateWrap:{margin:2,border:3,style:{border:"3px solid #00ACFF",height:"auto"}},"nt-evaluation-title":"position: relative;top: 0px;left: 0px;width: auto;height: 30px;padding: 0px;margin: 0px;text-align: center;font-size: 14px;font-weight: bold;line-height: 30px;color: #000;background: #F2F2F2;border-bottom: 1px solid #ccc;","nt-evaluation-close":"position: absolute;top: 3px;right: 20px;font-size:14px;color:#000;cursor:pointer;","nt-evaluation-question":"position: relative;top: 0px;left: 0px;width: auto;height: 30px;padding: 0px;margin: 0px;text-align: left;font-size: 12px;line-height: 30px;color: #5a5a5a;background: #FFF;","nt-evaluation-radio-option":"position: relative;display: inline-block;*display: inline;*zoom:1;width: auto;height: 20px;padding: 0px;margin:0px 2px 0px 0px;text-align: center;background: #FFF;cursor:pointer","nt-evaluation-radio-content":"position:relative;left:1px;font-size: 12px;line-height: 12px;color: #434343;","nt-evaluation-radio-checked":"position:relative;top:2px;margin-right:0px","nt-evaluation-section":"position: relative;top: 0px;left: 0px;width: 100%;height: auto;padding: 0px;margin: 0px 0px 0px 10px;text-align: left;background: #FFF;font-size: 0px;","nt-evaluation-textarea-option":"position: relative;top: 0px;left: 0px;width: 100%;height: auto;padding: 0px;margin: 0px 0px 20px 0px;text-align: left;background: #FFF;font-size: 0px;","nt-evaluation-textarea":"position: relative;width: 350px;height: 52px;padding: 10px;margin: 0px;text-align: left;font-size: 12px;line-height: 12px;color: #000;background: #FFF;border: 1px solid #cdcdcd;border-radius: 5px;box-sizing: content-box;resize:none","nt-evaluation-textarea-length":"position:absolute;right:32px;top:72px;float:right;font-size:14px;font-weight:bold;color:#ccc;","nt-evaluation-bottom":"position: relative;top: 5px;left: 0px;width: 100%;height: 42px;text-align: center;background:#FFF;border-radius: 5px;cursor:pointer","nt-evaluation-bottom-button":"padding: 0px 15px; border: 1px solid rgb(135, 135, 135); height: 28px; color: rgb(51, 51, 51); line-height: 24px; display: inline-block; background: -webkit-gradient(linear, 0% 100%, 0% 0%, from(rgb(255, 255, 255)), to(rgb(245, 245, 245))) rgb(235, 233, 233);","nt-evaluation-error":"position:relative; top:-68px; left:10px; width:auto; height:0px; line-height:30px; font-size:12px; color:red;display:none"},a.defaultMobileStyle={evaluateWrap:{margin:"39 "+top,border:0,style:{"background-color":"#fbfbfb","border-radius":"5px",height:"auto"}},"nt-evaluation-background":"position: absolute;z-index:99999;top: 0rem;left: 0rem;width: 100%;height: 100%;background: #ccc;opacity: 0.6;","nt-evaluation-wrapper":"position: relative;top:-18px;left:0px;z-index:100000;width:100%;height:auto;background:#fafafa;","nt-evaluation-section":"position: relative;top: 0px;left: 0px;width: 80%;height: auto;padding: 3% 0 0 0;margin: 0% 10% 0% 10%;font-size: 0px;text-align: center;background: #fbfbfb;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0);","nt-evaluation-question":"position: relative;top: 0px;left: 0px;width: auto;height: auto;padding: 0px;margin: 0px;text-align: left;font-size: 14px;font-weight:bold;line-height: 30px;color: #333333;background: transparent;word-break:normal","nt-evaluation-radio-option":"position: relative;display: block; width: 100%; height: 35px;","nt-evaluation-radio-content":"position: relative;margin: 0px 0px 0px 15px; font-size: 14px; display: inline; color: #333; background-color: transparent;","nt-evaluation-radio-unchecked":"position:absolute;left:20px;top:-1px;width:20px;height:20px;background:white;border: 1px solid #cecece;border-radius:10px;-webkit-border-radius:10px;-o-border-radius:10px;-moz-border-radius:10px;-ms-border-radius:10px","nt-evaluation-radio-checked":"position: absolute; left: 22px; top: 1px; width: 16px; height: 16px; border: 1px solid rgb(50, 168, 245); border-radius: 8px; display: block; background: rgb(50, 168, 245);","nt-evaluation-textarea-option":"position: relative;top: 0px;left: 0px;width: 100%;height: auto;padding: 0px;margin: 0px;text-align: left;background: #FFF;font-size: 0px;","nt-evaluation-textarea":"position: relative;width: 88%;height: 52px;padding: 10px 6%;margin: 0px;text-align: left;font-size: 12px;line-height: 12px;color: #000;background: #FFF;border: 1px solid #cdcdcd;border-radius: 5px;box-sizing: content-box;resize:none","nt-evaluation-textarea-length":"position:absolute;right:32px;top:92px;float:right;font-size:14px;font-weight:bold;color:#ccc;","nt-evaluation-bottom":"position: relative;top: 0;left: 0px;bottom: 0px;width: 100%;height: 2rem;line-height: 2rem;padding: 0px;margin: 0px;font-size: 0px;text-align: center;background: #fafafa;border-top: 1px solid #ddd;border-radius:5px;","nt-evaluation-bottom-submit":"display: inline-block;width: 49%;font-size:14px;color: #55b6f5;","nt-evaluation-bottom-cancel":"display: inline-block;width: 49%;font-size:14px;color: #55b6f5;border-right: 1px solid #ddd;"},a.defaultEffect={"nt-evaluation-radio-content":{checked:{color:"rgb(50, 168, 245)"},unchecked:{color:"#333"}}},a.radioEffect={},a.radioEffect.get=function(){return a.browser.mobile?["display","effect"]:["radio"]},a.EvaluateView=function(){this.evaluateHtml=this.generateEvaluateHtml().join("")},a.EvaluateView.prototype.generateEvaluateHtml=function(b,c){var d=[];b=a.evaluateTree.labelCounts||{},c=a.browser.mobile?a.evaluateMobileBaseInfo:a.evaluateBaseInfo;var e=function(b,c){for(var d=[],f="",g=0;g<c.length;g++){var h=c[g],i=a.evaluateTree.getNode(h);if("textarea"===i.type){var j=a.getTextAreaMaxLength(h);i.max=j,i.maxContent="0/"+(a.lang.language.indexOf("zh_")>-1?j/2:j),j&&(a.relate_nodeid_max[h]=j)}var k;k=a.browser.mobile?a.evaluateMobileStyle[i.styleid.wap]:a.evaluateStyle[i.styleid.pc];var l=0;for(var m in k){var n=k[m],o=n.content;if(a.isArray(o)){for(var p="",q=0;q<o.length;q++)p+=k[a.evaluateDomName+o[q]].html;o=p}else if(o.attr){if("maxContent"==o.attr&&0==i.max){n.html="",l++;continue}o=i[o.attr]}else o=o.value;n.html=a.generateHtml(n.tag,n.className,h+n.mark,o,i.parentNodeId),l++}var r=k[a.evaluateDomName+l];f+=r?r.html:"",d=d.concat(i.childrenNodeIds)}return f&&(f=a.generateHtml("div","nt-evaluation-section","section",f)),b+=f,d.length>0&&(b=e(b,d)),b};if(c.evaluateTitle){var f=a.generateHtml("div","nt-evaluation-title","",c.evaluateTitle);d.push(f)}if(c.closeButtonName){var g=a.generateHtml("div","nt-evaluation-close","close",c.closeButtonName);d.push(g)}for(var h=0;h<a.evaluateTree.levelNodes[0].length;h++){var i="";i=e(i,[a.evaluateTree.levelNodes[0][h]]),d.push(i)}if(a.browser.mobile){var j=a.generateHtml("div","nt-evaluation-bottom-submit","submit",c.submitButtonName),k=a.generateHtml("div","nt-evaluation-bottom-cancel","cancel",c.cancelButtonName),l=a.generateHtml("div","nt-evaluation-bottom","",k+j);d.push(l)}else{var j=a.generateHtml("button","nt-evaluation-bottom-button","submit",c.submitButtonName),l=a.generateHtml("div","nt-evaluation-bottom","",j);d.push(l)}var m=a.generateHtml("div","nt-evaluation-error","error","");return d.push(m),d},a.generateHtml=function(b,c,d,e,f){var g=a.defaultStyle,h=a.STYLE_BODY;return a.browser.mobile&&(g=a.defaultMobileStyle,h=""),"img"==b?"<"+b+' class="'+c+'" style="'+h+" "+g[c]+'" src="'+e+'" nodeid="'+d+'" el-show="show"/>':"textarea"==b?"<"+b+' class="'+c+'" style="'+h+" "+g[c]+'" nodeid="'+d+'" placeholder="'+e+'" el-show="show"></'+b+">":b.indexOf("input")>-1?'<input type="'+b.substring(5)+'" name="'+f+'" class="'+c+'" style="'+a.STYLE_BODY+" "+a.defaultStyle[c]+'" nodeid="'+d+'" el-show="show">'+e+"</"+b+">":"<"+b+' class="'+c+'" style="'+h+" "+g[c]+'" nodeid="'+d+'" el-show="show">'+e+"</"+b+">"},a.getTextAreaMaxLength=function(b){var c=a.evaluateTree.getNode(b),d=a.evaluateTree.getNode(c.parentNodeId);if(!d.errorhint)return 0;for(var e=a.JSON.parseJSON(d.errorhint),f=0;f<e.length;f++){var g=e[f];if(g.type==a.verificateLengthStr)return g[a.verificateMaxStr]}return 0},a.relate_nodeid_display||(a.relate_nodeid_display={}),a.relate_nodeid_max||(a.relate_nodeid_max={}),a.EvaluateEvent={},a.EvaluateEvent.bindEvaluateEvent=function(){for(var b=a(".nt-evaluation-radio-option"),g=a.radioEffect.get(),h=0;h<b.length;h++){var i=a(b[h]).attr("nodeid"),k=a.evaluateTree.getNode(i),l=a.evaluateTree.getNode(k.parentNodeId),m=k.allChildrenNodeIds,n=k.defaultvalue;for(j=0;j<m.length;j++){var o=a("[nodeid="+m[j]+"]").css("display");a.relate_nodeid_display[m[j]]=o}1!=n?(d(m),f(i,g)):(e(i,g),l.answerData=[{labid:k.answerid,lab:k.content,score:k.score}])}for(var p=a(".nt-evaluation-checkbox-option"),q={},h=0;h<p.length;h++){var i=a(p[h]).attr("nodeid"),k=a.evaluateTree.getNode(i),l=a.evaluateTree.getNode(k.parentNodeId);q[k.parentNodeId]||(l.answerData=[],q[k.parentNodeId]=1),1!=k.defaultvalue?f(i,"display"):(e(i,"display"),l.answerData.push({labid:k.answerid,lab:k.content,score:k.score}))}var r=a(".nt-evaluation-section");r.click(function(b){b=a.Event.fixEvent(b);var h=b.target,i=function(b){if("nt-evaluation-section"!=b.className){if("nt-evaluation-radio-option"==b.className){var h=a(b).attr("nodeid"),j=a.evaluateTree.getNode(h),k=a.evaluateTree.getNode(j.parentNodeId),l="a"+k.answerData[0].labid;if(l==h)return;return d(a.evaluateTree.getNode(l).allChildrenNodeIds),f(l,g),c(a.evaluateTree.getNode(h).allChildrenNodeIds),e(h,g),k.answerData=[{labid:j.answerid,lab:j.content,score:j.score}],void 0}if("nt-evaluation-checkbox-option"==b.className){for(var h=a(b).attr("nodeid"),j=a.evaluateTree.getNode(h),k=a.evaluateTree.getNode(j.parentNodeId),m=k.answerData||[],n={labid:j.answerid,lab:j.content,score:j.score},o=-1,p=0;p<m.length;p++)if(m[p].labid==j.answerid){o=p;break}o!=-1?(f(h,["effect"]),m.splice(o,1)):(e(h,["effect"]),m.push(n)),k.answerData=m}i(a(b).parent().get(0))}};i(h)});for(var s=a(".nt-evaluation-textarea"),h=0;h<s.length;h++){var i=a(s[h]).attr("nodeid"),k=a.evaluateTree.getNode(i),l=a.evaluateTree.getNode(k.parentNodeId);l.answerData=[{labid:0,lab:a(s[h]).val(),score:0}]}var t=function(b){b=a.Event.fixEvent(b);var c=b.target,d=a(c).attr("nodeid"),e=a.evaluateTree.getNode(d),f=a.evaluateTree.getNode(e.parentNodeId),g=a.relate_nodeid_max[d];setTimeout(function(){if(g){var b=a.enLength(a(c).val())>g?"#f00":"#ccc",d="";d=a.lang.language.indexOf("zh_")>-1?Math.ceil(a.enLength(a(c).val())/2)+"/"+g/2:Math.ceil(a.enLength(a(c).val()))+"/"+g,a(c).parent().find(".nt-evaluation-textarea-length").html(d).css("color",b)}f.answerData=[{labid:0,lab:a(c).val(),score:0}]},100)};s.bind("keyup",t),s.bind("paste",t)},a.verificateEmptyStr="empty",a.verificateLengthStr="length",a.verificateMaxStr="max";var i=[".nt-evaluation-question[el-show=show]",".nt-evaluation-question-nocontent[el-show=show]"];a.EvaluateVerificate={},a.EvaluateVerificate.getEvaluateSubmitData=function(){for(var b=[],c=[],d={},e=function(c){var e={},f=a(c),g=a.evaluateTree.getNode(f.attr("nodeid"));if(e.id=g.questionid,e.question=g.content,e.answer=g.answerData||[],0!==e.answer.length||1==g.must){if(!g.errorhint)return void b.push(e);for(var h=a.JSON.parseJSON(g.errorhint),i=0;i<h.length;i++){var j=h[i];if(j.type==a.verificateEmptyStr&&0===e.answer.length){d[e.id]=j.content;break}if(j.type==a.verificateLengthStr&&a.enLength(e.answer[0].lab)>j[a.verificateMaxStr]){d[e.id]=j.content;break}}b.push(e)}},f=0;f<i.length;f++){c=a(i[f]);for(var g=0;g<c.length;g++)if(c[g]&&e(c[g]),!a.isEmptyObject(d))return d}return b}}(nTalk);