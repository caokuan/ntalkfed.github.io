二次打开聊窗提示加载失败(4599)
ios app 下msg is null(9933) 4520


本次修复问题(6.1.1)
    (1)、IM连接问题，IM服务端需要更新，前段修正isnoim为2时，由关闭聊窗后下次连接IM修改为关闭就连接IM；WAP页、页外修改为isnoim为0或2时都直接连接IM（2473、1682、4745）
    (2)、聊窗滚动条问题 （2381）
    (3)、聊窗中消息排序、添加系统除重（2196、3214、3400）
    (4)、商户A的商品信息发送到了商户B（4499）
    (5)、消息丢失：4字节字符过滤；Tchat服务器更新（1137、4344）
    (6)、前端发送或接收文件时，显示文件名（2446）
    (7)、客服变更时，后一个客服或签名等内容为空时，继承了前一客服信息（4266）
    (8)、WAP样式：客服名称过长（3153）;WAP打开URL，弹评价窗（4743）
    (9)、排队样式：3秒刷新头像（4706）；WAP排队状态不正确（4744）
    (10)、留言页电话一栏，不可以左右移动（4812）
    (11)、临时修改页面未加载完成时，点击打开聊窗无响应，修正为点击后，页面加载完成后会在当前页自动打开聊窗
    (12)、平台版下商户页轨迹未传sellerid(合并平台版内容)

本次修复问题(6.1.1.1 已更新到药房 yf_1000)
    (1)、修复商品列表页，点击打开商户商品信息，传递商品ID，应该显示商品信息
	NTKF.im_openInPageChat("yf_338499_9999","309178","",null,"0-0-338499-73.00-100");
	NTKF.im_openInPageChat("yf_338812_9999","611137","",null,"0-0-338812-80.00-10");
	NTKF.im_openInPageChat("yf_338599_9999","758738","",null,"0-0-338599-84.00-10");

2015.03.13(6.1.2)
	(1)、文件上传修改为非Flash上传，WAP版添加文件上传；（需要接口同步更新）PC；
	(2)、取消脚本对documentReady事件的依赖,优化ready前创建节点的方法；
	(3)、自定义表情支持
	(4)、页外、WAP页为避免同一连接给不同人，会以同一身份发起会话，现修改为所以页外、WAP页全部连接到downt下的chat.php页，必选参数采用GET方式传递，非必选的用户身份信息采用POST传递；原chat.html,mobile.html修改为跳转地址（用于固化在APP、或网站页面,保存在本地等情况的跳转）
	(5)、部分样调整
2015.03.20(6.1.2.1)
	(1)、tchat连接成功，前端开始发送缓存队列中的消息，紧跟着tchat返回remoteNotifyUserClose, 导致重复连发起tchat登录请求
	(2)、comet链接时，login超时，重连login, 结果两个连接都返回登录成功，可能导致多连接并行
	(3)、修复会话由A转接给B后，与tchat连接断开后，重连会继续请求客服A
	(4)、修改，自定义表情添加默认组表情图片；
2015.04.10
	(1)、合并设置相关内容；
	(2)、添加网站加载多次脚本兼容；
	(3)、修复魅达网商品信息展示的一个BUG
	(4)、添加通过IM被动打开聊窗的支持
	(5)、自定义表情支持（添加默认组图标支持）

2015.03.20(6.1.3.0)
	(1)、WAP版，在当前页打开，可以点击返回按钮，退回网站页面；
	(2)、WAP版添加自定义表情支持；
	(3)、功能跟踪
	(4)、样式兼容处理
	(5)、WAP添加文件、图片上传
	(6)、多次加载脚本兼容
	(7)、消息内图片自动缩放

2015.05.04(6.1.3.1)
	1、comet IM连接优化
	2、消息分发优化
	3、mqtt(websock, flash sock未实现)
	4、添加最后一页出发方式
	5、商品数据（集成数据）抓取合并
	相关配置增加
	server.connect_type: (String)[comet|rtmp|mqtt]。逐步替换close_im_flash配置项
	server.presencemqttserver (String)

2015.05.18(6.3.0.0)
	1.多个客服与客户聊天，当客服进入，离开时，消息位置的修正
	2.截屏插件检测逻辑修正，以及截屏前最小化，完成后还原窗口
	3.分配客服不成功时，仅预留重试按钮，不需要留言按钮
	4.合并了6.1.3.1中im优化的代码（未引入mqtt）

2015.07.01(6.3.1.0)
	1、合并nt6.1.3.0\nt6.1.3.2(小版本)\nt6.1.3.1(mqtt)\nt6.3.0.0三个版本
	2、切换客服添加数据库配置项控制是否启用此功能
	alter table t2d_enterpriseinfo add `changecsr` TINYINT(2) DEFAULT '0' COMMENT '是否启用访客切换客服，默认不启用';

2015.07.09
	1、修改6.3.1.0版本号为6.1.7.0
		0:不保持，每次打开聊窗都是默认状态；1：当前页保持；当前页打开聊窗时，继承上一次关闭聊窗时的状态
		alter table t2d_enterpriseinfo add `robot_inherits_state` TINYINT(2) DEFAULT '0' COMMENT '机器人连接状态保持,0:不保持；1：当前页保持；';
	2、排队时，开启机器人的情况下，排队消息中添加可以转机器人的连接
	3、聊窗断线的情况下，收到IM消息时，让消息指定settingid的聊窗或最后连接客服ID与消息的客服ID相同的聊窗重连
	4、被动接收的消息、接收邀请、营销等打开聊窗时，直接连接人工客服，客服忙碌时排队，离线时进机器人，此逻辑与接待组本身配置不冲突


2015.07.20(6.1.7.0)
    1、改善判断最后一页的逻辑，改为由COOKIE页面管理器对象判断，且展现时再次判断（比较LocalStorage此方案更为准确）
    2、改善重连机制，连接上MQTT连接的时候，如果旧连接存在，服务器会发送类型为DISCONNECT的消息，前端收到后断开旧连接，并且不进行重连，避免两个页面互相抢连接，造成的重连死循环
    3、修复初始化页面时，因为localStorage读取不到数据造成的置空现存页面的BUG
            3.1、利用多次（3次）读取，减少不能读取到localStorage的概率
            3.2、当LS中存储的数量小于Cookie管理数量(现在设置的是3)，且数据不一致时，从cookie中读取，赋值到LS中  
	
    5、wap添加单击查看原图功能并查看的功能,WAP皮肤支持,表情滚动修正
	6、添加localStorage对像不可用的异常处理
	7、添加聊窗位置拖动、大小拖动支持
		alter table t2d_enterpriseinfo add `drag_chat` tinyint(2) DEFAULT '1' COMMENT '聊天窗口是否可拖动，默认可拖动';
		alter table t2d_enterpriseinfo add `resize_chat` tinyint(2) DEFAULT '0' COMMENT '聊天窗口是否可变换大小，默认可拖动';

2015.08.03(sz_1000)
	1、聊窗界面定制版
	2、API接口标准化
	

2016.01.08（6.1.9.3+）
    1、添加mqttChat支持
    2、合并尚德定制内容
        尚德聊窗不需要移动；
        尚德聊窗居中；
        留言地址变更为: http://kpi-sunlands-test.ntalker.com/index.php?c=addmessage&m=queryService&t=leaveMsg&siteid=' + this.siteid + '&sellerid=' + this.sellerid + '&settingid=' + this.settingid
        添加统计点 24 访客打开聊窗次数
        统计地址变更为http://kpi-sunlands-test.ntalker.com/index.php? 	参数变更  m: 'Count',a: 'collection'  变为 c: 'addmessage',m: 'collection',

2016.01.22
    1、修复页面信息重载导致发送发起页信息失败

2015.11.27(nt6.1.9.0)
    1、wap整体改版

2015.12.01(nt6.1.9.1)
    1、企业问候语可配置
    2、cookie被禁用的处理
    3、自定义表情协议替换
    4、添加无返回按钮
    5、添加WAP页内聊窗

2015.12.11(6.1.9.11) 临时迭代版本
        1、修正机器人转人工图标
        2、修正消息中http\https协议未替换问题
        3、修正WAP文件传输消息无气泡问题
        4、重载数据用户ID问题
        5、小能科技版本信息可配置是否显示，默认显示(alter table t2d_enterpriseinfo add `xiaonengver` tinyint(2) DEFAULT '1' COMMENT '是否显示小能版权信息，默认显示';)
        6、添加接口函数 im_getAppChatWindowURL，用于APP内返回打开聊窗地址
                im_getAppChatWindowURL(JSONObject data, Function callback)

2015.12.30(6.1.9.2) 
        1、WAP页内打开聊窗优化
             说明：在页面长度超过手机屏幕的情况下，在页内打开WAP聊窗，会出现输入框随着页面滚动的情况
        2、机器人转人工按钮显隐bug处理
             说明：机器人模式下，点击转人工按钮，原本隐藏的功能按钮（如更换客服）会显示出来
             测试方法：控制台中输入
                             NTKF.chatManage.get().view.switchToolbar(0); 机器人
                             NTKF.chatManage.get().view.switchToolbar(1); 人工
                             功能按钮的显隐不发生变化
        3、IOS下WAP跳转打开聊窗的情况下，
             点击返回按钮会触发上一个页面的相应位置的点击事件bug修正
        4、文件的后缀名大小写不影响类型判断

2016.01.19(6.1.9.31)
	1、iPhone下cookie禁用提示在iPhone4下显示不全
	2、cookie禁用提示的关闭按钮与聊窗的关闭按钮重合
	3、优化评价窗的体验
	4、iPhone5下第一次进留言无法看见提交按钮

2016.01.21(6.1.9.32)
	1、 2872 嗨淘(9661)，机器人欢迎语设置不生效（2级bug）
	2、机器人和人工下的按钮显隐
	   机器人：只有转人工按钮
	   人工：有表情、图片（根据配置）、文件（根据配置）、评价（根据配置）、截图（根据配置）等按钮

2016.01.22(6.1.9.33)
	1、 嗨学网反馈的脚本报错问题 $.global.waitMessage.each is undefined
	2、小能APP发送图片正常显示

2016.03.07(6.1.9.34)
	1、修复手机端无法上传png图片的bug
	2、修复评价可以提交多次的bug
	3、修复手机端图片按钮至灰的情况下也能点击的bug
	4、修复bmp图片在放大情况下可以显示的bug
	5、修复苹果手机不能正常显示最后一条消息的bug

2016.03.07(6.1.9.35) 帮助中心脚本
	1、未读消息在帮助中心页卡上提示， 消息内容通过两种情况进行显示（支持窗口关闭（弹tip）和不关闭（在聊窗内显示消息））
	2、完善了小能客户端内，脚本聊窗下载聊天记录、打开发送链接、下载图片、下载文件四种链接方式的打开处理
	3、聊窗输入框中直接粘贴QQ截图发送

2016.03.10(6.2.0.1)
        1、nt6.2.0.0与nt6.1.9.33 - nt6.1.9.35版本合并
        2、齐家网反馈问题
           2.1、 WAP页内模式打开聊窗，返回后，使用另一接待组打开，还是连接到原来的客服
           2.2、WAP页内模式打开聊窗，处于排队状态，点击返回按钮，出现是否放弃排队提示，点击确认成功返回后
        3、捷开通讯反馈问题
           3.1、英文语言包不符合语法规范
           3.2、WAP英文模式，转人工按钮太长，影响体验
           3.3、印尼语言包加入主线脚本
        4、八百方反馈问题
           4.1、WAP实时营销样式不适配
        5、文件上传成功提示图标位置
        6、转人工后，按钮显隐问题
           6.1 PC更多按钮
           6.2 WAP音频按钮
        7、图片原始尺寸有误的情况下，无法正常显示

2016.04.11(6.2.0.3)
	1、指纹识别算法：
	   在cookie.enable()为false的情况下，加载fingerprint2.js，计算唯一id
	2、语音消息处理（合并nt6.1.10.0中的处理）：
	    Ie6+、firefox使用flash,chrome、opera使用Audio播放声音
	3、留言添加kfid参数
	4、超过4个小时，更新htmlsid
	5、转人工时，机器人按钮置灰
	6、合并敦煌语言包到主线
	7、合并敦煌、麦包包、海尔商城uname,uid三个特殊站点处理
	8、图片缩略图显示方案调整

2016.04.20(6.2.0.3升级修复bug)
1、【PC】-【IE9以下】-【无法显示商品信息】 
   （nt6.1.9.0以上脚本均有此问题）
2、【PC】-【所有浏览器】-【评价第一次提示输入有误后，不能再次提交】
   （nt6.1.9.34以上脚本均有此问题）
3、【PC】-【IE11】-【无法使用截图】
   （所有版本脚本均有此问题）
4、【PC】-【开启自动连接情况下】-【客服、访客均不说话，会话不会显示关闭】
   （仅nt6.2.0.3有此问题）
5、【PC】-【侧边栏默认展开】-【收缩侧边栏，个性签名消失】
   （所有版本脚本均有此问题）

2016.02.16
	1、添加flashsock支持

2016.03.10(mqtt1.1)
    1、合并6.2.0.3

2016.05.09(6.8.1大版本)
    1、兼容comet,mqtt,机器人1.0，机器人2.0
    2、添加读取语言包配置优先功能