!function(a,b){var c="javascript:void(0);";a.extend({isColor:function(a){return!!/^#[0-9A-F]{6}$/i.test(a)},isImage:function(a){var b=/data:image\/(.*);base64,/i,c=/^http:\/\/.*?\/.*?\.(jpg|png|gif|jpeg|bmp)/i;return!(!b.test(a)&&!c.test(a))},entrance:{__hash:new a.HASH,start:function(b){var c,d;a.browser.mobile?"entrance"===b&&(d=a.options&&a.isDefined(a.options[b])?a.options[b]:null,c=new a.MobileEntrance(b,d),c.show(),this.__hash.add(b,c)):(d=a.options&&a.isDefined(a.options[b])?a.options[b]:null,c=new a.Entrance(b,d),c.show(),this.__hash.add(b,c))},get:function(a){return this.__hash.contains(a)?this.__hash.items(a):null},close:function(a){var b;a?(b=this.__hash.items(a),b&&b.closeElement()):this.__hash.each(function(a,b){b.closeElement()})}},invite:{_close:function(){a.entrance.close("invite")}}}),a.Entrance=new a.Class.create,a.Entrance.prototype={CON_GLOBAL:1,CON_LI_NODE:2,CON_A_LINK:3,CON_ICON_NODE:4,debug:!1,element:null,timeoutID:null,type:"",options:null,stopTimeoutComplete:!1,showCount:0,_default:{background:"",position:"center-center",width:75,height:"auto",xoff:0,yoff:0,isfixed:0,opacity:"",childs:[]},fixPngSelector:[],initialize:function(b,c){this.type=b,this.options=a.extend({},this._default,c),a.Log(this.type+">$.Entrance.initialize()",1),this.pretreatment()},show:function(){"entrance"==this.type?this.createContainer():this.where()},where:function(){var b;a.isDefined(this.options.where)&&(b=this.options.where.waittime,this.startTimeout(1e3*b),this.startInterval())},startInterval:function(){var b=this;this.stopInterval(),this.timeoutID=setInterval(function(){var c=a.chatManage&&a.chatManage.hash?a.chatManage.hash.count():0;b.debug&&a.Log("ver create invite>chatCount:"+c+", inviteElement:"+b.element),0!==c||b.element||b.createTimeID||b.startTimeout(1e3*b.options.where.intervals)},1e3)},startTimeout:function(b){var c=this;c.debug&&a.Log("$.Entrance.startTimeout("+b+")"),this.createTimeID=setTimeout(function(){clearTimeout(c.createTimeID),c.createTimeID=null,c.createContainer()},b)},stopInterval:function(){this.timeoutID&&(clearInterval(this.timeoutID),this.timeoutID=null)},pretreatment:function(){var b,c=this,d=(this.options.width,this.options.height);a.isNumeric(d)&&"0"!=d||(d=0,a.each(this.options.childs,function(b,c){d+=a.isNumeric(c.height)?parseFloat(c.height):a.isNumeric(c.effect.height)?parseFloat(c.effect.height):0}),this.options.height=d),a.each(this.options.childs,function(d,e){var f=["width","height"];a.each(f,function(b,f){/\d+%/i.test(e.effect[f])?c.options.childs[d].effect[f]=e[f]*parseFloat(e.effect[f])/100:a.isNumeric(e.effect[f])&&"0"!=e.effect[f]||(c.options.childs[d].effect[f]=e[f])}),e.effect.pleft=e.xoff,e.effect.ptop=e.yoff,"image"!=e.targettype&&"img"!=e.targettype||(b=e.target)}),!b},closeElement:function(b){var c=this;return b=!(b!==!0&&!this.stopTimeoutComplete),this.element&&this.element.hide(function(){c.element&&c.element.remove(),c.element=null}),1==this.options.where.onlyone?(a.Log(this.type+">onlyone: repeats > "+this.showCount+", timeout > "+this.options.where.intervals),void this.stopInterval()):b===!0||this.showCount>=this.options.where.repeats?(this.stopTimeoutComplete=!0,a.Log(this.type+">stop: repeats > "+this.showCount+", timeout > "+this.options.where.intervals),void this.stopInterval()):void a.Log(this.type+">: repeats > "+this.showCount+", timeout > "+this.options.where.intervals)},createContainer:function(){var b,c,d=this,e=this.getStyle(this.options,this.CON_GLOBAL);if(!this.element){this.showCount++,a.Log(this.type+">container "+a.JSON.toJSONString(e)),this.element=a({className:"ui-entrance-container ui-"+this.type,style:a.STYLE_NBODY+"z-index:99999;min-height:10px;"}).appendTo(!0).css(e),b=a({tag:"UL",className:"ui-entrance-ul",style:a.STYLE_NBODY+"list-style:none;"}).appendTo(this.element,!0),a.each(this.options.childs,function(a,c){d.createElement(b,a,c)}),this.element.hover(function(b){b=a.Event.fixEvent(b),d.hoverElement(b,!0)},function(b){b=a.Event.fixEvent(b),d.hoverElement(b,!1)}).click(function(b){b=a.Event.fixEvent(b),d.clickElement(b)});var f=null,g=function(b){b=a.Event.fixEvent(b),clearTimeout(f),f=setTimeout(function(){d.resizeElement(b)},200)};a.Event.addEvent(window,"resize",g,this.type),this.options.isfixed&&this.element&&(c=this.getPosition(this.options,this.CON_GLOBAL,!1),this.element.fixed(c)),a(".ui-invite").length>0&&a(".ui-invite").css("opacity",this.options.opacity/100)}},createElement:function(b,d,e){var f,g,h="ui-entrance-"+e.type,i="ui-button-"+e.targettype,j="separator"===e.type?a.STYLE_NBODY:a.STYLE_BODY,k=this.getStyle(e,this.CON_LI_NODE);return this.debug&&a.Log(this.type+">"+i+">LI "+a.JSON.toJSONString(k)),f=a({tag:"LI",className:h+" "+i,style:a.STYLE_NBODY+"list-style:none;"}).appendTo(b).attr("data-index",d).css(k),k=this.getStyle(e,this.CON_A_LINK),this.debug&&a.Log(this.type+">"+i+">A "+a.JSON.toJSONString(k)),g=a({tag:"A",href:c,style:j+"display:inline-block;color:#fff;"}).appendTo(f).css(k),a({className:"ui-entrance-hover-show",style:j+"position:absolute;display:none;left:0px;top:0px;"}).appendTo(g).css("left",e.width+"px").html("image"==e.targettype||"img"==e.targettype?'<img src="'+e.target+'" style="'+j+'" />':""),k=this.getStyle(e,this.CON_ICON_NODE),this.debug&&a.Log(this.type+">"+i+">div.icon "+a.JSON.toJSONString(k)),a({className:"ui-button-icon",style:j+"display:block;cursor:pointer;color:#fff;text-align:center;text-decoration:none;"}).appendTo(g).css(k).html(a.isImage(e.content)?"":e.content),"link"===e.targettype?(g.attr("href",e.target),g.attr("target","_blank")):"settingid"===e.targettype&&f.attr("data-settingid",e.target),f},hoverElement:function(b,c){for(var d,e=b.target;e.tagName&&"LI"!==e.tagName.toString().toUpperCase();){if(a(e).indexOfClass("ui-entrance-container"))return!1;e=e.parentNode}var f=a(e).attr("data-index")||"0",g=this.options.childs[f];if("mouseover"==b.type&&(g=a.extend({},g,this.options.childs[f].effect)),d=this.getStyle(g,this.CON_LI_NODE,c),this.debug&&("mouseover"==b.type?(d["background-color"]="#000",d.opacity=.5):(d["background-color"]="",d.opacity=""),a.Log(this.type+">>LI"+(c?":hover":"")+" "+a.JSON.toJSONString(d),2)),a(e).css(d),d=this.getStyle(g,this.CON_A_LINK,c),this.debug&&a.Log(this.type+">>A "+a.JSON.toJSONString(d)),a(e).find("a").css(d),d=this.getStyle(g,this.CON_ICON_NODE,c),this.debug&&a.Log(this.type+">>div.icon "+a.JSON.toJSONString(d)),a(e).find("div.ui-button-icon").css(d),a(e).indexOfClass("ui-button-image")||a(e).indexOfClass("ui-button-img")){var h,i;if(a(e).find(".ui-entrance-hover-show img").display(1),a(e).find(".ui-entrance-hover-show img")[0]){var j=new Image;j.src=a(e).find(".ui-entrance-hover-show img")[0].src,h=j.width,i=j.height,j=null}else h=g.width,i=g.height;a(e).find(".ui-entrance-hover-show").css({left:(/^left\-/i.test(this.options.position)?g.width:0-h)+"px",top:g.height-i+"px"}).display("mouseover"==b.type)}return!1},resizeElement:function(a){var b=this.getPosition(this.options,this.CON_GLOBAL,!1);this.options.isfixed&&this.element&&this.element.fixed(b),this.element&&this.element.css({left:b.left+"px",top:b.top+"px"})},clickElement:function(b){for(var c=b.target,d=!1;c.tagName&&"LI"!==c.tagName.toString().toUpperCase();)c=c.parentNode;var e=a(c).attr("data-settingid")||"",f=c.className||"";if(a(c).indexOfClass("ui-button-settingid"))a.isDefined(this.options.where)&&"1"==this.options.where.session_disable&&(a.Log("$.Entrance.clickElement(): stop: true",1),d=!0),a.im_openInPageChat(e);else if(a(c).indexOfClass("ui-button-settingidout"))e=a(c).attr("data-settingid")||"",a.isDefined(this.options.where)&&"1"==this.options.where.session_disable&&(a.Log("$.Entrance.clickElement(): stop: true",1),d=!0),a.im_openOutPageChat(e);else{if(a(c).indexOfClass("ui-button-image")||a(c).indexOfClass("ui-button-img"))return!1;a(c).indexOfClass("ui-button-close")?a.isDefined(this.options.where)&&"1"==this.options.where.refusal_disable&&(a.Log("$.Entrance.clickElement(): stop: true",1),d=!0):a(c).indexOfClass("ui-button-cancel")||a(c).indexOfClass("ui-button-link")}return f&&(a.Log("$.Entrance.clickElement("+d+"): "+f+", settingid:"+e,2),"entrance"!==this.type&&this.closeElement(d)),!1},getPosition:function(b,c,d){var e=a(window).width(),f=a(window).height(),g={left:0,top:0};if(c===this.CON_GLOBAL)switch(b.position){case"left-top":g.left=Math.min(e-b.width-10,Math.max(10,0+b.xoff)),g.top=Math.max(0,0+b.yoff);break;case"left-center":g.left=Math.min(e-b.width-10,Math.max(10,0+b.xoff)),g.top=Math.max(0,(f-b.height)/2)+b.yoff;break;case"left-bottom":g.left=Math.min(e-b.width-10,Math.max(10,0+b.xoff)),g.top=Math.max(0,f-b.height)+b.yoff;break;case"center-top":g.left=Math.max(0,(e-b.width)/2)+b.xoff,g.top=Math.max(0,0+b.yoff);break;case"center-center":g.left=Math.max(0,(e-b.width)/2)+b.xoff,g.top=Math.max(0,(f-b.height)/2)+b.yoff;break;case"center-bottom":g.left=Math.max(0,(e-b.width)/2)+b.xoff,g.top=Math.max(0,f-b.height)+b.yoff;break;case"right-top":g.left=Math.min(e-b.width-10,Math.max(0,e-b.width+b.xoff)),g.top=0+b.yoff;break;case"right-bottom":g.left=Math.min(e-b.width-10,Math.max(0,e-b.width+b.xoff)),g.top=Math.max(0,f-b.height)+b.yoff;break;default:b.position="right-center",g.left=Math.min(e-b.width-10,Math.max(0,e-b.width+b.xoff)),g.top=Math.max(0,(f-b.height)/2)+b.yoff}else d?(g.left=b.x,g.top=b.y):(g.left=b.xoff,g.top=b.yoff);return g.right=e-g.left-b.width,g.bottom=f-g.top-b.width,g},getStyle:function(b,c,d){var e,f={};return e=c==this.CON_GLOBAL||c==this.CON_LI_NODE?b.background:c===this.CON_ICON_NODE&&a.isImage(b.content)?b.content:"",this.pushPng(e,c,b.type),a.isColor(e)?f["background-color"]=e:e&&c==this.CON_GLOBAL?(f["background-image"]="url("+e+")",f["background-repeat"]="repeat-y"):e?(f["background-image"]="url("+e+")",f["background-repeat"]="no-repeat",f["background-position"]="0 0"):f["background-color"]="transparent",a.isDefined(b.color)&&(f.color=b.color||"#ffffff"),b=a.extend({},b,this.getPosition(b,c,d)),f.width=b.width+"px",f.height=b.height+"px",f["line-height"]=b.height-2+"px",d===!0?c==this.CON_LI_NODE&&(f.left=parseFloat(b.pleft)+parseFloat(b.effect.x)+"px",f.top=parseFloat(b.ptop)+parseFloat(b.effect.y)+"px"):(c==this.CON_LI_NODE?(f.position="invite"===this.type?"absolute":"relative",f.left=b.left+"px",f.top=b.top+"px"):c==this.CON_GLOBAL?(f.position=a.isDefined(b.isfixed)?b.isfixed&&!a.browser.Quirks&&6!==a.browser.ieversion?"fixed":"absolute":"relative",f.left=b.left+"px",f.top=b.top+"px"):(f.position="relative",f.left="0px",f.top="0px"),a.isDefined(b.radius)&&b.radius&&(f["border-radius"]=b.radius)),f},pushPng:function(b,c,d){b.indexOf("image/png");!a.browser.msie||6!=a.browser.ieversion}},a.MobileEntrance=new a.Class.create,a.MobileEntrance.prototype={debug:!1,element:null,bgelement:null,timeoutID:null,type:"",options:null,showCount:0,buttonCount:0,showing:!1,_default:{position:"right-bottom",width:45,height:45,xoff:0,yoff:-60,isfixed:0,opacity:""},initialize:function(b,c){this.type=b,this.options=a.extend({},c,this._default),this.pretreatment()},show:function(){this.createContainer()},close:function(){},pretreatment:function(){var b=this,c=[],d=this.options.height,e=this.options.width,f=0;a.each(this.options.childs,function(a,b){"button"===b.type&&"settingid"===b.targettype&&c.push(b)}),this.options.childs=c,a.each(this.options.childs,function(a,c){b.options.childs[a].width=e,b.options.childs[a].height=d,f+=d}),this.options.height=f,this.options.childs.length>1&&(this.options.height+=this.options.childs[0].height)},createContainer:function(){var b,c=this,d=this.getPosition(this.options);if(this.element=a({className:"ui-mobile-container",style:a.STYLE_NBODY+"z-index:99999;min-height:10px;"}).appendTo(!0).css({width:this.options.width+"px",height:this.options.height+"px","min-height":this.options.height+"px",position:"fixed",bottom:d.bottom+"px",right:d.right+"px"}),this.bgelement=a({className:"ui-mobile-background",style:a.STYLE_NBODY+"z-index:99998;display:none;background:#000;position:fixed;left:0;top:0;"}).appendTo(!0).css({width:a(window).width()+"px",height:a(window).height()+"px",opacity:.6}),b=a({tag:"UL",className:"ui-mobile-ul",style:a.STYLE_NBODY+"display:block;height:"+this.options.height+"px;list-style:none;"}).appendTo(this.element,!0),this.element.click(function(b){b=a.Event.fixEvent(b),c.clickElement(b)}),this.bgelement.click(function(b){b=a.Event.fixEvent(b),c.showElements(!1)}),this.options.childs.length){1==this.options.childs.length?this.createElement(b,0,this.options.childs[0]):(this.createElement(b,"",this.options.childs[0],"group"),a.each(this.options.childs,function(a,d){c.createElement(b,a,d,"item")}));var e=function(b){b=a.Event.fixEvent(b),c.bgelement.css({width:a(window).width()+"px",height:a(window).height()+"px"})};a.Event.addEvent(window,"resize",e,this.type)}},createElement:function(b,d,e,f){var g,h,i="ui-mobile-"+("group"===f?"default":e.type),j=a.sourceURI+"images/mobile/"+("group"===f?"6":++this.buttonCount)+".png",k=this.getStyle(e);return g=a({tag:"LI",className:i,style:a.STYLE_NBODY+"list-style:none;position:relative;left:0;"+("group"===f?"bottom:0;":"top:0px;")}).appendTo(b,"item"==f).attr("data-index",d).css(k).css("background","url("+j+") no-repeat center center"),h=a({tag:"A",href:c,style:a.STYLE_BODY+"position:relative;left:0;top:0;display:inline-block;color:#fff;"}).appendTo(g).css(k),e.name&&"group"!==f&&a({className:"ui-entrance-hover-show",style:a.STYLE_BODY+"padding:3px;height:20px;width:100px;text-align:right;overflow:hidden;color:#fff;position:absolute;right:auto;display:block;left:auto;top:"+(e.height-24)/2+"px;"}).appendTo(h).css(this.options.position.indexOf("right-")>-1?"right":"left",e.width+"px").html(e.name),"group"!==f?(g.attr("data-settingid",e.target),"item"==f&&g.display(0)):g.css({position:"absolute",bottom:"0px"}),this.buttonCount>=5&&(this.buttonCount=0),g},clickElement:function(b){for(var c=b.target;c.tagName&&"LI"!==c.tagName.toString().toUpperCase();)c=c.parentNode;if(a(c).indexOfClass("ui-mobile-default"))this.showElements("1"!==a(c).attr("data-display"));else if(a(c).indexOfClass("ui-mobile-button")){var d=a(c).attr("data-settingid")||"";d&&a.im_openInPageChat(d)}},showElements:function(b){var c=this;this.showing!==!0&&(this.showing=!0,b?this.bgelement.display(1).animate({opacity:{form:0,to:.6}},100,function(){c.element.find(".ui-mobile-button").css("left","90px").animate({display:"block",opacity:{form:0,to:1},left:{form:"90px",to:"0px"}},300,function(){c.showing=!1})}):this.element.find(".ui-mobile-button").animate({opacity:{form:1,to:0},left:{form:"0px",to:"90px"}},300,function(){a(this).display(0),c.bgelement.animate({opacity:{form:.6,to:0}},100,function(){a(this).display(0),c.showing=!1})}),this.element.find(".ui-mobile-default").attr("data-display",b?1:0))},getPosition:function(b,c,d){var e=a(window).width(),f=a(window).height(),g={left:0,top:0};if(c===this.CON_GLOBAL)switch(b.position){case"left-top":g.left=Math.min(e-b.width-10,Math.max(10,0+b.xoff)),g.top=Math.max(0,0+b.yoff);break;case"left-center":g.left=Math.min(e-b.width-10,Math.max(10,0+b.xoff)),g.top=Math.max(0,(f-b.height)/2)+b.yoff;break;case"left-bottom":g.left=Math.min(e-b.width-10,Math.max(10,0+b.xoff)),g.top=Math.max(0,f-b.height)+b.yoff;break;case"center-top":g.left=Math.max(0,(e-b.width)/2)+b.xoff,g.top=Math.max(0,(f-b.height)/2)+b.yoff;break;case"center-center":g.left=Math.max(0,(e-b.width)/2)+b.xoff,g.top=Math.max(0,(f-b.height)/2)+b.yoff;break;case"center-bottom":g.left=Math.max(0,(e-b.width)/2)+b.xoff,g.top=Math.max(0,f-b.height)+b.yoff;break;case"right-top":g.left=Math.min(e-b.width-10,Math.max(0,e-b.width+b.xoff)),g.top=0+b.yoff;break;case"right-bottom":g.left=Math.min(e-b.width-10,Math.max(0,e-b.width+b.xoff)),g.top=Math.max(0,f-b.height)+b.yoff;break;default:b.position="right-center",g.left=Math.min(e-b.width-10,Math.max(0,e-b.width+b.xoff)),g.top=Math.max(0,(f-b.height)/2)+b.yoff}else d?(g.left=b.x,g.top=b.y):(g.left=b.xoff,g.top=b.yoff);return g.right=e-g.left-b.width,g.bottom=f-g.top-b.width,g},getStyle:function(a){var b={};return b.width=a.width+"px",b.height=a.height+"px",b["line-height"]=a.height+"px",b["background-color"]="transparent",b}}}(nTalk);