!function(a,b){var c=function(){},d="javascript:void();";a.STYLE_BODY+="font-size:14px;",a.beijing_image=a.sourceURI+"images/wapTheme3/beijing.jpg",a.title_image=a.sourceURI+"images/wapTheme3/title.png";var e={title:"#fbc7a8",return_style:"&#xe618;",return_color:"#513727",close_style:"&#xe626;",close_color:"#513727",titlename:"#513727",background:"#f4f1ee",bubble:"#fbc7a8",bubble_text:"#fffff",timestamp:"#999999"},f=["@font-face {","font-family: iconfont;",'src: url("./fontIcon/iconfont.eot");','src: url("./fontIcon/iconfont.eot?#iefix") format("embedded-opentype"),','url("./fontIcon/iconfont.woff") format("woff"),','url("./fontIcon/iconfont.ttf") format("truetype"),','url("./fontIcon/iconfont.svg#iconfont") format("svg");',"}",".iconfont{",'font-family:"iconfont" !important;',"font-size:16px;font-style:normal;","-webkit-font-smoothing: antialiased;","-webkit-text-stroke-width: 0.2px;","-moz-osx-font-smoothing: grayscale;","}"].join(""),g=document.head||document.getElementsByTagName("head")[0],h=document.createElement("style");h.type="text/css",h.styleSheet?h.styleSheet.cssText=f:h.appendChild(document.createTextNode(f)),g.appendChild(h);var i={start:null,move:null,end:null},j=0,k=null,l=null,m=null,n=!1,o=!1,p=!1,q={},r=!1,s=!1,t=null,u=null,v=0,w=null,x={version:"1.0.0",date:"2015.10.19",toast:null,config:{tapMaxDistance:15,tapTime:200,holdTime:650,maxDoubleTapInterval:300,swipeTime:300,swipeMinDistance:20},events:{tap:"touchstart touchend",doubletap:"touchstart touchend",swipe:"touchmove touchend",pinch:"touchmove touchend"},record:{direction:null,swipedistance:null,swipeEl:null,holdEl:null},util:{hasTouch:"ontouchstart"in window,getFingers:function(a){return a.touches?a.touches.length:1},getDistance:function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)},getPosOfEvent:function(a){if(this.hasTouch){for(var b=[],c=null,d=0,e=a.touches.length;d<e;d++)c=a.touches[d],b.push({x:c.pageX,y:c.pageY});return b}return[{x:a.pageX,y:a.pageY}]},getAngle:function(a,b){return 180*Math.atan2(b.y-a.y,b.x-a.x)/Math.PI},getDirectionFromAngle:function(a){var b={up:a<-45&&a>-135,down:a>=45&&a<135,left:a>=135||a<=-135,right:a>=-45&&a<=45};for(var c in b)if(b[c])return c;return null},isTouchMove:function(a){return"touchmove"===a.type||"mousemove"===a.type},isTouchEnd:function(a){return"touchend"===a.type||"mouseup"===a.type||"touchcancel"===a.type},reset:function(){k=l=m=null,s=r=n=o=p=!1,i={}}},init:function(){var b=this,c=this.util,d="mouseup mousedown mousemove mouseout",e="touchstart touchmove touchend touchcancel",f=c.hasTouch&&a.browser.mobile?e:d;a.each(f.split(" "),function(c,d){switch(d){case"touchstart":case"mousedown":a.Event.addEvent(document,d,b.touchstart);break;case"touchmove":case"mousemove":a.Event.addEvent(document,d,b.touchmove);break;case"touchend":case"touchcancel":case"mouseup":case"mouseout":a.Event.addEvent(document,d,b.touchend)}})},touchstart:function(b){var c=b.target,d=x.util;j=Date.now(),(!i.start||i.start.length<2)&&(i.start=d.getPosOfEvent(b)),r=!0,k=b,q={};var e=c.getBoundingClientRect(),f=document.documentElement;q={top:e.top+(window.pageYOffset||f.scrollTop)-(f.clientTop||0),left:e.left+(window.pageXOffset||f.scrollLeft)-(f.clientLeft||0)},x.hold(b),x.fullScreen&&(a.Event.fixEvent(b).preventDefault(),a.Event.fixEvent(b).stopPropagation())},touchend:function(b){var c=x.util,d=x.record;r&&(m=b,n&&b.target==d.swipeEl?x.swipe(b):p&&b.target==d.holdEl?x.hold(b):x.tap(b),null===d.swipeEl&&null===d.holdEl&&c.reset(),1===c.getFingers(b)&&(r=!0),x.fullScreen&&(a.Event.fixEvent(b).preventDefault(),a.Event.fixEvent(b).stopPropagation()))},touchmove:function(b){try{navigator.control.gesture(!1)}catch(c){}var d=x.util,e=x.config;if(x.toast&&a.Event.fixEvent(b).preventDefault(),x.fullScreen&&(a.Event.fixEvent(b).preventDefault(),a.Event.fixEvent(b).stopPropagation()),r&&i.start)if(i.move=d.getPosOfEvent(b),d.getFingers(b)>=2);else{var f=d.getDistance(i.start[0],i.move[0]);f>e.tapMaxDistance&&x.swipe(b)}},tap:function(b){var c=b.target,d=Date.now(),e=this.util,f=this.config;if(i.start&&null===this.record.swipeEl&&null===this.record.holdEl){var g=e.getDistance(i.start[0],i.move?i.move[0]:i.start[0]),h=function(){if(w&&j-v<f.maxDoubleTapInterval){var a=e.getDistance(w,i.start[0]);if(a<16)return!0}return!1}();return h?(clearTimeout(u),void a.Event.fireEvent(c,"doubletap")):void(f.tapMaxDistance<g||f.holdTime>d-j&&e.getFingers(b)<=1&&(s=!0,v=d,w=i.start[0],u=setTimeout(function(){a.Event.fireEvent(c,"tap")},f.tapTime)))}},swipe:function(b){var c=b.target,d=Date.now(),e=this.util,f=this.config,g=d-j;if(!(!r||!i.move||e.getFingers(b)>1||this.record.swipe&&this.record.swipe!=c)){var h=e.getDistance(i.start[0],i.move[0]),k={x:i.move[0].x-q.left,y:i.move[0].y-q.top},l=e.getAngle(i.start[0],i.move[0]),m=e.getDirectionFromAngle(l),o={type:"swipe",originEvent:b,position:k,direction:m,distance:h,distanceX:i.move[0].x-i.start[0].x,distanceY:i.move[0].y-i.start[0].y,x:i.move[0].x-i.start[0].x,y:i.move[0].y-i.start[0].y,angle:l,duration:g,fingersCount:e.getFingers(b)};this.record.direction=m,this.record.distance=h;var p=function(){m&&a.Event.fireEvent(c,"swipe"+m)};n?e.isTouchMove(b)?(o.fingerStatus=o.swipe="move",a.Event.fireEvent(this.record.swipeEl,"swiping"),g>f.swipeTime&&g<f.swipeTime+50&&h>f.swipeMinDistance&&(p(),a.Event.fireEvent(this.record.swipeEl,"swipe"))):(e.isTouchEnd(b)||"mouseout"===b.type)&&(o.fingerStatus=o.swipe="end",a.Event.fireEvent(this.record.swipeEl,"swipeend"),f.swipeTime>g&&h>f.swipeMinDistance&&(p(),a.Event.fireEvent(this.record.swipeEl,"swipe")),this.record.swipeEl=null,this.record.holdEl=null):(o.fingerStatus=o.swipe="start",n=!0,this.record.swipeEl=b.target,a.Event.fireEvent(this.record.swipeEl,"swipestart"))}},hold:function(b){var c=b.target,d=this.util,e=this.config;self=this,this.record.holdEl&&this.record.holdEl!=c||("touchstart"==b.type?(clearTimeout(t),p=!1,t=setTimeout(function(){if(p=!0,i.start){var b=d.getDistance(i.start[0],i.move?i.move[0]:i.start[0]);e.tapMaxDistance<b||s||(self.record.holdEl=c,a.Event.fireEvent(c,"hold"))}},e.holdTime)):"touchend"==b.type?(a.Event.fireEvent(this.record.holdEl,"holdup"),this.record.swipeEl=null,this.record.holdEl=null):"touchcancel"==b.type&&(a.Event.fireEvent(this.record.holdEl,"holdcancel"),this.record.swipeEl=null,this.record.holdEl=null))}};a.fn.extend({tap:function(a){return this.bind("tap",a)},gesture:function(a,b){return this.bind(a,b)},editBackgroundPosition:function(a){var b=[0,0],c=/\-?[0-9]+\.?[0-9]*/g;this.css("background-position")&&(b=this.css("background-position").match(c)),a.x&&(b[0]=a.x),a.y&&(b[1]=a.y),this.css("background-position",b[0]+"px "+b[1]+"px")},textareaAutoHeight:function(b){return this._options={minHeight:0,maxHeight:1e3},this.init=function(){var c=this;a.each(b,function(a,b){c._options[a]=b}),0===this._options.minHeight&&(this._options.minHeight=parseFloat(a(this).height())),a.each(this._options,function(b,d){a(c).attr(b)||a(c).attr(b,d)}),a(this).bind("keyup",this.resetHeight).bind("change",this.resetHeight).tap(this.resetHeight),this.resetHeight.call(this.get(0))},this.resetHeight=function(b){var c=parseFloat(a(this).attr("minHeight")),d=parseFloat(a(this).attr("maxHeight"));a.browser.msie||a(this).height(0);var e=parseFloat(this.scrollHeight-20);if(e=Math.min(Math.max(e,c),d),a(this).css("height",e+"px").scrollTop(0),e>=d)a(this).css("overflow-y","scroll");else{a(this).css({"overflow-y":"hidden",height:"auto"});var f=parseFloat(this.scrollHeight-20);f=Math.min(Math.max(f,c),d),a(this).css("height",f+"px").scrollTop(0)}},this.init(),this}});var y=a.Class.create();y.prototype={name:"chatView",contains:null,loadElement:null,chatElement:null,messageElement:null,displayiFrame:null,chatHistory:null,objFile:null,objImage:null,_tempHeader:null,_chatsHeader:null,_chatsElement:null,_maxNumber:50,_sendKey:"Enter",_editorStart:0,_initFace:!1,_eventFunction:c,scroll:null,_listenTimeID:null,buttonSelectors:null,isZoom:!1,timeHash:{},timeArray:[],imageHash:{},audioMsgidHash:{},voiceLoadingInter:{},voicePlayInter:{},recordKfName:null,evalRepeatClick:!0,mode:null,options:null,siteid:"",settingid:"",initialize:function(b,c){return this.options=b,this.siteid=this.options.siteid,this.settingid=this.options.settingid,this.mode=c,this.buttonSelectors={face:"chat-view-face",image:"chat-view-image",audio:"chat-view-button-audio",file:"chat-view-file",history:"chat-view-history",loadhistory:"chat-view-load-history",evaluate:"chat-view-evaluate",capture:"chat-view-capture",capoptions:"chat-view-capture-options",csr:"chat-view-change-csr",manual:"chat-view-switch-manual",submit:"chat-view-submit",exp:"chat-view-exp",xiaonengver:"chat-view-xiaoneng-version"},this.mode?(x.init(),this._create(),this._bind(),void this._initAudio()):void a.Log("mode is null",3)},_create:function(){var b=this,c=+a(window).height()-92,d=e.background,f=/^#[0-9a-f]{6}$/i,g=(new Date).getTime(),h=f.test(d)?"background-color:"+d:"background-image:url("+d+"?"+g+");background-repeat:no-repeat;background-size:cover",i="44";this.contains=a(document.body),this.loadElement=a({className:"chat-view-load",style:a.STYLE_BODY+"width:100%;height:100%;"+h+";min-height:"+c+"px;display:block;text-align:center;position:relative;"}).appendTo(this.contains).html(this._getViewHtml("load")),this.chatElement=a({className:"chat-view-window",style:a.STYLE_BODY+"width:100%;/*min-height:"+c+"px;*/display:none;overflow-y:scroll;position:absolute;top:"+i+"px;bottom:50px;-webkit-overflow-scrolling:touch;overflow-x:hidden;"+h}).appendTo(this.contains).html(this._getViewHtml("window")),this.messageElement=a({className:"chat-view-message",style:a.STYLE_BODY+"width:100%;min-height:"+c+"px;display:none;position:absolute;top:"+i+"px;background-color:#F3F3F7;bottom:0px;-webkit-overflow-scrolling:touch;overflow-x:hidden"}).appendTo(this.contains).html(this._getViewHtml("message"));var j="1"==a.params.iframechat?"absolute":"fixed";this.bottomElement=a({className:"chat-view-window-bottom",style:a.STYLE_NBODY+"background:#fff;width:100%;height:auto;min-height:49px;border-top:1px solid #F9F9F9;z-index:886;position:"+j+";bottom:0px;background-color:#F9F9F9"}).appendTo(this.contains).html(this._getViewHtml("bottom")),this.displayiFrame=a({tag:"iframe",id:"chat-view-submit-iframe",name:"chat-view-submit-iframe",className:"chat-view-submit-iframe",style:a.STYLE_NBODY+"width:0px;height:0px;display:none;"}).appendTo(this.contains),this.contains.append(this._getViewHtml("alert")),this.chatHistory=this.chatElement.find(".chat-view-window-history");var k=function(){a.browser.android&&b.bottomElement.css({position:"fixed",bottom:"0px"})},l=setInterval(function(){k()},30);setTimeout(function(){clearInterval(l)},1e3),a(window).bind("touchmove",k).bind("touchend",function(c){for(var d=a(c.target);d;)"chat-view-window"==d.attr("class")&&b._showActionList(null,!0),d=d.parent();"textarea"!=c.target.tagName.toLowerCase()&&a.browser.iPhone&&setTimeout(function(){b.bottomElement.find("textarea")[0].blur()},300)}),a(window).bind("resize",function(){var c=a(window);b.callChatResize(c.width(),c.height())})},close:function(){this.contains.remove(),this.contains=null},minimize:function(){this.contains.css({width:(a.browser.msie&&a.browser.ieversion<=7?1:0)+"px",height:(a.browser.msie&&a.browser.ieversion<=7?1:0)+"px"})},maximize:function(){this.contains.css({width:"100%",height:"auto"})},switchUI:function(a){if(this.contains)switch(a){case this.mode.CON_VIEW_WINDOW:this.contains.find(".chat-view-load, .chat-view-message").display(),this.contains.find(".chat-view-window").display(1),this.contains.find(".chat-view-window-header").css("height","44px").display(1),this.contains.find(".chat-view-window-header-message-title").display(0),this.contains.find(".chat-view-window-bottom").display(1);break;case this.mode.CON_VIEW_MESSAGE:this.contains.find(".chat-view-load, .chat-view-window").display(),this.contains.find(".chat-view-message").display(1),this.contains.find(".chat-view-window-header").css("height","44px").display(1),this.contains.find(".chat-view-window-header-title").display(),this.contains.find(".chat-view-window-header-message-title").display(1),this.contains.find(".chat-view-window-bottom").display();break;case this.mode.CON_VIEW_ERROR:this.contains.find(".chat-view-window, .chat-view-message").display(),this.contains.find(".chat-view-load").display(1),this.contains.find(".chat-view-reload").display(1).tap(function(){window.location.reload()}),this.contains.find(".chat-view-load-icon, .chat-view-load-info").display(),this.contains.find(".chat-view-load-error").display(1).find("span"),this.contains.find(".chat-view-window-header").display(),this.contains.find(".chat-view-window-bottom").display();break;default:this.contains.find(".chat-view-reload").display(),this.contains.find(".chat-view-window, .chat-view-message").display(),this.contains.find(".chat-view-load").display(1),this.contains.find(".chat-view-load-error").display(),this.contains.find(".chat-view-load-icon, .chat-view-load-info").display(1),this.contains.find(".chat-view-window-header").display(),this.contains.find(".chat-view-window-bottom").display()}},showMessage:function(b,c){var d,e,f,g,h,i,j=this,k=1;for(e=[a.STYLE_NBODY+"list-style:none outside none;display:block;margin:0;padding:5px 10px 5px 10px;background:transparent;",a.STYLE_NBODY+"list-style:none outside none;display:block;margin:0;padding:5px 10px 5px 10px;background:transparent;",a.STYLE_NBODY+"list-style:none outside none;display:block;margin:0;padding:5px 10px 5px 10px;text-align:center;background:transparent;"];this.chatHistory.find("li[class]").length>=this._maxNumber;)this.chatHistory.find("li[class]").first().remove();switch(b){case"left":f=e[0],g=c.msgid;break;case"bottom":f=e[0],g="systembottom";break;case"right":f=e[1],g=c.msgid;break;case"goods":f=e[2],g="first";break;case"system":f=e[2]+"margin-top:20px;",g="system";break;case"info":f=e[2]+"margin-top:20px;",g=c.msgid;break;case"otherinfo":f=e[0],g=c.msgid;break;default:f=e[2]+"padding:0 10px;",g="first"}if(this.chatHistory.find("li."+g).length&&"system"!=g)"systembottom"==g&&this.chatHistory.find("li."+g).css("visibility","visible"),d=this.chatHistory.find("li."+g).html(this._getMessageHtml(b,this._contentFilter(c)));else if(c){if("system"===g&&this.chatHistory.find("li."+g).remove(),"first"===g&&this.chatHistory.find("ul li").length>1)h=this.chatHistory.find("li").eq(0);else if(i=this.chatHistory.find("li").eq(0-k),i.indexOfClass("first"))h=null;else{if(i.indexOfClass("systembottom")&&(k++,h=i,i=this.chatHistory.find("li").eq(0-k)),"system"===g&&this.mode.enterUserId){for(;i&&i.attr("userid")==this.mode.enterUserId&&!(k>=5);)k++,h=i,i=this.chatHistory.find("li").eq(0-k);this.mode.enterUserId=""}for(;i&&!i.indexOfClass("first")&&!i.indexOfClass("system")&&i.attr("localtime")&&k<=this.chatHistory.find("li").length&&parseFloat(i.attr("localtime"))>=c.localtime&&!(k>=5);)k++,h=i,i=this.chatHistory.find("li").eq(0-k)}var l;this.timeArray&&(l=1==c.history?this.timeArray[this.timeArray.length-1]:Math.max(this.timeArray[0],this.timeArray[this.timeArray.length-1]));var m=Math.abs(c.timerkeyid-l)<=3e5&&c.timerkeyid-l>0;this.timeArray&&m?c.showTime=!0:c.showTime=!1,(""!==c.msg&&9!==c.type||2==c.type||4==c.type||6==c.type)&&(m||this.timeArray.push(c.timerkeyid));try{d=a({tag:"li",className:g,localtime:c.localtime,userid:c.userid,style:f,history:c.history||"0"}).appendTo(this.chatHistory.find("ul"),h),d.insert(this._getMessageHtml(b,this._contentFilter(c)))}catch(n){a.Log(n,3)}"system"==g||/2|4/i.test(c.type)||d.find("a").click(function(b){if(!this.onclick){if(0===j.mode.config.waphref)j._addHrefOpenListener(b,this);else{var c=a(this).attr("_href")||a(this).attr("href");a.browser.iOS||(a(this).attr("_href",c).attr("target","").attr("href","###"),window.open(c))}return!1}}),1==c.type&&"left"==b&&this.chatHistory.find("li.systembottom").css("visibility","hidden")}else this.chatHistory.find("li."+g).remove();return this.setDescIcon(d,c.userid),"systembottom"==g&&(clearTimeout(this.inputTimerid),this.inputTimerid=null,this.inputTimerid=setTimeout(function(){j.chatHistory.find("li.systembottom").css("visibility","hidden")},3e3)),this.scrollBottom(),c&&1==c.type&&this.loadLinkContainer(c.msgid),c&&/^(1|2|4|6|13)$/i.test(c.type)&&this.updateMessage(c.msgid,c.type,c,"left"===b),g},removeMessage:function(a){this.chatHistory.find("."+a).remove()},updateMessage:function(b,c,f,g){var h=this,i=this.chatHistory.find("."+b).last(),j=i.find(".view-history-body").last(),k=e.bubble;switch(c+""){case"1":"string"==typeof f?this._showResend(b,f).tap(function(c){a.Event.fixEvent(c).stopPropagation(),a(this).parent().parent().display(),h.mode.resend(b)}):j.find(".ntalk-preview").length&&j.find(".ntalk-preview").each(function(b){var c=this,d=a(c).attr("sourceurl"),e="#image";a(c).attr("robotImg")&&(e="#robotImg#image"),a.require(d+e,function(b){if(b.error)a(c).display();else{var d=a.zoom(b,332,500);a(c).attr({width:d.width,height:d.height,src:b.src}).click(function(a){h._fullScreenImage(this)}).css({width:d.width+"px",height:d.height+"px",cursor:"pointer"})}})});break;case"13":var l,m=[],n=f.msg.item||f.msg.items||{};if(!n||a.isEmptyObject(n))return;n.url=n.url||d,n.name&&(m.push('<a style="'+a.STYLE_BODY+'color:#0479D9;font-weight:bold;"'),n.url&&m.push(a.browser.iOS?' href="'+n.url+'" target="_blank"':" onclick=\"window.open('"+n.url+"')\""),m.push(">"+n.name+"</a>")),a.each(n,function(b,c){a.isArray(c)?(c[1]=(b.indexOf("price")>-1&&n.currency&&(c[1]+"").indexOf(n.currency)<=-1?n.currency:"")+""+c[1],m.push('<div style="'+a.STYLE_BODY+'"><span>'+c[0]+(/zh_cn|zh_tw/i.test(a.lang.language)?"&#65306;":":")+"</span>"+c[1]+"</div>"),a.Log(c[0]+": "+c[1])):a.isObject(c)?(c.v=(b.indexOf("price")>-1&&n.currency&&(c.v+"").indexOf(n.currency)<=-1?n.currency:"")+""+c.v,m.push('<div style="'+a.STYLE_BODY+'"><span>'+c.k+(/zh_cn|zh_tw/i.test(a.lang.language)?"&#65306;":":")+"</span>"+c.v+"</div>"),a.Log(c.k+": "+c.v)):a.lang.goodsinfo[b]&&(c=(b.indexOf("price")>-1&&n.currency&&(c+"").indexOf(n.currency)<=-1?n.currency:"")+c,m.push('<div style="'+a.STYLE_BODY+'"><span>'+a.lang.goodsinfo[b]+" </span>"+c+"</div>"),a.Log(a.lang.goodsinfo[b]+""+c))}),n.imageurl&&a.require(n.imageurl+"#image",function(b){b.error||(l=a.zoom(b,150,145),h.chatHistory.find(".view-history-goods-image").html('<a href="'+n.url+'" target="_blank" style="'+a.STYLE_BODY+'"><img src="'+n.imageurl+'" width="'+l.width+'" height="'+l.height+'" style="'+a.STYLE_NBODY+"width:"+l.width+"px;height:"+l.height+'px;" /></a>')),h.scroll&&h.scroll.scrollBottom()}),h.scroll&&h.scroll.scrollBottom(),this.chatHistory.find(".view-history-goods-info").html(m.join(""));break;case"2":case"4":2==f.type&&1==f.emotion?a.require(f.sourceurl+"#image",function(b){if(b.error)a.Log("emotion file failure.",3),f.msgid&&h.removeMessage(f.msgid);else{var c=a.zoom(b,100,85);j.css({background:"none",cursor:"auto",height:c.height+"px",border:""}).html('<img src="'+f.sourceurl+'" sourceurl="'+f.sourceurl+'" width="'+c.width+'" height="'+c.height+'" style="'+a.STYLE_BODY+"width:"+c.width+"px;height:"+c.height+'px;vertical-align:middle;border-radius:5px;" />')}}):"COMPRESS"==f.status?this._showCompress(b):"UPLOADING"==f.status?this._showUploading(b,j):a.isNumeric(f)&&f>0&&f<=100||(f<0||f.error?(f==-1?this._transCancel(b):this._showFailure(b,g.etype),i.find(".view-history-progress").display()):a.isObject(f)&&f.url&&(this._showActionList(null,!0),h.imageHash[b]=0,2==c?a.require(f.url+"#image",function(c){if(c.error)a.Log("upload file failure.",3),j.css({background:"url("+a.imageicon+") no-repeat -350px -6px"}),j.html(""),j.css({border:"solid 0px #a1cce8"}),i.find(".view-chat-angle").display(0);else{var d=a.zoom(c,140,110);i.find(".view-chat-angle").display(1);var e=a.base.checkID(i.attr("userid"))<=1,g=i.attr("userid"),l=e&&g?"#FFFFFF":k,m=e&&g?"#ffffff":k;img_border=e&&g?"#ffffff":k,j.css({border:"1px solid "+m,padding:"0px",background:l,cursor:"pointer",height:d.height+"px"}).html('<img src="'+f.url+'" sourceurl="'+f.sourceurl+'" width="'+d.width+'" height="'+d.height+'" style="'+a.STYLE_NBODY+"vertical-align:middle;border:solid 1px #ffffff;border-color:"+img_border+';border-radius:5px;" />').find("img").tap(function(a){h._fullScreenImage(this,b)}),h.scrollBottom(),h._hideUploading(b),h.imageHash[b]=1}}):this._showDownload(b,g,f).tap(function(b){var c=f.sourceurl||f.url;return a.Event.fixEvent(b).stopPropagation(),h.displayiFrame.attr("src",c+"&rnd="+a.getTime()),!1}),i.find(".view-history-progress").display()));break;case"6":new a.Music(b,f.url,"audio/mpeg",f.duration||f.length,this.audioView,this.audioBindEvent,this.contains);break;default:j.html(f)}},loadLinkContainer:function(b){var c=this,d=this.chatHistory.find("."+b).last().find(".view-history-body").find(".ntalk-link-contains");d.length&&d.each(function(b,d){var e=a(d).attr("data-source"),f=a(d).attr("class");e&&c.mode.loadLink(e,"."+f.replace(/ntalk\-link\-contains\s+/gi,""))})},viewLinkContainer:function(b,c){var d,e=this,f=a(c);if("string"==typeof b)try{b=a.JSON.parseJSON(b)}catch(g){}f.css({margin:"5px","border-radius":"5px",border:"1px solid #CCC","background-color":"#FAFAFA",width:a.browser.mobile?"auto":"300px","max-width":a.browser.mobile?a(window).width()-150+"px":"300px"}),d=a({className:"link-image",style:a.STYLE_BODY+"margin:10px;background-color:#fff;width:77px;height:77px;overflow:hidden;float:left;display:inline-block;"}).appendTo(f),container=a({className:"link-container",style:a.STYLE_BODY+"overflow:hidden;zoom:1;"}).appendTo(f),a({className:"link-title",style:a.STYLE_BODY+"margin:24px 0 0 0;width:100%;height:24px;white-space:nowrap;text-overflow:ellipsis;-o-text-overflow:ellipsis;overflow:hidden;"}).appendTo(container).html(['<a href="',b.url,'" target="_blank">',a.enCut(b.title,30),"</a>"].join("")),b.description&&a({className:"link-desc",style:a.STYLE_BODY+"margin:5px 0 10px 0;width:100%;max-height:60px;overflow:hidden;"}).appendTo(container).html(a.enCut(b.description,96,1)+"&nbsp;"),a({className:"link-customer",style:a.STYLE_BODY+"margin:5px 0 10px 0;width:100%;max-height:60px;overflow:hidden;"}).appendTo(container).html(b.customer),a({className:"link-clear",style:a.STYLE_BODY+"clear:both;"}).appendTo(f),f.find("a").click(function(b){if(0===e.mode.config.waphref)e._addHrefOpenListener(b,this);else{var c=a(this).attr("_href")||a(this).attr("href");a.browser.iOS||(a(this).attr("_href",c).attr("target","").attr("href","###"),window.open(c))}}),d.css("margin-top",(f.height()-d.height())/2),a.require(b.imageurl+"#image",function(c){var e=a.zoom(c,75,75),f=(75-e.height)/2+"px "+(75-e.width)/2+"px";d.html(['<img src="',b.imageurl,'" style="',a.STYLE_NBODY,"margin:"+f+";width:"+e.width+"px;height:"+e.height+'px;"/>'].join(""))})},scrollBottom:function(){var b=Math.max(a(document.body).height()-a(window).height(),this.chatHistory.scrollHeight());a(this.chatElement).scrollTop(b)},suggest:function(b){var c=this,d=this.bottomElement.find(".chat-view-hidden-area .chat-view-suggest-list");d.find("ul li").remove(),a.each(b,function(b,e){a({tag:"LI",talk_index:b,className:"",style:CON_STYLE_PUBLIC_CONTENT+"padding:0 0 0 20px;list-style:none;line-height:28px;height:28px;overflow:hidden;cursor:pointer;"}).appendTo(d.find("ul")).html(e).hover(function(b){a(this).css({color:"#fff","background-color":"#4297e0"})},function(b){a(this).css({color:"#000","background-color":"#fafafa"})}).click(function(b){a.Event.fixEvent(b).stopPropagation();var e=parseFloat(a(this).attr("talk_index"))+1;c.mode.send({msg:e,botindex:"index"}),c.textEditor.val(""),d.css("display","none")})}),d.css({display:"block",width:a(window).width()-5+"px",top:-18-26*b.length+"px"})},displayStatusInfo:function(b,c,d,e){var f=this;c&&(this.chatElement.find(".chat-view-system-message").html(c),d&&this.chatElement.find(".chat-view-system-message").css(d)),b?((a.browser.iPhone6||a.browser.iPhone6Plus)&&this.chatElement.find(".chat-view-window-status-info").css({position:"absolute",top:"0px"}),this.chatElement.find(".chat-view-window-status-info").display(1),this.chatElement.find(".chat-view-system-close").display(e?1:0),this.chatElement.find(".chat-view-system-close").tap(function(a){f.displayStatusInfo(!1)})):this.chatElement.find(".chat-view-window-status-info").hide(function(){a(this).css({display:"none",opacity:1}),f.mode._Enableevaluation&&a(".chat-view-window-header-ev-close").display(1)})},showInputState:function(c){if(a.browser.iPhone?a(".chat-view-window-history").css("padding-bottom","80px"):a(".chat-view-window-history").css("padding-bottom","0px"),!this._inputStateTimeID||c!==b){c=c?c:-22;var d=this,e=this.chatHistory.find(".view-history-body-wait");e.html(a.lang.system_printing||"").css({position:"relative",width:"60px",left:"10px","font-size":"14px","line-height":"20px"}),a({tag:"span",style:"display:block; left: -24px; top:-20px; position:relative; width:20px; height:20px; background: url("+a.imageicon+") -110px -70px no-repeat"}).appendTo(e),a({id:"show-input-status-loading",tag:"span",style:"display:block; left: -14px; top:-38px; position:relative; width:20px; height:20px"}).html(this.loadingPoint?this.loadingPoint:"...").appendTo(e);var f=3;this._inputStatusLoadingInter||(this._inputStatusLoadingInter=setInterval(function(){d.loadingPoint="",f--;for(var b=0;b<f;b++)d.loadingPoint+=".";a("#show-input-status-loading").html(d.loadingPoint),f==-1&&(f=4)},1e3)),this._inputStateTimeID=setTimeout(function(){return e.length?(c=c<=-52?-22:c-10,e.css("background-position",c+"px -250px"),void d.showInputState(c)):(clearTimeout(d._inputStateTimeID),clearInterval(d._inputStatusLoadingInter),void(d._inputStateTimeID=null))},500)}},_showResend:function(a,b){var c=this.chatHistory.find("."+a).last();return c.find(".view-history-status").css("left","-50px").display(1),c.find(".view-history-status-loading").display(0),c.find(".view-history-status-icon").css("background-position","-228px -18px").display(1)},_showCancel:function(b,c){return this.chatHistory.find("."+b).last().find(".view-history-status").css("left",c?"-60px":"-110px").display(1),this.chatHistory.find("."+b).last().find(".view-history-status-icon").display(),this.chatHistory.find("."+b).last().find(".view-history-status-link").html('<span style="'+a.STYLE_BODY+'cursor:pointer;color:#005ffb;text-decoration:none;">'+a.lang.news_cancel_trans+"</span>").find("span")},_showDownload:function(b,c,d){var e=this.chatHistory.find("."+b).last(),f=d.sourceurl||d.url;return e.find(".view-history-body .view-download-icon").css("background","url("+a.imageicon+") no-repeat -57px -90px"),a.browser.iOS||e.find(".view-history-body a").css("visibility","visible"),a.browser.ua.indexOf("baidubrowser")>-1&&e.find(".view-history-body a").attr({target:"_blank",href:f}),e.find(".view-history-body a")},_toFileName:function(b){return b=b||"",a.enLength(b)<16?b:a.enCut(b,10)+".."+b.substr(b.length-4,4)},_showCompress:function(b){var c=this.chatHistory.find("."+b).last(),d=this.chatHistory.find("."+b+" .view-history-body"),e=c.find(".view-history-pic-status");d.css({background:"url("+a.imageicon+") no-repeat -350px -6px",border:"none"}),c.find(".view-chat-angle").display(0),e.display(1).html(a.lang.system_upload_compress)},_showUploading:function(b){var c=this,d=this.chatHistory.find("."+b).last(),e=d.find(".view-history-body");e.css({background:"url("+a.imageicon+") no-repeat -350px -6px",border:"none"}),d.find(".view-history-pic-status").display(1).html(a.lang.system_upload_start),d.find(".view-history-status").css({left:"-50px",top:"-40px"}).display(1),d.find(".view-history-status-icon").display(0),d.find(".view-history-status-loading").display(1),d.find(".view-chat-angle").display(0),setTimeout(function(){c._outTimeResend(b)},2e4)},_outTimeResend:function(b){var c=a("."+b),d=c.find(".view-history-body");c.find(".view-history-status-loading").display(0),c.find(".view-history-status-icon").display(0),c.find(".view-history-pic-status").html(a.lang.news_trans_failure),d.css("background-position","-350px -6px")},_hideUploading:function(a){var b=this.chatHistory.find("."+a).last();b.find(".view-history-status").display(0),b.find(".view-history-pic-status").display(0)},_showFailure:function(b,c){var d=this.chatHistory.find("."+b).last(),e=this.chatHistory.find("."+b+" .view-history-body");return d.find(".view-history-status-loading").display(0),d.find(".view-history-status-icon").display(0),d.find(".view-history-pic-status").display(1).html("TYPE"==c?a.lang.system_picture_error_type:a.lang.system_picture_error_size),e.css("background","url("+a.imageicon+") -350px -6px transparent")},_transCancel:function(b){return this.chatHistory.find("."+b).last().find(".view-history-status").css("left","-130px").display(1),this.chatHistory.find("."+b).last().find(".view-history-status-icon").display(1),this.chatHistory.find("."+b).last().find(".view-history-status-link").html(a.lang.news_trans_cancel)},_getPositionForTextArea:function(a){var b=0;if(document.selection){a.focus();var c=document.selection.createRange(),d=c.duplicate();for(d.moveToElementText(a),b=-1;d.inRange(c);)d.moveStart("character"),b++}else(a.selectionStart||"0"==a.selectionStart)&&(b=a.selectionStart);return b},_setCursorPosition:function(a,b){if(this._editorStart=b,a.setSelectionRange)a.focus(),a.setSelectionRange(b,b);else if(a.createTextRange){var c=a.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",b),c.select()}},_insertText:function(a){var b=this.textEditor.get(0),c=b.value||"",d=Math.min(c.length,this._editorStart);d=d<=0?c.length:d,a===!0?b.value=c.substr(0,d).replace(/\[[a-z]{2}\]$/,""):b.value=c.substr(0,d)+a+c.substr(d,c.length),this.sendButton.display(""!==b.value)},showDestInfo:function(b){var c,d,e,f=this,g=this.mode.hashDest.items(b);if(g)return a.Log("dest:"+a.JSON.toJSONString(g)),e=['<div class="alert-header" style="',a.STYLE_BODY,'height:44px;border-bottom:1px solid #ccc;">','<input type="button" class="alert-header-back" style="',a.STYLE_BODY,'padding:0 10px;margin:8px 0 8px 20px;cursor:auto;border-radius:3px;background:#0079fe;color:#fff;height:28px;line-height:28px;-webkit-appearance: none;" value="',a.lang.back_button_text,'" />',"</div>",'<div class="alert-body-info" style="',a.STYLE_NBODY,'margin:0 10px;padding:10px 0;border-bottom:1px solid #ccc;">','<div class="alert-body-icon" style="',a.STYLE_NBODY,"width:35px;height:35px;border:1px solid #cc;float:left;background:url(",a.imageicon,') no-repeat scroll -228px -18px;">',"</div>",'<div class="alert-body-name" style="',a.STYLE_BODY,'float:left;margin:20px 0 0 10px;">',g.name,"</div>",'<div style="',a.STYLE_NBODY,'clear:both;"></div>',"</div>",'<div class="alert-body-info" style="',a.STYLE_NBODY,'margin:0 10px;padding:10px 0;border-bottom:1px solid #ccc;">','<div class="alert-body-sign" style="',a.STYLE_BODY,'">',a.lang.dest_sign_text,":",g.sign,"</div>","</div>",'<div class="alert-body-bottom" style="',a.STYLE_NBODY,'margin:0 10px;padding:10px 0;text-align:center;">','<input type="button" class="alert-body-back" style="',a.STYLE_BODY,'padding:0 10px;cursor:auto;border-radius:3px;background:#0079fe;color:#fff;height:28px;line-height:28px;-webkit-appearance: none" value="',a.lang.send_button_text,'" />',"</div>"].join(""),this.evalDialog||(this.evalDialog=new a.DialogChat(e,{margin:0,border:0,style:{height:a(window).height()+"px"}})),c=this.evalDialog.container,a.require(g.logo+"#image",function(b){b.error?(f.contains.find(".alert-body-icon").css("background-image","url("+a.imageicon+")"),a.Log("load user logo failure",3)):(d=a.zoom(b,35,35),f.contains.find(".alert-body-icon").html('<img src="'+b.src+'" width="'+d.width+'" height="'+d.height+'" border="0" style="'+a.STYLE_NBODY+"margin:"+(35-d.height)/2+"px "+(35-d.width)/2+"px;width:"+d.width+"px;height:"+d.height+'px;" />'),f.contains.find(".alert-body-icon").css("background-image",""))}),c.find(".alert-header-back,.alert-body-back").tap(function(a){
f.evalDialog.close(),f.evalDialog=null}),c},createEvaluation:function(b,c,d,e,f){for(var g,h=this,i=0;i<b.length-1;i++)b[i].options=b[i].options.reverse();html=['<table border="0" cellpadding="0" cellspacing="0" style="',a.STYLE_NBODY,'margin:0px 0 5px 0;width:100%;">',a.FORM.createInput(b),'<tr style="',a.STYLE_NBODY,'">','<td style="',a.STYLE_NBODY,'">','<span style="',a.STYLE_NBODY,'display:inline-block;width:49%;text-align:center;padding:2px 0 10px 0;">','<input type="button" class="ntkf-alert-cancel" value="'+a.lang.evaluation_button_cancel+'" style="',a.STYLE_BODY,'text-align:center;width:72px;color:#a6a6a6;font:normal 14px/28px Arial,SimSun;background:#ffffff;border:solid 1px #cccccc;-webkit-appearance: none;border-radius: 5px;-webkit-border-radius: 5px;-moz-border-radius: 5px;-o-border-radius: 5px; -ms-border-radius: 5px;margin-left:20%;" />',"</span>",'<span style="',a.STYLE_NBODY,'display:inline-block;width:50%;text-align:center;padding:2px 0 10px 0;">','<input type="button" class="view-alert-submit" value="'+a.lang.evaluation_button_submit+'" style="',a.STYLE_BODY,'text-align:center;width:72px;color:#ffffff;font:normal 14px/28px Arial,SimSun;background:#35a3f0;border:solid 1px #35a3f0;-webkit-appearance: none;border-radius: 5px;-webkit-border-radius: 5px;-moz-border-radius: 5px;-o-border-radius: 5px; -ms-border-radius: 5px;margin-right:20%;" />',"</span>","</td></tr>","</table>"].join(""),this._hideScreenImage();var j=2==h.options.length?316:410,k=a(window).height()-j;this.evalDialog||(this.evalDialog=new a.DialogChat(html,{margin:"39 "+k,border:0,style:{"background-color":"#fbfbfb","border-radius":"5px",height:"auto"}})),g=this.evalDialog.container,this.evalDialog.options.resizeFunc=function(){var b={width:"100%","border-radius":"0",left:"0"};a.browser.iOS&&a(window).height()<=500?setTimeout(function(){g.css(a.merge(b,{top:"0"}))},6):a.browser.iOS&&a(window).height()>500&&a(window).height()<=570?setTimeout(function(){g.css(a.merge(b,{top:"60px"}))},6):a.browser.iPhone6?setTimeout(function(){g.css(a.merge(b,{top:"150px"}))},6):setTimeout(function(){g.css(a.merge(b,{top:"auto",bottom:"0"}))},6)},g.find(".ntkf-alert-cancel").tap(function(a){h.evalDialog.close(),h.evalDialog=null}),g.find("ul").css({margin:"19px 0 0 0",padding:"0 8%","text-align":"center"}),g.find("ul li.form-item").css({width:"20%",padding:"0"}),g.find("textarea").textareaAutoHeight({minHeight:52,maxHeight:180}).css({"background-color":"#fbfbfb",margin:"0 10% 5px 10%",padding:"10px 0","line-height":"17px",width:"80%",border:"1px solid #cecece"}).tap(function(b){a(this).css({outline:"none",border:"1px solid #32a8f5"});var c=setInterval(function(){g.scrollTop(g.scrollHeight())},200);setTimeout(function(){clearInterval(c)},1e3)}).bind("blur",function(){g.find("textarea").css("border","1px solid #cecece")}),g.find(".ntkf-alert-close").display(),g.find("li").each(function(b,c){a(c).find("input").length>0&&a(c).css({position:a(c).find("input[name=problem]").length>0?"static":"relative",height:a(c).find("input[name=problem]").length>0?"28px":"54px",color:"#d5d5d5"})}),g.find("input[type=radio][name=evaluation]").parent(3).find("div").eq(0).css({"border-bottom":"solid 1px #7C7C7C",margin:"",padding:"15px 0px 17px","font-size":"12px","line-height":"12px",color:"#666666"});var l=g.find("input[type=radio][name=problem]");if(l&&l.parent(3)&&l.parent(3).find("div").eq(0).css({margin:"20px 0",padding:"7px 0px 7px 0px","background-color":"#f5f5f5","font-size":"12px","line-height":"12px",color:"#8a8a8a"}),g.find("textarea").parent().find("div").css({margin:"20px 0",padding:"7px 0px 7px 0px","background-color":"#f5f5f5","font-size":"12px","line-height":"12px",color:"#8a8a8a"}),a.chat_radio_item=["1.png","2.png","3.png","4.png","5.png"],g.find("input[type=radio]").css({visibility:"hidden","margin-left":"30px"}).each(function(b,c){a(c).parent().tap(function(a){h._selectedRadio(g,c)}),c.id.indexOf("problem_")==-1&&(a(c).parent().find("label").css({"margin-top":"16px","font-size":"12px","text-align":"center",display:"block"}),a(c).parent().append('<div class="chat-radio-item" style="'+a.STYLE_NBODY+'position:absolute;left:25%;top:0px;width:30px;height:29px;"><img src="'+a.sourceURI+"images/wapValuate/"+a.chat_radio_item[b]+'" style="width:30px;height:29px;"></div>'),a(c).parent().append('<div class="chat-radio-checked" style="'+a.STYLE_NBODY+'position:absolute;left:25%;top:0px;width:30px;height:29px;background-color:yellow;opacity:0.3;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;-o-border-radius:50%; -ms-border-radius: 50%;"></div>'))}),problemElement=g.find("input[type=radio][name=problem]"),problemElement.length>0){var m=problemElement.parent(2).find("li");m.css({margin:"0px auto","text-align":"center",width:"33%"}).find("input").css({display:"none"}),m.find("label").css({padding:"5px 10px","border-radius":"7px","font-size":"12px","-webkit-border-radius":"7px","-moz-border-radius":"7px","-o-border-radius":"7px","-ms-border-radius":"7px",border:"1px solid #cecece"})}return g.find("input[type=radio][checked]").length&&g.find("input[type=radio][checked]").each(function(a,b){h._selectedRadio(g,b)}),a.FORM.bindFormEvent(b,g),g.find("input[type!=hidden],textarea").get(0).focus(),g.find(".view-alert-submit").click(function(b){a.Event.fixEvent(b).stopPropagation(),h.evalRepeatClick&&h.evalDialog&&(h.evalRepeatClick=!1,h.mode.submitEvaluationForm(function(){a.isFunction(f)&&f(),h.evalDialog.close(),h.evalDialog=null,h.evalRepeatClick=!0},function(){h.evalRepeatClick=!0}))}),this.evalDialog.resize(),this._showActionList(null,!0),a.browser.opera&&setTimeout(function(){window.scroll(0,a(document.body).height())},50),g},createEvaluationVersion2:function(b,c){var d=this;if(0==a(".nt-evaluation-wrapper").length){var e=new a.EvaluateView(b).evaluateHtml,f="nt-evaluation-wrapper",g="nt-evaluation-background",h='<div class="'+g+'" style="'+a.defaultMobileStyle[g]+'"></div>"',i='<div class="'+f+'" style="'+a.defaultMobileStyle[f]+'">'+e+"</div>";a(document.body).append(h),a(document.body).append(i),a.browser.iOS&&a("."+f).css("margin-top","-13rem"),a.EvaluateEvent.bindEvaluateEvent()}a("[nodeid=submit]").tap(function(b){a.Event.fixEvent(b).stopPropagation(),d.evalRepeatClick&&a(".nt-evaluation-wrapper").length>0&&(d.evalRepeatClick=!1,d.mode.submitEvaluationForm(function(){a.isFunction(c)&&c(),a(".nt-evaluation-wrapper").remove(),a(".nt-evaluation-background").remove(),d.evalDialog=null,d.evalRepeatClick=!0},function(){d.evalRepeatClick=!0}))}),a("[nodeid=cancel]").tap(function(b){a(".nt-evaluation-wrapper").remove(),a(".nt-evaluation-background").remove()})},createGiveupQueue:function(b,c,d,e){var f,g=this,h=['<table border="0" cellpadding="0" cellspacing="0" style="',a.STYLE_NBODY,'margin:0px 0 10px 0;width:100%;">','<tr style="',a.STYLE_NBODY,'">','<td style="',a.STYLE_BODY,'text-align:center;height:80px;">','<span style="',a.STYLE_BODY,'font-weight:bold;font-size:18px;color:#000;">',a.lang.system_giveup_wait,"</span>","</td></tr>",'<tr style="',a.STYLE_NBODY,'">','<td style="',a.STYLE_NBODY,'">','<span style="',a.STYLE_NBODY,'display:inline-block;width:49%;text-align:center;border-top:1px solid #cecece;border-right:1px solid #cecece;padding:2px 0;">','<input type="button" class="ntkf-giveup-cancel" value="'+a.lang.evaluation_button_cancel+'" style="',a.STYLE_BODY,'text-align:center;padding:5px 0;width:100%;color:#32a8f5;font:normal 14px/28px Arial,SimSun;background:#fbfbfb;-webkit-appearance: none;" />',"</span>",'<span style="',a.STYLE_NBODY,'display:inline-block;width:50%;text-align:center;border-top:1px solid #cecece;padding:2px 0;">','<input type="button" class="view-giveup-submit" value="'+a.lang.system_giveup_submit+'" style="',a.STYLE_BODY,'text-align:center;padding:5px 0;width:100%;color:#32a8f5;font:normal 14px/28px Arial,SimSun;background:#fbfbfb;-webkit-appearance: none;" />',"</span>","</td></tr>","</table>"].join("");return this._hideScreenImage(),this.giveupDialog||(this.giveupDialog=new a.DialogChat(h,{margin:50,border:0,style:{"background-color":"#fbfbfb","border-radius":"10px",minHeight:"100px",height:"auto"}})),f=this.giveupDialog.container,f.find(".view-giveup-submit").tap(function(b){a.Event.fixEvent(b).stopPropagation(),g.mode.manageMode.view._callEndSession(!0)}),f.find(".ntkf-giveup-cancel").tap(function(b){a.Event.fixEvent(b).stopPropagation(),g.giveupDialog.close(),g.giveupDialog=null}),f},_selectedRadio:function(b,c){var d=b.find("input[type=radio][name="+(c.name||"")+"]");d.parent(2).find("li").each(function(b,c){a(c).find("input").length&&(a(c).find("input[type=radio]").attr("checked",""),a(c).find("label").css("color","#d5d5d5"),a(c).find("input").attr("id").indexOf("problem_")!=-1?a(c).find("label").css({color:"#666666","background-color":"#ffffff","border-color":"#cecece"}):a(c).find(".chat-radio-checked").css("display","block"))}),a(c).attr("checked","checked"),c.id.indexOf("problem_")!=-1?a(c).parent().find("label").css({color:"#FFFFFF","background-color":"#32a8f5","border-color":"#32a8f5"}):(a(c).parent().find(".chat-radio-checked").css("display","none"),a(c).parent().find("label").css("color","#7b7b7b"))},createFileButton:function(a){this.objImage=this._createUpload(a,"uploadimage",this.bottomElement.find(".chat-view-image .chat-view-button-image"),10485760,"image/*")},_createUpload:function(b,c,d,e,f){var g=this,h={action:c,roomid:"T2D",siteid:this.mode.siteid,settingid:this.mode.settingid,charset:a.charset};return b.filetranserver?new a.Transfer({server:b.filetranserver+"/imageupload.php",name:"userfile",maxSize:e,accept:f||"*",params:h,onError:function(b){g._showActionList(null,!0,!0);var c=a.chatManage.get(h.settingid);c&&c.uploadFailure(h.action,b)},onChange:function(){g._showActionList(null,!0,!0)},callback:function(b){a.Log(h.settingid+"::jsonp: "+a.JSON.toJSONString(b));var c=a.chatManage.get(h.settingid);"startCompress"==b.status?c&&c.startCompress(h.action,b.oldfile):"startUpload"==b.status?b.compress?g._showUploading(c.uploadmsgid):c&&c.startUpload(h.action,b.oldfile):"error"==b?g._outTimeResend(c.uploadmsgid):b.result==-2||9==b.type?c&&c.uploadFailure(h.action,{name:b.name||"",etype:b.etype||"",error:b.error}):setTimeout(function(){c&&c.uploadSuccess(h.action,b)})}},d):null},_fullScreenImage:function(b,c){var d,e,f,g,h=this,i=this._createfullScreen(b),j=a(b).attr("sourceurl")||b.src;if(this.isZoom=!1,x.fullScreen=!0,a.Log(this.settingid+":chatView._fullScreenImage(), src:"+j,1),a(".view-full-background").css("opacity",.6),this.swipeend&&this.doubletap&&this.tap&&(i.removeEvent("swipeend",this.swipeend),i.removeEvent("doubletap",this.doubletap),i.removeEvent("tap",this.tap)),this.swipeend=function(b){var i=x.record;if(h.picShowToast&&(h.picShowToast.remove(),h.picShowToast=null),!h.isZoom)if("left"==i.direction&&i.distance>x.config.swipeMinDistance){var j=0;e=1e7;for(d in h.imageHash)f=parseInt(d.substr(0,c.length-1)),g=parseInt(c.substr(0,c.length-1)),f-g>0&&f-g<e&&(j=d,e=f-g);0===j?(h.picShowToast=new a.Toast('<div style="position: relative;width: 200px; height:30px; line-height: 30px;z-index:100; color: #FFF; top: 30px; left: 25px; text-align:center;font-weight:bold">'+a.lang.system_no_next_picture+"</div>",{width:250,height:90}),setTimeout(function(){h.picShowToast&&h.picShowToast.remove()},2e3)):h._fullScreenImage(a("."+j).find(".view-history-body").find("img"),j)}else if("right"==i.direction&&i.distance>x.config.swipeMinDistance){var k=0;e=-1e7;for(d in h.imageHash)f=parseInt(d.substr(0,c.length-1)),g=parseInt(c.substr(0,c.length-1)),f-g<0&&f-g>e&&(k=d,e=f-g);0===k?(h.picShowToast=new a.Toast('<div style="position: relative;width: 200px; height:30px; line-height: 30px;z-index:100; color: #FFF; top: 30px; left: 25px; text-align:center;font-weight:bold">'+a.lang.system_no_prev_picture+"</div>",{width:250,height:90}),setTimeout(function(){h.picShowToast&&h.picShowToast.remove()},2e3)):h._fullScreenImage(a("."+k).find(".view-history-body").find("img"),k)}},this.doubletap=function(b){return h.isZoom?(h.isZoom=!1,void a.require(j+"#image",function(b){var c=a(window).width(),d=a(window).height(),e=a.zoom(b,c-10,d);x.fullScreen=!1,i.find("td").html('<img src="'+j+'" width="'+Math.floor(e.width)+'" height="'+Math.floor(e.height)+'" style="'+a.STYLE_BODY+"width:"+Math.floor(e.width)+"px;height:"+Math.floor(e.height)+'px;margin:0 auto;" />')})):(h.isZoom=!0,void a.require(j+"#image",function(b){var c,d,e=b;i.find("td").html('<img id="zoomImage" src="'+j+'" width="'+Math.floor(e.width)+'" height="'+Math.floor(e.height)+'" style="'+a.STYLE_BODY+"width:"+Math.floor(e.width)+"px;height:"+Math.floor(e.height)+'px;margin:0 auto;;-ms-transform: translate3d(0px, 0px, 0px);-o-transform: translate3d(0px, 0px, 0px);-moz-transform: translate3d(0px, 0px, 0px);-webkit-transform: translate3d(0px, 0px, 0px);transform: translate3d(0px, 0px, 0px)" />'),xBorder=-(e.width-a(window).width()<0?0:(e.width-a(window).width())/2),yBorder=-(e.height-a(window).height()<0?0:(e.height-a(window).height())/2);var f=a("#zoomImage")[0];a("#zoomImage").bind("touchstart",function(b){a.Event.fixEvent(b).preventDefault();var e=[0,0],g=/\-?[0-9]+\.?[0-9]*/g;return f.style.transform?e=f.style.transform.match(g):f.style.webkitTransform?e=f.style.webkitTransform.match(g):f.style.msTransform?e=f.style.msTransform.match(g):f.style.mozTransform?e=f.style.mozTransform.match(g):f.style.oTransform&&(e=f.style.oTransform.match(g)),c=b.targetTouches[0].pageX-parseFloat(e[0]),d=b.targetTouches[0].pageY-parseFloat(e[1]),!1}).bind("touchmove",function(a){var b=a.changedTouches[0].pageY-d,e=a.changedTouches[0].pageX-c;return h.move(e,b,xBorder,yBorder),!1}),h.move(xBorder,yBorder,xBorder,yBorder),i.find("td").css("background","none")}))},this.tap=function(a){h.isZoom||h._hideScreenImage()},i.gesture("swipeend",this.swipeend),i.gesture("tap",this.tap),i.gesture("doubletap",this.doubletap),i.css("opacity",1).find(".view-full-close").tap(function(b){a.Event.fixEvent(b).stopPropagation(),a(this).css("background-color","#bf3127"),h._hideScreenImage()}),i.find(".view-full-download").display(),a.browser.oupeng?a(document).tap(function(b){27!=a.Event.fixEvent(b).keyCode}):a(document).bind("keypress",function(b){27==a.Event.fixEvent(b).keyCode&&h._hideScreenImage()}),a(window).bind("resize",function(b){a(".view-full-background,.view-full-iframe,.view-full-container").css({width:a(window).width()+"px",height:a(window).height()+"px"})}),i.find("img").attr("src")!=j){a(".big-image-loading").display(1);var k=new a.GifTimer({allTime:1e4,doTime:125,x:-14,inTimeFunc:function(){this.options.x-=32,a(".big-image-loading").editBackgroundPosition({x:this.options.x}),this.options.x==-238&&(this.options.x=18)},outTimeFunc:function(){}});a.require(j+"#image",function(b){var c=a(window).width(),d=a(window).height(),e=a.zoom(b,c-10,d);a(".big-image-loading").display(0),k.remove(),k=null,i.find("td").append('<img src="'+j+'" width="'+Math.floor(e.width)+'" height="'+Math.floor(e.height)+'" style="'+a.STYLE_BODY+"width:"+Math.floor(e.width)+"px;height:"+Math.floor(e.height)+'px;margin:0 auto;" />')})}},move:function(b,c,d,e){b>0&&(b=0),b<2*d&&(b=2*d),c>0&&(c=0),c<2*e&&(c=2*e);var f=b+"px",g=c+"px",h=a("#zoomImage")[0].style;h.transform?h.transform="translate("+f+", "+g+")":h.webkitTransform?h.webkitTransform="translate("+f+", "+g+")":h.msTransform?h.msTransform="translate("+f+", "+g+")":h.mozTransform?h.mozTransform="translate("+f+", "+g+")":h.oTransform&&(h.oTransform="translate("+f+", "+g+")")},_addHrefOpenListener:function(b,c){var d=a(c).attr("_href")||a(c).attr("href");if(a.Event.fixEvent(b).preventDefault(),a.Event.fixEvent(b).stopPropagation(),d)return this._createShowWebIframe(d),!1},_createShowWebIframe:function(b){var c=this;a(window).width(),a(window).height()-42;a(".view-website-iframe").length||a({tag:"iframe",className:"view-website-iframe",style:"display:none; left:0px; top:42px; right:0px; bottom: 0px"}).appendTo(!0).fixed(),c.header||(c.header=a(".chat-view-window-header"));var d=a(".view-website-iframe");d.attr("src",b),d.css({width:"100%",height:"100%",left:0,right:0,bottom:0,top:"0","padding-top":"55px","background-color":"white",border:"none","z-index":"888",display:"block"}),this.recordKfName=c.header.find(".chat-view-window-header-title").html(),c.mode._Enableevaluation&&c.header.find(".chat-view-window-header-ev-close").display(0),c.header.find(".chat-view-window-header-message-title").html(a.lang.chat_show_website).display(1),c.header.find(".chat-view-window-header-back").css("display","none"),c.header.find(".chat-view-window-header-close").html("X").css({background:"",border:"none",color:"white"}).click(function(){c.contains.find(".view-website-iframe").remove(),c.header.find(".chat-view-window-header-message-title").html("").display(0),c.header.find(".chat-view-window-header-back").display(1),c.header.find(".chat-view-window-header-close").display(0),c.mode._Enableevaluation&&c.header.find(".chat-view-window-header-ev-close").display(1)}).display(1)},createMessageForm:function(b,c,d,f){var g,h=this,i=e.timestamp,j=e.titlename;if(!this.messageElement.find(".chat-view-message-table table").length){for(g=0;g<b.length;g++)b[g]=a.extend(b[g],{defaultText:b[g].required?b[g].defaultText+a.lang.message_no_null_char:b[g].defaultText,titlewidth:/zh_cn|en_us/gi.test(a.lang.language)?"80px":"140px",input:{height:"textarea"==b[g].type?"140px":"auto"},messageid:"chat-view-message-"+b[g].name});for(this.messageElement.find(".chat-view-message-table").html(['<table cellspacing="0" cellpadding="0" border="0" style="'+a.STYLE_NBODY+'width:100%;">','<tbody style="'+a.STYLE_NBODY+'">','<tr style="'+a.STYLE_NBODY+'"><td colspan="',a.browser.mobile?1:2,'" style="'+a.STYLE_BODY+"padding:0 0 15px 0;color:"+i+';vertical-align:top;">',d,"</td></tr>",c?"":[a.FORM.createInput(b),'<tr style="'+a.STYLE_NBODY+'">',a.browser.mobile?"":'<td style="'+a.STYLE_NBODY+'"></td>','<td style="'+a.STYLE_BODY+'padding:20px 0px 0px;color:#090;">','<input type="button" class="chat-view-button chat-view-submit-submit" value="'+a.lang.message_button_submit+'" style="'+a.STYLE_BODY+'font-size:16px;padding:0 20px;background:#32A8F5;line-height:50px;color:#fff;height:50px;width:90%;border-radius:5px;text-align:center;-webkit-appearance: none">','<span class="submit_message_complete" style="'+a.STYLE_BODY+'color:#090;display:none;">',a.lang.message_success,"</span>","</td></tr>"].join(""),"</tbody></table>"].join("")),this.header||(this.header=a(".chat-view-window-header")),this.titleEl||(this.titleEl=a(".chat-view-window-header-message-title")),this.messageElement.find("input[name=myuid]").val(f.myuid),this.messageElement.find("input[name=destuid]").val(f.destid),this.messageElement.find("input[name=ntkf_t2d_sid]").val(f.sessionid),this.messageElement.find("input[name=source]").val(f.source),this.header.css({height:"44px","background-color":"#EBEBED"}),this.titleEl.display(1).html(a.lang.system_leave_message).css({color:j}),this.messageElement.find("input[type=text],textarea").css({"font-size":"12px",border:"1px solid #E9E9E9",padding:"8px 2%",color:"#7C7C7C",background:"#FFFFFF",width:"96%","margin-top":"8px"}),g=0;g<b.length;g++)"textarea"==b[g].type&&a({className:"textarea-"+b[g].name,maxsize:b[g].max,style:a.STYLE_BODY+"font-size:16px;font-weight:bold;color:#ccc;float:right;position:static;right:15px;top:310px;"}).appendTo(this.messageElement.find("table textarea[name="+b[g].name+"]").parent()).html("0/"+b[g].max);return this.messageElement.find("table textarea").css("padding-right","10px").bind("keyup",function(b){var c="table .textarea-"+a(this).attr("name"),d=a.enLength(a(this).val())+"/"+h.messageElement.find(c).attr("maxsize");h.messageElement.find(c).html(d)}),this.messageElement.find(".chat-view-submit-submit").show(function(){a(this).css("display",a.browser.oldmsie?"inline-block":"block")}),this.messageElement.find(".submit_message_complete").display(),a.FORM.bindFormEvent(b,this.messageElement),this.messageElement.find(".chat-view-submit-submit").click(function(a){h.mode.submitMessageForm()}),this.messageElement.find("textarea").val(f.content),this.messageElement.find(".textarea-msg_content").css("font-size","12px"),this.messageElement.find(".chat-view-message-table")}},submitMessageForm:function(b,c){var d=this;a.FORM.verificationForm(b,function(){d.messageElement.find(".chat-view-message-form").attr("action",c),d.messageElement.find(".chat-view-message-form").get(0).submit(),a.Log("chatView.submitMessageForm complete",1),d.messageElement.find("input[type=text],textarea,select").attr("disabled",!0),d.messageElement.find(".chat-view-submit-submit").display();var b=new a.Toast('<div style="position: relative;width: 200px; height:30px; line-height: 30px;z-index:100; color: #FFF; top: 30px; left: 25px; text-align:center;font-weight:bold">'+a.lang.message_success+"</div>",{width:250,height:90});setTimeout(function(){b.remove(),element.get(0).focus()},2e3)},this.messageElement)},_hideScreenImage:function(b){a(".view-full-container").animate({opacity:{from:1,to:0}},500),a(".view-full-background").animate({opacity:{from:.6,to:0}},500,function(){a(".view-full-iframe,.view-full-background,.view-full-container").remove()}),x.fullScreen=!1},_createfullScreen:function(){var b=a(window).width(),c=a(window).height();return a(".view-full-iframe").length||a({tag:"iframe",className:"view-full-iframe",style:a.STYLE_NBODY+"display:none;width:"+b+"px;height:"+c+"px;"}).appendTo(!0).fixed(),a(".view-full-background").length?a(".view-full-background").display(1):a({className:"view-full-background",style:a.STYLE_BODY+"background:#000;opacity:0.6;filter:alpha(opacity=60);width:"+b+"px;height:"+c+"px;position:absolute;top:0;left:0;z-index:1500;"}).appendTo(!0).fixed(),a(".view-full-container").length?(a(".view-full-container img").remove(),a(".view-full-container").display(1)):a({className:"view-full-container",style:a.STYLE_BODY+"width:"+b+"px;height:"+c+"px;text-align:center;position:absolute;top:0px;left:0;z-index:3000;overflow:hidden;transform: translate3d(0px, 0px, 0px)"}).appendTo(!0).html(['<table style="'+a.STYLE_BODY+'margin:auto;width:100%;height:100%;">','<tbody style="'+a.STYLE_BODY+'">','<tr style="'+a.STYLE_BODY+'">','<td valign="middle" align="center" style="'+a.STYLE_BODY+'width:100%;vertical-align:middle;text-align:center;">','<div class="big-image-loading" style="width:32px;height:32px;margin-left:',(a(window).width()-32)/2,"px;background:url(",a.imageicon,') no-repeat -14px -121px;"></div>',"</td></tr></tbody></table>",'<span class="view-full-close" style="'+a.STYLE_BODY+"position:absolute;width:32px;height:32px;border-radius:50%;color:#ccc;margin:10px 15px 0 0;top:0;right:0;cursor:pointer;background:#df3b31 url(",a.imageicon,') no-repeat scroll -201px -56px;z-index:3000;display:none;"></span>','<span class="view-full-download"  style="'+a.STYLE_BODY+"position:absolute;width:28px;height:28px;color:#ccc;margin:20px 20px 0 0;top:0;right:50px;cursor:pointer;background:url(",a.imageicon,') no-repeat scroll -144px -244px;z-index:3000;"></span>'].join("")).fixed(),a(".view-full-container")},_getMessageHtml:function(b,c){var d=e.bubble,f=e.bubble_text,g=e.timestamp;return 7==c.type&&(c.type=1),"right"===b?['<table style="',a.STYLE_NBODY,'float:right;_float:none;width:100%;margin:4px 0 0 0;" class="view-history-right" cellpadding="0" cellspacing="0" border="0" class="table">','<tbody style="',a.STYLE_NBODY,'text-align:center;">','<tr><td style="',a.STYLE_BODY,'text-align:center;">',c.showTime?"":['<span class="view-history-time" style="',a.STYLE_BODY,";color:"+g+';font-size:12px;line-height:26px;">',this.formatMessageTime(c.timerkeyid),"</span>"].join(""),"</td></tr>","</tbody>","</table>",'<table style="',a.STYLE_NBODY,'float:right;_float:none;" class="view-history-right" cellpadding="0" cellspacing="0" border="0" class="table">','<tbody style="',a.STYLE_NBODY,'text-align:right;">',"<tr>",'<td class="view-history-send-tbody" style="',a.STYLE_BODY,'">',4==c.type?['<div class="view-history-body" type="',c.type,'" style="',a.STYLE_NBODY,"word-break:break-all;word-wrap:break-word;padding:8px;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-left-radius:5px;border-radius:5px;background:"+d+";border:1px solid #a1cce8;border-color:"+d+'">','<div class="view-download-icon" style="',a.STYLE_BODY,'margin:5px 0;float:left;width:20px;height:20px;"></div>','<span style="',a.STYLE_BODY,'float:left;margin:5px;line-height:160%;">',c.oldfile+' <a href="javascript:void(0);"'+(c.url?' url="'+c.url+'" style="'+(c.url?"":"visibility:hidden;")+'"':"")+">"+a.lang.news_download+"</a>","</span>","</div>"].join(""):6==c.type?['<div class="view-history-body" type="',c.type,'" style="',a.STYLE_NBODY,'">','<div class="view-history-audio" style="',a.STYLE_BODY,"float:left;min-width:1px;height:30px;line-height:30px;overflow:hidden;padding-left:6px;padding-right:40px;background:"+d+";border:1px solid #a1cce8;border-color:"+d+';border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-left-radius:5px;border-radius:5px;">','<div class="view-audio-voice" style="position:relative; right:-40px; height:40px;line-height:40px">','<svg width="32px" height="32px">','<path d="M17 6 C 11 12, 11 20, 17 26" stroke="#55a2d5" fill="transparent" stroke-width="2"></path>','<path d="M20 10 C 16 14, 16 18, 20 22" stroke="#55a2d5" fill="transparent" stroke-width="2"></path>','<path d="M24 12 C 21 14, 21 18 24 20" stroke="#55a2d5" fill="transparent" stroke-width="2"></path>',"</svg>","</div>",'<div class="view-audio-voice-duration" style="position:relative; right:0px; top:-44px;height:40px;line-height:40px">',"</div>","</div>","</div>"].join(""):['<div class="view-history-body" type="',c.type,'" style="',a.STYLE_BODY,"line-height:160%;",2==c.type?"color:"+f+";text-align:center;display:table-cell;*display:inline-block;vertical-align:middle;width:75px;height:75px;*font-size:0px;*line-heihgt:0px;*font-family:Arial;padding:2px;background:none;border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-left-radius:5px;":"display:block;","word-break:break-all;word-wrap:break-word;padding:6px;color:"+f+";background:"+d+";border:1px solid #a1cce8;border-color:"+d+';border-top-left-radius:5px;border-top-right-radius:5px;border-bottom-left-radius:5px;margin-left:50px;">',/^(1|9)$/i.test(c.type)?c.msg:/^2$/i.test(c.type)&&c.oldfile?c.oldfile:"","</div>",'<div class="view-history-pic-status" style="position: relative; top: -24px; font-size:12px;margin:0px; left:-2px; padding:0px; text-align:center; display:none"></div>'].join(""),'<span class="view-chat-hidden-area" style="',a.STYLE_NBODY,'float:left;width:1px;height:1px;overflow:visible;position:relative;">','<div class="view-history-status" style="',a.STYLE_BODY,'display:none;color:#010002;line-height:22px;width:150px;*width:130px;_width:130px;position:absolute;left:-50px;top:-25px;">','<div class="view-history-status-icon" style="',a.STYLE_NBODY,"float:left;display:block;width:35px;height:35px;position:absolute;top:",2==c.type||6==c.type?"-50":"-5","px;left:",2==c.type||6==c.type?"20":"40","px;background:url(",a.imageicon,') no-repeat -228px -18px;"></div>','<img class="view-history-status-loading" src="',a.sourceURI+"images/m-loading.gif",'" style="',a.STYLE_NBODY,'float:left;display:block;width:22px;height:22px;position:absolute;top:-50px;left:30px"></img>','<div class="view-history-status-link" style="',a.STYLE_BODY,'float:left;margin-top:10px;"></div>',"</div>","</span>","</td>","</tr>","<tr>",2==c.type?['<td class="view-chat-angle" valign="top" style="display:none;float:right;position:relative;top:-1px;right:0;">','<svg height="5px" width="7px" id="svg" >','<path d="M0,0 L7,0 L7,5 C5,4 2,1 0,0" style="stroke-width:1;fill:'+d+";stroke:"+d+';"/>',"</svg>","</td>"].join(""):['<td valign="top" style="float:right;position:relative;top:-1px;right:0;">','<svg height="5px" width="7px" id="svg" >','<path d="M0,0 L7,0 L7,5 C5,4 2,1 0,0" style="stroke-width:1;fill:'+d+";stroke:"+d+';"/>',"</svg>","</td>"].join(""),"</tr>","</tbody>","</table>",'<br style="',a.STYLE_NBODY,'clear:both;" />'].join(""):/left|bottom/gi.test(b)?['<table style="',a.STYLE_NBODY,'margin:4px 0 0 0;width:100%;" class="view-history-left" cellpadding="0" cellspacing="0" border="0" class="table">','<tbody style="',a.STYLE_NBODY,'text-align:center;">','<tr><td style="',a.STYLE_BODY,'text-align:center;">',"bottom"==b||c.showTime?"":['<span class="view-history-time" style="',a.STYLE_BODY,"color:"+g+';font-size:12px;line-height:26px;">',this.formatMessageTime(c.timestamp||c.timerkeyid),"</span>"].join(""),c.userid&&!this.mode.isVisitor(c.userid)&&this.mode.dest.id!=c.userid?['<span class="view-history-destname" style="',a.STYLE_BODY,'margin-left:10px;color:#b9b9c1;line-height:26px;">',c.name,"<span>"].join(""):"","</td></tr>","</tbody>","</table>",'<table style="',a.STYLE_NBODY,'float:none;" class="view-history-left" cellpadding="0" cellspacing="0" border="0" class="table">','<tbody style="',a.STYLE_NBODY,'">',"<tr>",['<td valign="top" class="view-chat-angle" style="width:auto;',2==c.type?"display:none;":"",'">','<svg height="5px" width="7px" id="svg" >','<path  d="M0,0 L0,5 L7,5 C5,4 2,1 0,0" style="stroke-width:1;fill:#ffffff;stroke:#ffffff;"/>',"</svg>","</td>"].join(""),"</tr>","<tr>",'<td class="view-history-receive-tbody" style="',a.STYLE_BODY,'">',4==c.type?['<div class="view-history-body" style="',a.STYLE_BODY,'word-break:break-all;word-wrap:break-word;border-top-right-radius:5px;border-bottom-left-radius:5px;border-bottom-right-radius:5px;padding:8px 0;background:white;border:1px solid #ffffff;">','<div style="',a.STYLE_NBODY,'margin:0 8px;height:auto;clear:both;">','<div style="',a.STYLE_NBODY,'float:left;width:42px;height:42px;background-color:#1294e2;text-align:center;border-radius: 5px;-webkit-border-radius: 5px;-moz-border-radius: 5px;-o-border-radius: 5px; -ms-border-radius: 5px;">','<span style="',a.STYLE_BODY,'color:#ffffff;line-height:42px;font-size:14px;text-align:center;">',c.oldfile.substring(c.oldfile.lastIndexOf(".")+1),"</span>","</div>",'<span style="',a.STYLE_BODY,'padding:5px 0 5px 8px;line-height:42px;color:#999999;max-width:px;">',c.oldfile," </span>","</div>",a.browser.iOS?[""].join(""):['<div style="',a.STYLE_BODY,'margin-top:8px;border-top:solid 1px #cccccc;height:30px;text-align:center;line-height:40px;"><a style="color:#1294e2;text-decoration:none;" href="javascript:void(0);" url="',c.url,'">',a.lang.news_download,"</a></div>"].join(""),"</div>"].join(""):['<div class="view-history-body" type="',c.type,'" style="',a.STYLE_BODY,"",2==c.type?"color:#6C6C6C;text-align:center;display:table-cell;*display:inline-block;vertical-align:middle;width:75px;height:75px;*font-size:0px;*line-heihgt:0px;*font-family:Arial;":"display:block;",'word-break:break-all;word-wrap:break-word;padding:6px;background:white;border-top-right-radius:5px;border-bottom-left-radius:5px;border-bottom-right-radius:5px;color:#6C6C6C;border:1px solid #ffffff;margin-right:52px">',/^(1|9)$/i.test(c.type)?c.msg:"","</div>"].join(""),'<span class="view-chat-hidden-area" style="',a.STYLE_NBODY,'float:right;width:1px;height:1px;overflow:visible;position:relative;">','<div class="view-history-status" style="',a.STYLE_BODY,'display:none;color:#010002;line-height:22px;width:150px;*width:130px;_width:130px;position:absolute;left:10px;top:25px;">','<div class="view-history-status-icon" style="',a.STYLE_NBODY,"margin:5px 3px;float:left;display:block;width:10px;height:10px;background:url(",a.imageicon,') no-repeat -228px -18px"></div>','<div class="view-history-status-loading" style="',a.STYLE_NBODY,"margin:5px 3px;float:left;display:block;width:10px;height:10px;background:url(",a.imageicon,') no-repeat -14px -121px;"></div>','<div class="view-history-status-link" style="',a.STYLE_BODY,'float:left;">',2==c.type||4==c.type?['<a href="javascript:void(0);">',a.lang.news_download,"</a>"].join(""):[""].join(""),"</div>","</div>","</span>","</td>","</tr>","</tbody>","</table>",'<br style="',a.STYLE_NBODY,'clear:both;" />'].join(""):"first"===b?['<div class="view-history-system" style="',a.STYLE_BODY,'height:20px;line-height:180%;marign:0 auto;text-align:center;word-break:break-all;word-wrap:break-word;display:none;">',c.msg,"</div>",'<br style="',a.STYLE_NBODY,'clear:both;" />'].join(""):"goods"===b?['<table style="',a.STYLE_NBODY,'width:100%;border-radius:10px;margin:10px 0;border:1px solid #ccc;" class="view-history-goods" cellpadding="0" cellspacing="0" border="0" class="table">','<tbody style="',a.STYLE_NBODY,'text-align:center;">',"<tr>",'<td style="',a.STYLE_NBODY,'width:50%;text-align:center;">','<div class="view-history-goods-image" style="',a.STYLE_NBODY,'text-align:center;margin:0 auto;width:150px;height:145px;">','<div style="',a.STYLE_NBODY,"background:url(",a.imageicon,') no-repeat -110px -172px;width:85px;height:67px;margin:42px 39px"></div>',"</div>","</td>",'<td class="view-history-goods-info" style="',a.STYLE_BODY,'width:50%;text-align:left;"></td>',"</tr>","</tbody>","</table>",'<br style="',a.STYLE_NBODY,'clear:both;" />'].join(""):['<div class="view-history-system" style="',a.STYLE_NBODY,'marign:20px 0;text-align:center;color:#706E6F;">','<fieldset style="',a.STYLE_NBODY,'text-align:center;border:0;border-top:0px solid #ccc;">','<legend style="',a.STYLE_BODY,'padding:0 10px;text-align:center;word-break:break-all;border-radius:10px;word-wrap:break-word;color:#464647;background-color:#E0E0E4;width:auto;" align="center">',c.msg,"</legend>","</fieldset>","</div>",'<br style="',a.STYLE_NBODY,'clear:both;" />'].join("");
},_getViewHtml:function(b){a.face_image=a.sourceURI+"images/wapTheme2/xiaolian.png",a.face_image1=a.sourceURI+"images/wapTheme2/xiaolian1.png",a.button_action_image=a.sourceURI+"images/wapTheme2/tianjia.png",a.button_action_image1=a.sourceURI+"images/wapTheme2/tianjia1.png",a.evaluate_image=a.sourceURI+"images/wapTheme2/pingjia.png",a.evaluate_image1=a.sourceURI+"images/wapTheme2/pingjia1.png",a.pic_image=a.sourceURI+"images/wapTheme2/image.png",a.pic_image1=a.sourceURI+"images/wapTheme2/image1.png",a.audio_image=a.sourceURI+"images/wapTheme2/yuyin.png",a.audio_image1=a.sourceURI+"images/wapTheme2/yuyin1.png",a.jianpan_image=a.sourceURI+"images/wapTheme2/jianpan.png",a.jianpan_image1=a.sourceURI+"images/wapTheme2/jianpan1.png";var c=e.bubble,d=e.bubble_text;return"load"==b?['<div class="chat-view-load-icon" style="',a.STYLE_NBODY,"margin:0 auto;width:30px;height:33px;background:url(",a.imageicon,') no-repeat -14px -121px;"></div>','<div class="chat-view-load-info" style="',a.STYLE_BODY,'text-align:center;">',a.lang.chat_info_loading,"</div>",'<div class="chat-view-reload" style="',a.STYLE_BODY,"text-align:center;width:50px;height:50px;top:35%;position:absolute;display:none;background: url(",a.imageicon,") -323px -108px no-repeat; left:",(a(window).width()-50)/2,'px"></div>','<div class="chat-view-load-error" style="',a.STYLE_BODY,'text-align:center;width:100%;min-height:200px;height:100%;top:45%;position:absolute;display:none;color:#A4A4A5;background-color:#F3F3F3">',a.lang.system_config_error,'<!--<span style="',a.STYLE_BODY,'cursor:pointer;color:#005ffb;text-decoration:none;">',a.lang.chat_info_reload,"</span>--></div>"].join(""):"window"===b?['<div class="chat-view-window-status-info" style="',a.STYLE_BODY,"overflow:hidden;background:#f9efda;width:100%;line-height:55px;height:55px;position:fixed;top:",a.browser.iphone?"0":"44px",';display:none;z-index:300">','<div class="chat-view-system-message" style="',a.STYLE_BODY,'margin:0 0 0 0px;text-align:center;line-height:55px;font-size:16px;color:#85837A"></div>','<div class="chat-view-system-close" style="',a.STYLE_NBODY,'position:absolute;right:15px;top:15px;width:20px;height:20px;line-height:20px;font-size:20px;display:none;color:#85837A">X</div>',"</div>",'<div class="chat-view-window-history" style="',a.STYLE_BODY,"width:100%;padding:0px 0 ",a.browser.iPhone?"132px":"52px",' 0">','<ul style="',a.STYLE_BODY,'list-style:none;margin:20px 13px 0 13px;background:transparent">','<div class="view-history-icon-div" style="',a.STYLE_NBODY,"text-align:center;width:35px;height:35px;border-radius:50%;border:1px solid #ffffff;background:url(",a.imageicon,') no-repeat -307px -55px;overflow:hidden;">',"</div>","</ul>","</div>"].join(""):"bottom"==b?[a.Audio&&a.Audio.support()?'<div class="chat-view-window-audio" style="'+a.STYLE_NBODY+'position:relative;display:none;-webkit-tap-highlight-color:rgba(0,0,0,0);"><div class="chat-view-button-text" style="'+a.STYLE_NBODY+"width:32px;height:32px;position:absolute;left:5px;top:5px;cursor:pointer;background:url("+a.jianpan_image+') no-repeat;background-size:cover;"></div><div style="'+a.STYLE_NBODY+'margin:5px 105px 5px 45px;"><input class="chat-audioInput" disabled="disabled" type="button" style="'+a.STYLE_BODY+'height:37px;width:100%;resize:none;border:1px solid #d4d4d4;outline:none;border-radius:5px;text-align:center;" value="'+a.lang.chat_button_audio+'" /></div></div>':"",'<div class="chat-view-window-editor" style="',a.STYLE_NBODY,'position:relative;display:block;">',a.Audio&&a.Audio.support()?'<div class="chat-view-button-audio" style="'+a.STYLE_NBODY+"width:32px;height:32px;position:absolute;top:5px;left:5px;cursor:pointer;background-image:url("+a.audio_image+');background-repeat:no-repeat;background-size:cover;-webkit-tap-highlight-color:rgba(0,0,0,0);"></div><div class="chat-view-textarea" style="'+a.STYLE_NBODY+'margin:5px 105px 5px 45px;padding:0">':'<div class="chat-view-textarea" style="'+a.STYLE_NBODY+'margin:5px 105px 5px 5px;padding:0">','<textarea placeholder="',a.lang.default_textarea_text,'" style="',a.STYLE_BODY,'background:#fff;height:17px;line-height:17px;width:100%;resize:none;outline:none;padding:10px 0 10px 5px;border:1px solid #d4d4d4;border-radius:5px"></textarea>',"</div>","</div>",'<div class="chat-view-button-face" style="'+a.STYLE_BODY+'background:#F9F9F9;width:32px;height:auto;position:absolute;right:55px;top:8px;cursor:pointer;-webkit-tap-highlight-color:rgba(0,0,0,0);">','<div style="text-align:center;width:32px;height:32px;background-image:url('+a.face_image+');background-repeat:no-repeat;background-size:cover;"></div>',"</div>",'<div class="chat-view-switch-manual" title="',a.lang.button_switch_manual,'" style="'+a.STYLE_BODY+'background:#F9F9F9;width:32px;height:32px;margin:8px 4px;position:absolute;right:10px;top:0px;text-align:center;cursor:pointer">','<svg class="chat-view-switch-manual-svg" width="32" height="32" xmlns="http://www.w3.org/2000/svg" >','<circle id="myCircle" cx="16" cy="16" r="15" stroke="#808080" fill="white" stroke-width="1" />','<path d="M23,12 C23,5 9,5 9,12"  stroke="#808080" fill="white"/>','<circle id="myCircle" cx="16" cy="14" r="5" stroke="#808080" fill="white" stroke-width="1" />','<path d="M9,12 C6,12 6,17 9,17" fill="#808080" stroke="#808080"/>','<path d="M23,12 C26,12 26,17 23,17" fill="#808080" stroke="#808080"/>','<line x1="20" y1="19" x2="18" y2="18" stroke="#808080" />','<path d="M14,19 C10,16 6,26 8,25" stroke="#808080" fill="white"/>','<line x1="25" y1="21" x2="25" y2="24" stroke="#808080"/>','<line x1="25" y1="24" x2="17" y2="24" stroke="#808080"/>','<line x1="20" y1="22" x2="17" y2="24" stroke="#808080"/>','<line x1="17" y1="24" x2="20" y2="26" stroke="#808080"/>',"</svg>","</div>",'<div class="chat-view-button-action" style="'+a.STYLE_BODY+'background:#F9F9F9;width:32px;height:32px;margin:8px 4px;position:absolute;right:10px;top:0px;-webkit-tap-highlight-color:rgba(0,0,0,0);text-align:center;cursor:pointer">','<div style="width:32px;height:32px;background-image:url('+a.button_action_image+');background-repeat:no-repeat;background-size:cover;">',"</div>","</div>",'<div class="chat-view-button-send" style="'+a.STYLE_BODY+"width:auto;margin:8px 10px 5px 0px;padding:0 5px;border:1px solid #d4d4d4;border-radius:7px;position:absolute;right:0px;top:0px;height:32px;line-height:32px;text-align:center;cursor:pointer;display:none;border-color:"+c+";background:"+c+";color:"+d+'">'+a.lang.chat_button_send+"</div>",'<div class="chat-view-window-face" style="',a.STYLE_NBODY,'border-top:1px solid #ccc;display:none;">',"</div>",'<div class="chat-view-window-action" style="',a.STYLE_NBODY,'border-top:1px solid #ccc;display:none;">','<div class="chat-view-action-button chat-view-image" style="',a.STYLE_NBODY,'margin:31px 10px 27px 57px;float:left;width:42px;height:auto;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0);">','<div class="chat-view-button-image" style="',a.STYLE_BODY,"text-align:center;width:41px;height:41px;background:url(",a.pic_image,') ;background-size:cover; "></div>','<div style="',a.STYLE_BODY,'position:relative;bottom:0;text-align:center;margin-top:11px;overflow-x:hidden">',a.lang.button_image,"</div>","</div>",'<div class="chat-view-action-button chat-view-evaluate" style="',a.STYLE_NBODY,'margin:31px 5px 27px 57px;float:left;width:42px;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0);">','<div class="chat-view-button-image" style="',a.STYLE_BODY,"text-align:center;width:41px;height:41px;background:url(",a.evaluate_image,') ;background-size:cover;"></div>','<div style="',a.STYLE_BODY,'text-align:center;margin-top:11px;overflow-x:hidden">',a.lang.button_evaluation,"</div>","</div>",'<div style="',a.STYLE_NBODY,'clear:both;"></div>',"</div>"].join(""):"message"==b?['<div class="chat-view-message-body" style="',a.STYLE_BODY,' background-color:#F3F3F7">','<form name="chat-view-message-form" action="" enctype="multipart/form-data" target="chat-view-submit-iframe" method="post" class="chat-view-message-form" style="',a.STYLE_NBODY,'display:block;">','<input type="hidden" value="'+a.charset+'" name="charset" />','<input type="hidden" value="'+a.source+'" name="parentpageurl" />','<input type="hidden" value="" name="myuid" />','<input type="hidden" value="" name="destuid" />','<input type="hidden" value="" name="ntkf_t2d_sid" />','<input type="hidden" value="" name="source" />','<input type="hidden" value="'+this.mode.settingid+'" name="settingid" />','<div class="chat-view-message-table" style="',a.STYLE_BODY,'padding:20px;overflow:hidden;"></div>',"</form>","</div>"].join(""):['<iframe class="ntkf-alert-iframe" style="',a.STYLE_BODY,"display:none;position:fixed;left:0;top:0;margin:0;padding:0;border:0;width:100%;height:",a(window).height(),'px;-moz-opacity:0;opacity:0;filter:alpha(opacity=0);z-index:88888;border:none;">',"</iframe>",'<div class="ntkf-alert-background" style="',a.STYLE_BODY,"display:none;position:fixed;left:0;top:0;margin:0;padding:0;border:0;width:100%;height:",a(window).height(),'px;background:#000;-moz-opacity:0.35;opacity:0.35;filter:alpha(opacity=35);z-index:99999;border:none;">',"</div>",'<div class="ntkf-alert-container" style="',a.STYLE_BODY,"display:none;position:fixed;left:39px;top:100px;width:",+a(window).width()-78,'px;height:auto;border-radius:10px;-moz-opacity:1;opacity:1;filter:alpha(opacity=100);z-index:3000;background:#fff;">',"</div>"].join("")},formatMessageTime:function(b){var c=(a.formatDate("yyyy-MM-dd")+" 00:00:00").split(/[- :]/),d=new Date(c[0],c[1]-1,c[2],c[3],c[4],c[5]);return a.formatDate(b,b>=d.getTime()?"HH:mm":"yyyy-MM-dd HH:mm")},_bind:function(){var b=this,c=!0,d=e.bubble;this._listenTextEditor(),this.faceButton=this.bottomElement.find(".chat-view-button-face").bind("touchstart",function(b){a(this).find("div").css({"background-image":"url("+a.face_image1+")"})}).bind("touchend",function(b){a(this).find("div").css({"background-image":"url("+a.face_image+")"})}).tap(function(a){b.mode.callTrack("10-02-02"),b.bottomElement.find(".chat-view-window-audio").display(!1),b.bottomElement.find(".chat-view-window-editor").display(!0).show();var c=this;return b._initFaceGroup(),b._showActionList(c),!1}),this.actionButton=this.bottomElement.find(".chat-view-button-action").bind("touchstart",function(b){a(this).find("div").css({"background-image":"url("+a.button_action_image1+")"})}).bind("touchend",function(b){a(this).find("div").css({"background-image":"url("+a.button_action_image+")"})}).tap(function(d){if(b.bottomElement.find(".chat-view-action-button").each(function(b,d){"block"==a(this).css("display")&&(c=!1)}),c!==!0)return b._showActionList(this),!1}),this.sendButton=this.bottomElement.find(".chat-view-button-send").click(function(a){return b._send(),b.faceElement&&"block"==b.faceElement.css("display")&&b.faceElement.display(0),setTimeout(function(){b.mode.requestRobot&&b.switchManualButton.display(1)},200),!1}),this.switchManualButton=this.bottomElement.find(".chat-view-switch-manual"),this.bottomElement.find(".chat-view-action-button").bind("touchstart",function(b){"disable"!=a(this).attr("talk_disable")&&(a(this).indexOfClass("chat-view-image")?a(this).find(".chat-view-button-image").css({background:"url("+a.pic_image1+")","background-size":"cover"}):a(this).indexOfClass("chat-view-evaluate")&&a(this).find(".chat-view-button-image").css({background:"url("+a.evaluate_image1+")","background-size":"cover"}))}).bind("touchend",function(b){"disable"!=a(this).attr("talk_disable")&&(a(this).indexOfClass("chat-view-image")?a(this).find(".chat-view-button-image").css({background:"url("+a.pic_image+")","background-size":"cover"}):a(this).indexOfClass("chat-view-evaluate")&&a(this).find(".chat-view-button-image").css({background:"url("+a.evaluate_image+")","background-size":"cover"}))}).tap(function(c){"disable"!=a(this).attr("talk_disable")&&(a(this).indexOfClass("chat-view-evaluate")?(b.mode.callTrack("10-02-09"),b._evaluate()):a(this).indexOfClass("chat-view-load-history")&&b._viewHistory(!0))}),this.bottomElement.find(".chat-view-switch-manual").click(function(c){a.Event.fixEvent(c).stopPropagation(),a(this).attr("talk_disable")||b._switchManual(c)}),this.textEditor=this.bottomElement.find(".chat-view-window-editor textarea").attr("rows","1").textareaAutoHeight({minHeight:17,maxHeight:240}).bind("keypress",function(c){c=a.Event.fixEvent(c),c.stopPropagation(),13==c.keyCode&&c.shitfKey||"Enter"==b._sendKey&&(13==c.keyCode&&c.ctrlKey||10==c.keyCode?b.textEditor.val(b.textEditor.val()+"\r\n"):13==c.keyCode&&(c.preventDefault(),b._send()))}).bind("keyup",function(c){b._editorStart=b._getPositionForTextArea(this);var d=a.enLength(a(this).val());d>b.mode.inputMaxByte&&a(this).val(a.enCut(a(this).val(),b.mode.inputMaxByte)),b.sendButton.display(""!==a(this).val()),b.mode.requestRobot&&b.switchManualButton.display(""===a(this).val())}).tap(function(){b._editorStart=b._getPositionForTextArea(this)}).bind("focus",function(c){a(this).css({border:"1px solid #a1cce8","border-color":d,outline:"none"}),a.promptwindow.stopPrompt(),b._hiddenFloatMenu(),a.browser.iPhone&&"1"!=a.params.iframechat&&b.bottomElement.css({position:"absolute"});var e=setInterval(function(){window.scrollTo(0,document.body.scrollHeight)},200);setTimeout(function(){clearInterval(e)},1e3)}).bind("blur",function(c){a(this).css({border:"1px solid #d4d4d4",outline:"none"}),a.browser.iPhone&&"1"!=a.params.iframechat&&b.bottomElement.css({position:"fixed",bottom:"0px"}),setTimeout(function(){b.bottomElement.css({display:"none"})},80),setTimeout(function(){"none"==a(".chat-view-message").css("display")&&(b.bottomElement.css({display:"block"}),window.scrollTo(0,1))},280)})},_initAudio:function(){if(a.Audio){var b=this;this.bottomElement.find(".chat-view-button-audio").bind("touchstart",function(){a(this).css({"background-image":"url("+a.audio_image1+")"})}).bind("touchend",function(){a(this).css({"background-image":"url("+a.audio_image+")"})}).tap(function(){a.Audio.inited||b.mode.audioInit(),b.bottomElement.find(".chat-view-window-editor").display(!1),b.bottomElement.find(".chat-view-window-audio").display(!0).show(),a(this).find("svg").find("circle").first().attr("fill","#F9F9F9")}),this.bottomElement.find(".chat-view-button-text").bind("touchstart",function(){a(this).css({"background-image":"url("+a.jianpan_image1+")"})}).bind("touchend",function(){a(this).css({"background-image":"url("+a.jianpan_image+")"})}).tap(function(c){b.bottomElement.find(".chat-view-window-audio").display(!1),b.bottomElement.find(".chat-view-window-editor").display(!0).show(),a(this).find("svg").find("circle").first().attr("fill","#F9F9F9")});var c=['<div id="voiceContainer" style="position:relative;top:42px;left:45px;width:60px;height:110px;background: url(',a.imageicon,') no-repeat -168px -151px; z-index:100">','<div id="voice_volumn" style="opacity:1;position:absolute;bottom:15px;left:70px;width:45px;height:80px;background: url(',a.sourceURI+"images/m-voice.gif",') no-repeat;z-index:10"></div>',"</div>",'<div style="position: relative;width: 180px; height:30px; line-height: 30px;z-index:100; color: #FFF; top: 46px; left: 10px; text-align:center;font-weight:bold">',a.lang.chat_button_audio_fingerup,"</div>"].join(""),d=['<div id="voice_cancel" style="position:relative;top: 42px;left:65px;width:60px;height:110px;background:url(',a.imageicon,') no-repeat -100px -151px; z-index:100">',"</div>",'<div style="position:relative;width:180px;height:30px;line-height:30px;z-index:100; color:white; top:46px; left:10px; text-align:center;font-weight:bold; background-color:#A84B4B; border-radius:5px">',a.lang.chat_button_audio_freefinger,"</div>"].join(""),e=['<div style="position:relative;top: 42px;left:55px;width:90px;height:110px;background:url(',a.imageicon,') no-repeat -0px -151px; z-index:100">',"</div>",'<div style="position:relative;width:180px;height:30px;line-height:30px;z-index:100; color:white; top:46px; left:10px; text-align:center;font-weight:bold;">',a.lang.chat_button_audio_shorttime,"</div>"].join(""),f='<div id="voice_countDown" style="opacity: 1; position: absolute; bottom: 72px; left: 60px; width: 45px; height:80px; z-index: 10;font-size:105px;font-weight:100;font-family:Arial">9</div>',g=0,h=null,i=null,j=null,k=function(){if(!b.audioDisable()){a.Log("Audio up");var c=a(".chat-audioInput");if(a(c).css({background:"#fafafa",border:"1px solid #d4d4d4",outline:"none"}).val(a.lang.chat_button_audio),Date.now()-g<1e3)return j=setTimeout(b.removeGestureToast,2e3),x.toast.change(e),void b.clearAudioData();b.removeGestureToast();var d=parseInt(1e3*Math.random()+1);a.Audio&&(a.Audio.end(function(a){b.mode.audioUpload(a,d)}),h&&(clearTimeout(h),h=null),i&&(clearInterval(i),i=null))}};this.bottomElement.find(".chat-view-window-audio input").gesture("hold",function(){return j&&(clearTimeout(j),j=null),b.removeGestureToast(),b.audioDisable()?(x.toast=new a.Toast('<div style="position: relative;width: 200px; height:30px; line-height: 30px;z-index:100; color: #FFF; top: 30px; left: 25px; text-align:center;font-weight:bold">'+a.lang.chat_button_audio_error+"</div>",{width:250,height:90}),void(j=setTimeout(function(){x.toast.remove()},2e3))):(a.Log("Audio hold"),a(this).css({background:"#e0e0e0",border:"1px solid #d4d4d4",outline:"none"}).val(a.lang.chat_button_audio_fingerup),x.toast=new a.Toast(c,{width:200,height:200}),g=Date.now(),a.Audio&&!1===a.Audio.record()&&a.Log("$.Audio not init",3),h&&(clearTimeout(h),h=null),i&&(clearInterval(i),i=null),void(h=setTimeout(function(){a("#voice_volumn").remove(),a("#voiceContainer").append(f),setTimeout(function(){i=setInterval(function(){0===parseInt(a("#voice_countDown").html())&&(clearTimeout(h),clearInterval(i),h=null,i=null),a("#voice_countDown").html(parseInt(a("#voice_countDown").html(),10)-1)},1e3)},500),setTimeout(function(){clearTimeout(h),clearInterval(i),x.util.reset(),x.record.swipeEl=null,x.record.holdEl=null,k.call()},1e4)},2e4)))}).gesture("holdup",k).gesture("swiping",function(){if(!b.audioDisable()){var e=x.record,f=null;"up"==e.direction&&e.distance>a(window).height()/4?(0!==a("#voice_volumn").length&&x.toast.change(d),f=a.lang.chat_button_audio_freefinger):"up"==e.direction&&e.distance<a(window).height()/4&&(0!==a("#voice_cancel").length&&x.toast.change(c),f=a.lang.chat_button_audio_fingerup),a(this).css({border:"1px solid #d4d4d4",outline:"none"}).val(f)}}).gesture("swipeend",function(){if(!b.audioDisable()){a(this).css({background:"#fafafa",border:"1px solid #d4d4d4",outline:"none"}).val(a.lang.chat_button_audio);var c=parseInt(1e3*Math.random()+1);if(a("#voice-volumn").length>0||a("#voice-countDown").length>0){if(!a.Audio)return;a.Audio.end(function(a){b.mode.audioUpload(a,c)})}else b.clearAudioData();b.removeGestureToast(),h&&(clearTimeout(h),h=null),i&&(clearInterval(i),i=null)}}).gesture("holdcancel",function(){b.audioDisable()||(a(this).css({background:"#fafafa",border:"1px solid #d4d4d4",outline:"none"}).val(a.lang.chat_button_audio),b.removeGestureToast(),b.clearAudioData(),holdCancelToast=new a.Toast('<div style="position: relative;width: 200px; height:30px; line-height: 30px;z-index:100; color: #FFF; top: 30px; left: 25px; text-align:center;font-weight:bold">'+a.lang.chat_audio_orientation_stop+"</div>",{width:250,height:90}),j=setTimeout(function(){holdCancelToast.remove()},2e3),h&&(clearTimeout(h),h=null),i&&(clearInterval(i),i=null))})}},audioDisable:function(){return"disabled"==a(".chat-audioInput").attr("disabled")},clearAudioData:function(){try{a.Audio.rec.stop(),a.Audio.rec.clear()}catch(b){a.Log(b,3)}},removeGestureToast:function(){x.toast&&(x.toast.remove(),x.toast=null)},showAudioResult:function(a,b){var c=b?b:this.chatHistory.find("."+a).last();c.find(".view-history-status-loading").display(0)},audioProgress:function(a,b){var c=(this.chatHistory.find("."+a+" .view-history-body"),this.chatHistory.find("."+a).last());c.find(".view-history-body");c.find(".view-history-status").css({left:"-60px",top:"23px"}).display(1),c.find(".view-history-status-icon").display(0),c.find(".view-history-status-loading").display(1)},_hiddenFloatMenu:function(){this.bottomElement.find(".chat-view-window-face").display(),this.bottomElement.find(".chat-view-window-action").display()},_showActionList:function(a,b,c){var d;a=a||this.actionButton.get(0),a.className.indexOf("action")>-1||b===!0?(this.bottomElement.find(".chat-view-window-face").display(0),d=this.bottomElement.find(".chat-view-window-action").css("display"),this.bottomElement.find(".chat-view-window-action").display("block"==d||b?0:1)):(this.bottomElement.find(".chat-view-window-action").display(0),d=this.bottomElement.find(".chat-view-window-face").css("display"),this.bottomElement.find(".chat-view-window-face").display("block"==d?0:1))},disableButton:function(b,c){var d=this,e=[];return b=a.isArray(b)?b:[b],a.each(b,function(a,b){e.push("."+d.buttonSelectors[b])}),e=e.join(","),a.Log("nTalk.chatView.disableButton("+e+", "+c+")"),c?(this.bottomElement.find(e).attr("talk_disable","disable").css("opacity","0.4"),(e.indexOf("chat-view-image")>-1||e.indexOf("chat-view-transfer-file")>-1)&&this.bottomElement.find(e).find("input").each(function(b){a(this).attr("disabled","disabled")}),!1):(this.bottomElement.find(e).attr("talk_disable","").css("opacity",1),(e.indexOf("chat-view-image")>-1||e.indexOf("chat-view-transfer-file")>-1)&&this.bottomElement.find(e).find("input").each(function(b){a(this).attr("disabled","")}),!0)},displayButton:function(b,c){var d=this,e=[];b=a.isArray(b)?b:[b],a.each(b,function(a,b){e.push("."+d.buttonSelectors[b])}),e=e.join(","),this.bottomElement.find(e).display(!c)},disabledAudioButton:function(a){this.bottomElement.find(".chat-view-window-audio input").attr({disabled:a?"disabled":""}).css({color:a?"#ccc":"#000"})},displayEvClose:function(b){"none"==a(".chat-view-window-status-info").css("display")&&0===a(".view-website-iframe").length&&a(".chat-view-window-header-ev-close").display(b)},hideAudioButton:function(){a(".chat-view-button-audio").css("display","none"),a(".chat-view-textarea").css({"margin-left":"5px"})},_listenTextEditor:function(){var b=this;setInterval(function(){var c=b.textEditor.val(),d=b._cacheListen;c!=a.lang.default_textarea_text&&(a.enLength(c)>500&&(c=a.enCut(c,500),b.textEditor.val(c),b.textEditor.scrollTop(b.textEditor.scrollHeight())),(c&&d!==c||!c&&d)&&b.mode.predictMessage(c),b._cacheListen=c)},2e3),setInterval(function(){var c=b.textEditor.val();c!=a.lang.default_textarea_text&&b.sendButton.display(""!==c)},600)},_initFaceGroup:function(){var c,d=this,e="outline:0;diplay:block;float:left;width:23px;height:23px;display:inline;box-sizing:content-box;";this._initFace||(this._initFace=!0,this.faceElement=this.bottomElement.find(".chat-view-window-face"),this.faceElement.find(".chat-view-face-tags").length||this.faceElement.append(['<div class="chat-view-face-tags" style="',a.STYLE_NBODY,'background:#F1F1F1;clear:both;padding:0 5px;height:38px;border-top:1px solid #D4D4D4;"></div>'].join("")),a.each(this.mode.config.faces,function(f,g){var h="chat-view-face-group-"+f,i="chat-view-face-tag-"+f;d.faceElement.find("."+h).length||d.faceElement.insert('<div class="'+h+' chat-view-face-group" style="'+a.STYLE_NBODY+(0===f?"":"display:none;")+'overflow-x:hidden;overflow-y:auto;margin:10px 0px 10px 10px;clear:left;height:auto;max-height:100px;"></div>',"afterbegin"),g.pics===b&&(g.pics=[]),a.each(g.pics,function(b,g){var i=0===f?' title="'+g.sourceurl+'"':' title="" sourceurl="'+g.sourceurl+'"';c=e+"margin:0;padding:3px;border:none;background:none;",d.faceElement.find("."+h).append('<span style="'+a.STYLE_BODY+'cursor:pointer;width:14.2%;padding:2px 0;dislay:block;float:left;text-align:center;"><img src="'+g.url+'" '+i+' border="0" style="'+c+'" /></span>')}),0===f?a({className:"chat-view-face-tag "+i+" tag-selected",title:g.name,index:"0",style:a.STYLE_NBODY+"margin:0 0 0 5px;float:left;clear:right;background:#fff;position:relative;top:-1px;border-left:1px solid #D4D4D4;border-right:1px solid #D4D4D4;"}).appendTo(d.faceElement.find(".chat-view-face-tags")).append('<img src="'+g.icon+'" border="0" style="'+e+'margin:0;padding:8px;border:none;" />'):a({className:"chat-view-face-tag "+i,title:g.name,index:f,style:a.STYLE_NBODY+"margin:0 0 0 5px;float:left;clear:right;background:none;position:relative;top:0px;border-left:1px solid #f1f1f1;border-right:1px solid #f1f1f1;"}).appendTo(d.faceElement.find(".chat-view-face-tags")).append('<img src="'+g.icon+'" border="0" style="'+e+'margin:0;padding:8px;border:none;" />')}),this.faceElement.find(".chat-view-face-group span").hover(function(b){a.Event.fixEvent(b).stopPropagation(),a(this).css({"background-color":"#EEE"})},function(b){a.Event.fixEvent(b).stopPropagation(),a(this).css({"background-color":""})}).tap(function(b){a.Event.fixEvent(b).stopPropagation(),a(this).parent().indexOfClass("chat-view-face-group-0")?(d._insertText(!a(this).find("img").attr("title")||"["+a(this).find("img").attr("title")+"]"),d._editorStart=d._getPositionForTextArea(this),d.textEditor.textareaAutoHeight({minHeight:17,maxHeight:240})):(d.faceElement.display(),a.Log("selected current face:"+a(this).find("img").attr("sourceurl")),d.mode.send({type:2,emotion:1,msg:"current face",url:a(this).find("img").attr("src"),sourceurl:a(this).find("img").attr("sourceurl"),oldfile:"",size:"",extension:""}))}),this.faceElement.find(".chat-view-face-tags div").hover(function(b){a.Event.fixEvent(b).stopPropagation(),a(this).indexOfClass("tag-selected")||a(this).css({"background-color":"#fafafa",top:"-1px","border-left":"1px solid #D4D4D4","border-right":"1px solid #D4D4D4"})},function(b){a.Event.fixEvent(b).stopPropagation(),a(this).indexOfClass("tag-selected")||a(this).css({"background-color":"",top:"0px","border-left":"1px solid #f1f1f1","border-right":"1px solid #f1f1f1"})}).tap(function(b){a.Event.fixEvent(b).stopPropagation(),d.faceElement.find(".chat-view-face-tag").css({"background-color":"",top:"0px","border-left":"1px solid #f1f1f1","border-right":"1px solid #f1f1f1"}).removeClass("tag-selected"),d.faceElement.find(".chat-view-face-group").display(),a(this).css({"background-color":"#fff",top:"-1px","border-left":"1px solid #D4D4D4","border-right":"1px solid #D4D4D4"}),d.faceElement.find(".chat-view-face-group-"+a(this).attr("index")).display(1),a(this).addClass("tag-selected")}))},_contentFilter:function(b){return"string"!=typeof b.msg||/<.*?>/gi.test(b.msg)?(1!=b.type&&7!=b.type||!/<img(.*?)src=([^\s]+)(.*?)>/gi.test(b.msg)||(b.msg=b.msg.replace(/<img(.*?)src=([^\s]+)(.*?)>/gi,'<img style="max-width:220px;max-height:160px" class="ntalk-preview" '+(7==b.type?" robotImg='true' ":"")+' src="'+a.imageloading+'" sourceurl=$2 />')),b):(b.msg=b.msg.replace(/[\r\n]/gi," <br>"),b.msg=b.msg.replace(/(\s{2})/gi," {$null}"),b.msg=a.myString(b.msg).linkFilter1(a.STYLE_BODY+"color:#0a8cd2;"),b.msg=b.msg.replace(/\{\$null\}/gi,"&nbsp;&nbsp;"),b.msg=b.msg.replace(/\t/gi,"&nbsp;&nbsp;&nbsp;&nbsp;"),b.msg=a.utils.handleLinks(b.msg,{settingid:this.settingid}),b.msg=this._faceFilter(b.msg),b)},_faceFilter:function(b){var c=b.match(/\[([a-z]+)\]/gi),d=function(b){var c=null;return a.each(a.lang.editorFaceAlt,function(a,d){d&&new RegExp(b.replace(/\[/,"\\[").replace(/\]/,"\\]"),"gi").test("["+d+"]")&&(c=a)}),c};if(!c||!b)return b;for(var e,f=0;f<c.length;f++)(e=d(c[f]))&&(b=b.replace(c[f],'<img src="'+a.sourceURI+"images/faces/"+e+(a.browser.msie6?".gif":".png")+'" style="'+a.STYLE_NBODY+'width:23px;height:23px;margin:0 2px;padding:0;display:inline;vertical-align:text-bottom" />'));return b},_viewHistory:function(b){var c,d,e,f=this;this.mode.viewHistory&&(d=['<div class="alert-header" style="',a.STYLE_BODY,'height:44px;border-bottom:1px solid #ccc;">','<input type="button" class="alert-header-back" style="',a.STYLE_BODY,'padding:0 10px;margin:8px 0 8px 20px;cursor:auto;border-radius:3px;background:#0079fe;color:#fff;height:28px;line-height:28px;" value="',a.lang.back_button_text,'" />',"</div>",'<div class="chat-view-float-history" style="',a.STYLE_BODY,"width:100%;height:",a(window).height()-44,'px;background:#fff;z-index:99;display:block;">','<iframe scrolling="no" frameborder="0" class="chat-view-float-iframe" style="'+a.STYLE_BODY+'display:block;width:100%;height:100%;">',"</iframe>","</div>"].join(""),this.evalDialog||(this.evalDialog=new a.DialogChat(d,{margin:0,border:0,style:{height:a(window).height()+"px"}})),c=this.evalDialog.container,c.find(".alert-header-back,.alert-body-back").tap(function(b){a(window).removeEvent("resize",e),f.evalDialog.close(),f.evalDialog=null}),a(window).bind("resize",e),b&&this.mode.viewHistory(this.settingid,this.contains.find(".chat-view-float-iframe").get(0)),this._showActionList())},_evaluate:function(){this.mode.showEvaluation&&this.mode.showEvaluation()},_capture:function(){this.mode.startCapture&&this.mode.startCapture(this.settingid)},_switchManual:function(){this.mode.switchServerType&&this.mode.switchServerType(!0,this.settingid)},_changeCsr:function(){this.mode.changeCustomerServiceInfo&&this.mode.changeCustomerServiceInfo()},_expansion:function(a){this.options.toggleExpansion(this.settingid)},updateMore:function(b){this.chatElement.find(".chat-view-exp").html(a.lang.button_more+(b?" &lt;":" &gt;"))},switchToolbar:function(b,c){a.Log("nTalk.chat.view.switchToolbar("+b+")"),b?(this.bottomElement.find(".chat-view-textarea").css({"padding-right":"0px","margin-left":a.Audio.support()&&1==this.mode.config.enable_audio?"45px":"5px","margin-right":"105px"}),this.bottomElement.find(".chat-view-button-send").css("padding","0 5px"),this.bottomElement.find(".chat-view-button-face").display(1),this.bottomElement.find(".chat-view-button-audio").display(1==this.mode.config.enable_audio),this.bottomElement.find(".chat-view-switch-manual").display(),this.bottomElement.find(".chat-view-button-action").display(1)):(this.bottomElement.find(".chat-view-textarea").css({"padding-right":"15px","margin-left":"5px","margin-right":"50px"}),this.bottomElement.find(".chat-view-button-send").css("padding","0 5px"),this.bottomElement.find(".chat-view-button-face,.chat-view-button-audio").display(),this.bottomElement.find(".chat-view-button-action").display(),this.bottomElement.find(".chat-view-switch-manual").display(1))},_send:function(){if(/QUERY|QUEUE/i.test(this.mode.statusConnectT2D))return!1;var b=this._clearEditor();b.length&&b!=a.lang.default_textarea_text&&this.mode.send(b)},_endSession:function(){this.mode.endSession()},_clearEditor:function(){var a=this.textEditor.val().replace(/(^\s*)|(\s*$)/g,"");return this.textEditor.val("").css("height","17px"),this.sendButton.display(),a},_resizeDialog:function(){a.Log("nTalk._resizeDialog()",2),this.contains.find(".ntkf-alert-container").css({width:a(window).width()+"px",height:a(window).height()+"px"})},setDescIcon:function(b,c){var d,e=this.mode.hashDest.items(c);if(!b.find(".view-history-icon-div").attr("data-userid")&&a.base.checkID(c)===a.CON_CUSTOMER_ID)if(e&&!this.mode.isVisitor(c)&&e.logo){var f=b.find(".view-history-icon-div .view-history-receive-icon");if(f.attr("src")==e.logo)return;a.require(e.logo+"#image",function(b){b.error!==!0?(d=a.zoom(b,35,35),f.length||(f=a({tag:"img",className:"view-history-receive-icon",src:a.sourceURI+"images/blank.gif",style:a.STYLE_NBODY}).appendTo(a(".view-history-icon-div"))),f.attr({width:d.width||35,height:d.height||35,src:e.logo}).css({width:(d.width||35)+"px",height:(d.height||35)+"px"}).parent().css("background","")):a(".view-history-icon-div .view-history-receive-icon").remove()})}else;},callChatResize:function(b,c){this.contains.find(".ntkf-alert-iframe,.ntkf-alert-background,.chat-view-load").css("height",c-95+"px"),this.contains.find(".chat-view-message").css("height",c-115+"px"),a(".ntkf-alert-container,.ntkf-alert-background,.ntkf-alert-iframe,.chat-view-float-history").css("height",c+"px"),a(".chat-view-float-history iframe").css("height",c-45+"px")},changeQueueStyle:function(){
a(".chat-view-queue-num").parent().css("font-size","12px"),a(".chat-view-queue-num").css({color:"#E97D3A","font-size":"12px"}),a(".chat-view-queue-num").parent().find("a").css("color","#1F99E2")},audioView:function(b){if(!this.msgid&&a.musicEl)return a.musicEl.emit(),void(a.musicEl=null);var c,d,e,f,g,h=this,i=h.msgid,j=h.duration,k=a("."+i).find(".view-history-body"),l=!(i.indexOf("J")>-1);switch(l?(d=a.sourceURI+"images/kfSound.png",e=a.sourceURI+"images/kfSound.gif",f="#FFFFFF",g="right",durationAlign="left"):(d=a.sourceURI+"images/mySound.png",e=a.sourceURI+"images/mySound.gif",f="#CEF2FF",g="left",durationAlign="right"),b){case"init":if(a.Log("[nTalk music]: mp3 view init, msgid is "+i),k.find(".duration_"+i).length>0)a(".duration_"+i).innerHTML=j+"''";else{var m=['<div id="duration_',i,'" style="',a.STYLE_BODY,"height:24px;line-height:24px;padding:4px 4px 0px;float:",durationAlign,'" >',j,"''</div>",'<div id="player_',i,'" style="',a.STYLE_BODY," width:80px;height:24px;padding:4px 0;background:",f,";border-radius:5px;border:none;text-align:",g,'">','<img width="24px" height="24px" src="',d,'"/>',"</div>"].join("");k.css("padding","0px"),k.append(m)}break;case"play":a.Log("[nTalk music]: mp3 view play, msgid is "+i),a.musicEl&&(a.Log("[nTalk music]: stop playing mp3 view, msgid is "+a.playMsgid,2),a.musicEl.emit()),a.musicEl=h,c=a("#player_"+i+" img")[0],c.src=c.src.replace("png","gif");break;case"stop":a.Log("[nTalk music]: mp3 view stop, msgid is "+i),a.musicEl=null,c=a("#player_"+i+" img")[0],c.src=c.src.replace("gif","png")}},audioBindEvent:function(b){var c=this.msgid;switch(b){case"init":a.Log("[nTalk music]: mp3 event init, msgid is "+c);var d=this,e=a("#player_"+c);e.click(function(){a.Log("[nTalk music]: mp3 trigger click, msgid is "+c),d.emit()})}}};var z=a.Class.create();z.prototype={element:null,title:"",status:0,count:0,initialize:function(a,b,c){},online:function(){},offline:function(){},update:function(a,b){},remove:function(){},startFlicker:function(a,b){},stopFlicker:function(a){}};var A=a.Class.create();A.prototype={name:"chatManageView",_manageMode:null,tagKey:"",tagTitle:"",extended:null,options:null,header:null,body:null,leftContent:null,leftElement:null,chatBody:null,chatContainter:null,rightElement:null,chatWidth:0,chatHeight:0,initialize:function(b,c,d){this.options=a.extend({},this.defaultOptions,b),this._manageMode=c,d&&(e.title=d.title?d.title:e.title,e.return_style=d.return_style?d.return_style:e.return_style,e.return_color=d.return_color?d.return_color:e.return_color,e.close_style=d.close_style?d.close_style:e.close_style,e.close_color=d.close_color?d.close_color:e.close_color,e.titlename=d.titlename?d.titlename:e.titlename,e.background=d.background?d.background:e.background,e.bubble=d.bubble?d.bubble:e.bubble,e.bubble_text=d.bubble_text?d.bubble_text:e.bubble_text,e.timestamp=d.timestamp?d.timestamp:e.timestamp),this._create()},close:function(){},addChatTag:function(a){},removeChatTag:function(a){},updateChatTag:function(b,c){var d;c.logo==a.CON_MULTIPLAYER_SESSION&&(c.logo=""),this.header.find(".chat-view-window-header-title").html(c.title||c.name),d=this._manageMode.get(),d&&a(".welcome").length&&a.base.checkID(c.id)==a.CON_CUSTOMER_ID&&d.view.setDescIcon(a(".welcome"),c.id)},switchChatTag:function(a){},toggleExpansion:function(a,b){},updateRightData:function(a,b){},updataSkin:function(a,b,c,d){return!1},updateViewStatus:function(b){var c=this.header.find(".chat-view-window-header-close");"X"!=c.html()&&c.attr("status",b===!0?"start":"end").html(b===!0?a.lang.button_start_session:a.lang.button_end_session)},_callEndSession:function(b,c){var d=this,e=this._manageMode.get(),f=function(){return c&&"1"==a.params.iframechat?void setTimeout(function(){a.postMessage(window.parent,"closeMobileIframeWindow","*")},200):(d.updateViewStatus(!0),e.statusConnectTChat="CLOSECHAT",e.statusConnectT2D="WAIT",e.disconnect(),e._stopQueue(),void("0"!=a.params["return"]&&"0"!=a.params.header&&setTimeout(function(){"1"==a.params.iframechat?a.postMessage(window.parent,"closeMobileIframeWindow","*"):history.go(-1)},200)))};if(b&&e.config&&!e._submitRating&&e._currentView==e.CON_VIEW_WINDOW&&1==e.config.enableevaluation&&e._Enableevaluation){if(e.showEvaluation(0,function(){f()})===!1)try{f()}catch(g){a.Log(g,3)}}else f()},_callStartSession:function(){var b=this._manageMode.get();a.browser.mobile&&(b._currentView==b.CON_VIEW_WINDOW?(this.updateViewStatus(!1),b.reconnect()):window.location.reload())},_create:function(){var b=e.return_color,c=e.return_style,d=e.close_color,f=e.close_style,g=e.titlename,h="44",i=e.title,j=/^#[0-9a-f]{6}$/i,k=(new Date).getTime(),l=j.test(i)?"background-color:"+i:"background-image:url("+i+"?"+k+");background-repeat:no-repeat;background-size:cover",m=this,n=['<div class="chat-view-window-header-message-title" style="',a.STYLE_BODY,"display:none;color:"+g+";margin:0 0px;font-size:16px;font-weight:bold;text-align:center;line-height:"+h+"px;height:"+h+"px;overflow:hidden;"+l+'"></div>','<div class="chat-view-window-header-title" style="',a.STYLE_BODY,"color:"+g+";margin:0 85px;font-size:16px;font-weight:bold;text-align:center;line-height:"+h+"px;height:"+h+'px;overflow:hidden;"></div>','<div class="chat-view-window-header-close" style="',a.STYLE_BODY,'display:none;border-radius:3px;padding:0 8px;width:auto;height:29px;line-height:29px;position:absolute;right:10px;top:14px;border:1px solid #d4d4d4;cursor:pointer;background:none;font-size:16px;z-index:100">',a.lang.button_end_session,"</div>"].join("");this.header=a({className:"chat-view-window-header",style:a.STYLE_NBODY+l+";width:99.9%;height:"+h+"px;position:fixed;left:0;top:0;z-index:999;"}).appendTo(!0).html(n).fixed({width:"100%",left:"0px",top:"0px"});var o=["<div class='chat-view-window-header-back' style='position: absolute; width:30px; height:30px; z-index:50; left: 12px; top: 7px'>",'<div style="line-height:20px;height:20px;width:20px;font-size:20px;padding:5px;font-family:iconfont;color:'+b+'">'+c+"</div></div>"].join(""),p=["<div class='chat-view-window-header-ev-close' style='position: absolute; width:30px; height:30px; z-index:50;right: 12px; top: 7px;display:none;'>",'<div style="line-height:20px;height:20px;width:20px;opacity:1;font-size:20px;padding:5px;font-family:iconfont;color:'+d+'">'+f+"</div></div>"].join("");this.header.append(o).append(p),this.header.find(".chat-view-window-header-close").attr("status","end").gradient("top","#ededed","#ffffff"),this.header.find(".chat-view-window-header-back").tap(function(b){return a.Event.fixEvent(b).stopPropagation(),/QUERY|QUEUE/i.test(m._manageMode.chat.statusConnectT2D)&&"none"==a(".chat-view-message")[0].style.display?void m._manageMode.chat.view.createGiveupQueue():void("1"==a.params.iframechat?m._callEndSession(!1,!0):m._callEndSession(!1))}),this.header.find(".chat-view-window-header-ev-close").tap(function(b){a.Event.fixEvent(b).stopPropagation(),m._callEndSession(!0,!0)}),"0"!=a.params["return"]&&"0"!=a.params.header||this.header.find(".chat-view-window-header-back").display()}},"undefined"==typeof a.ntView&&(a.ntView={chatView:y,minimizeView:z,chatManageView:A})}(nTalk);