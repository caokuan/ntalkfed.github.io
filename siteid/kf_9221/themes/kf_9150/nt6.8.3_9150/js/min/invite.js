!function(a,b){if(!a.invite){var c={destName:"{$destname}客服",invitationText:"向您发出对话邀请",buttonCancelText:"忽略",buttonConfirmText:"接受",listEntranceText:"在线客服"},d=function(b,c,d){var e;return c&&c.settingid==b?void d(c):(e=[a.server.flashserver,"config/6/",b.split("_").slice(0,2).join("_"),"_",b,".js"].join(""),void a.require(e,function(c){return c.error||!nTalk.CONFIG&&!NTKF.CONFIG?void a.Log("nTalk.invite::load config file failed",3):(a.base.config=a.extend({settingid:b},nTalk.CONFIG||NTKF.CONFIG),void d(a.base.config))}))};a.invite={config:null,number:0,timeID:null,settingid:"",inviteid:"",destid:"",winInvite:null,start:function(b,c,e){b&&(this.settingid=b||"",this.destid=c||"",this.inviteid=e||"",a.Log("nTalk.invite.start("+b+")"),d(b,a.base.config,function(b){a.invite._init(b)}))},_init:function(b){this.config=b;var c=this,d=this.config.invite;return d?(this.destid||(this.destid=this.config.icon?this.config.icon.members.groupID:this.config.list?this.config.list.members.groupID:this.config.toolbar?this.config.toolbar.members.groupID:""),void setTimeout(function(){c._create(d),c.timeID=setInterval(function(){c._create(d)},1e3*d.invite_interval)},1e3*d.invite_waittime)):void a.Log("No invitation Configuration",2)},_create:function(b){var d;if(b.invite_onlyone>0&&parseFloat(a.cache.get("onlyone"))>b.invite_onlyone-1)return void clearInterval(this.timeID);if(!(a.chatManage&&a.chatManage.hash.count()>0||a("#entrance_container_invite").length||a.browser.mobile)){if(b.invite_pagetype&&!a.isNumeric(b.invite_pagetype))try{if(d=new RegExp(b.invite_pagetype,"i"),!d.test(a.url))return}catch(e){}a.Log("nTalk.invite._create()",1),this.number++,this.number>=b.invite_repeat&&this._stop();var f,g,h,i,j=this,k="",l="",m="",n="",o={width:436,height:161};switch(l="url("+a.sourceURI+"images/invite/1/bg_invite.png) no-repeat -320px -189px",/2|3/i.test(b.invite_rcmdskin)?k="#fff url("+b.invite_skin+") no-repeat 0 0":(k="#fff url("+a.sourceURI+"images/invite/1/bg_invite.png) no-repeat -12px -10px",f=b.invite_skin.split("|"),m=f[0],n=f.length>1?f[1]:f[0]),a.cache.set("onlyone",this.number),b.invite_position=a.extend({},{position:"center-center",xoff:0,yoff:0},b.invite_position),b.invite_position.position){case"left-top":g=0+b.invite_position.xoff,h=0+b.invite_position.yoff;break;case"center-top":g=(a(window).width()-o.width)/2+b.invite_position.xoff,h=0+b.invite_position.yoff;break;case"right-top":g=a(window).width()-o.width+b.invite_position.xoff,h=0+b.invite_position.yoff;break;case"left-center":g=0+b.invite_position.xoff,h=(a(window).height()-o.height)/2+b.invite_position.yoff;break;case"right-center":g=a(window).width()-o.width+b.invite_position.xoff,h=(a(window).height()-o.height)/2+b.invite_position.yoff;break;case"left-bottom":g=0+b.invite_position.xoff,h=a(window).height()-o.height+b.invite_position.yoff;break;case"center-bottom":g=(a(window).width()-o.width)/2+b.invite_position.xoff,h=a(window).height()-o.height+b.invite_position.yoff;break;case"right-bottom":g=a(window).width()-o.width+b.invite_position.xoff,h=a(window).height()-o.height+b.invite_position.yoff;break;default:g=(a(window).width()-o.width)/2+b.invite_position.xoff,h=(a(window).height()-o.height)/2+b.invite_position.yoff}g=Math.min(Math.max(g,0),a(window).width()-o.width),h=Math.min(Math.max(h,0),a(window).height()-o.height),i=a.merge({className:"entrance_container_invite",left:g,top:h,dropHeight:36,resize:!1,drag:!0,fixed:1==b.invite_fixed,rightNode:!1,zIndex:2147483647},o),this.winInvite=new a.Window(i),this.winInvite.containter.attr("id","entrance_container_invite"),this.winInvite.buttonMax.display(),this.winInvite.buttonMin.display(),this.header=this.winInvite.header,this.element=this.winInvite.chatBody,m&&n&&this.header.gradient("top",m,n),this.winInvite.containter.css({border:"1px solid #ccc","border-radius":"3px","-moz-border-radius":"3px","-webkit-border-radius":"3px",background:k}),this.header.insert(['<span style="',a.STYLE_BODY,'float:left;margin:0 0 0 20px;font-size:14px;font-weight:bold;color:#fff;line-height:36px;">',b.invite_title,"</span>"].join(""),"afterbegin"),this.element.css("top","-4px").html(['<div class="entrance_content" style="',a.STYLE_NBODY,'margin:0 0 0 120px;">','<div style="',a.STYLE_BODY,'font-size:14px;margin:5px 0 0 0;height:75px;overflow:hidden;">','<div style="',a.STYLE_BODY,'font-size:14px;overflow:hidden;height:24px;">',"</div>",'<div style="',a.STYLE_BODY,'font-size:14px;">',b.invite_content,"</div>","</div>",'<div class="entrance_buttons" style="',a.STYLE_NBODY,'height:45px;text-align:right">','<input type="button" name="cancel" value="',c.buttonCancelText,'" style="font-size:14px;text-align:center;width:68px;height:30px;line-height:26px;margin:15px 0px 0 15px;" />','<input type="button" name="confirm" value="',c.buttonConfirmText,'" style="font-size:14px;text-align:center;width:68px;height:30px;line-height:26px;margin:15px 20px 0 15px;" />',"</div>","</div>"].join("")),this.winInvite.buttonClose.css({background:l,margin:"8px 8px 0 0"}).hover(function(){a(this).css("background-position","-361px -188px")},function(){a(this).css("background-position","-320px -189px")}).click(function(){j._close(!1)}),this.element.find(".entrance_buttons INPUT[name=cancel]").click(function(b){a.Event.fixEvent(b).stopPropagation(),a(this).css("background-position","-178px -186px"),j._close(!0)}),this.element.find(".entrance_buttons INPUT[name=confirm]").click(function(b){a.Event.fixEvent(b).stopPropagation(),a(this).css("background-position","-178px -186px"),j._open()}),this.element.click(function(b){a.Event.fixEvent(b).stopPropagation(),j._open()})}},_createmobile:function(a){},_showMobilePhone:function(){},showDialog:function(b,c){var d=this;return this._dialogDisplay=!1,c=a.merge({display:"block",width:a(window).width()+"px",height:a(window).height()+"px",top:"0px",left:"0px",opacity:1,"border-radius":"0px"},c),this.alertIframe&&this.alertIframe.length||(this.alertIframe=a({className:"mobile_alert_iframe",style:a.STYLE_NBODY+"display:none;position:fixed;left:0;top:0;width:100%;-moz-opacity:0;opacity:0;filter:alpha(opacity=0);z-index:88888;"}).appendTo(!0),this.alertBackground=a({className:"mobile_alert_background",style:a.STYLE_NBODY+"display:none;position:fixed;left:0;top:0;width:100%;background:#000;-moz-opacity:0.35;opacity:0.35;filter:alpha(opacity=35);z-index:99999;"}).appendTo(!0),this.alertContainer=a({className:"mobile-alert-container",style:a.STYLE_BODY+"font-size:14px;padding:10px 0 0;display:none;position:fixed;left:39px;top:100px;width:auto;height:auto;border-radius:10px;-moz-opacity:1;opacity:1;filter:alpha(opacity=100);z-index:2147483647;background:#fff;"}).appendTo(!0)),this.alertContainer.html(b).css(c,500,function(){}),this.alertIframe.css({display:"block",width:"100%",height:a(window).height()+50+"px"}),this.alertBackground.css({display:"block",width:"100%",height:a(window).height()+50+"px",opacity:.6}),(a.browser.iPad||a.browser.iPod||a.browser.iPhone)&&(a(window).scrollTop(1),this.alertContainer.css({height:c.height,top:c.top}),this.alertIframe.css({top:a(window).offset().top+"px",height:a(window).height()+50+"px"}),this.alertBackground.css({top:a(window).offset().top+"px",height:a(window).height()+50+"px"})),a(window).bind("resize",function(b){d.alertBackground.css({height:a(window).height()+50+"px"}),d.alertContainer.css({left:(a(window).width()-parseFloat(d.alertContainer.width()))/2+"px",top:(a(window).height()-parseFloat(d.alertContainer.height()))/2+"px"})}),this.alertContainer},hiddenDialog:function(){this.alertIframe&&(this.alertIframe.display(),this.alertContainer.display(),this.alertBackground.display(),this._dialogDisplay=!0)},_reposition:function(){var b=a(window).height()/2-a("#entrance_container_invite").height()/2,c=a(window).width()/2-a("#entrance_container_invite").width()/2;b<0&&(b=0),c<0&&(c=0),a.browser.oldmsie&&(b+=a(window).scrollTop()),a("#entrance_container_invite").css({top:b+"px",left:c+"px"})},_maintainPosition:function(b){switch(b){case!0:a(window).addEvent("resize",a.invite._reposition),a.browser.oldmsie&&a(window).addEvent("scroll",a.invite._reposition);break;case!1:a(window).removeEvent("resize",a.invite._reposition),a.browser.oldmsie&&a(window).removeEvent("scroll",a.invite._reposition)}},_stop:function(){clearInterval(this.timeID),this.timeID=null},_open:function(){this.destid&&this.inviteid&&a.im.refuseInvite(this.destid,this.inviteid,0),a("#entrance_container_invite").remove(),a.invite._maintainPosition(!1),a.im_openInPageChat(this.config.settingid,"",this.destid,{single:-1,autoconnect:!0},""),"1"==this.config.invite.invite_session_disable&&this._stop()},_close:function(b){this.destid&&this.inviteid&&a.im.refuseInvite(this.destid,this.inviteid,2),a("#entrance_container_invite").remove(),a.invite._maintainPosition(!1),b===!0&&"1"==this.config.invite.invite_refusal_disable&&this._stop()}}}}(nTalk);