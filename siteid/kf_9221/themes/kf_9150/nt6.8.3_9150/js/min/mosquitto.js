!function(a,b){var c=16,d=32,e=48,f=64,g=80,h=96,j=112,k=128,l=144,m=160,n=176,o=192,p=208,q=224;a.extend({AB2S:function(a){for(var b="",c=new Uint8Array(a),d=c.byteLength,e=0;e<d;e++)b+=String.fromCharCode(c[e]);return b}}),a.Mosquitto=a.Class.create(),a.Mosquitto.prototype={initialize:function(){this.ws=null,this.onconnect=null,this.ondisconnect=null,this.onmessage=null,this.onreconnect=null,this.closeFlag=!1,ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(a,c){var d=new Uint8Array(this);c===b&&(c=d.length);for(var e=new ArrayBuffer(c-a),f=new Uint8Array(e),g=0;g<f.length;g++)f[g]=d[g+a];return e})},mqtt_ping:function(){var a=new ArrayBuffer(2),b=new Int8Array(a);b[0]=o,b[1]=0,1==this.ws.readyState?this.ws.send(a):this.queue(a),setTimeout(function(a){a.mqtt_ping()},6e4,this)},connect:function(b,c,d){this.url=b,this.keepalive=c,this.clientId=d,this.mid=1,this.out_queue=[];try{this.ws=new WebSocket(b,"mqttv3.1"),this.ws.binaryType="arraybuffer",this.ws.onopen=this.ws_onopen,this.ws.onclose=this.ws_onclose,this.ws.onmessage=this.ws_onmessage,this.ws.m=this,this.ws.onerror=this.ws_onerror}catch(e){a.Log("url is wrong or server is down")}},disconnect:function(){if(1==this.ws.readyState){var a=new ArrayBuffer(2),b=new Int8Array(a);b[0]=q,b[1]=0,this.ws.send(a),this.ws.close()}},ws_onerror:function(b){a.Log("mqtt error: "+b.data,3)},ws_onopen:function(b){var d,e="testuser",f="passwd",g=this.m.clientId;a.Log("[MQTT CLIENTID] onopen: "+g);var h=new ArrayBuffer(16+g.length+2+e.length+2+f.length),j=new Int8Array(h);for(i=0,j[i++]=c,j[i++]=14+g.length+2+e.length+2+f.length,j[i++]=0,j[i++]=6,str="MQIsdp",d=0;d<str.length;d++)j[i++]=str.charCodeAt(d);for(j[i++]=3,j[i++]=194,j[i++]=0,j[i++]=60,j[i++]=0,j[i++]=g.length,d=0;d<g.length;d++)j[i++]=g.charCodeAt(d);for(j[i++]=0,j[i++]=e.length,d=0;d<e.length;d++)j[i++]=e.charCodeAt(d);for(j[i++]=0,j[i++]=f.length,d=0;d<f.length;d++)j[i++]=f.charCodeAt(d);for(this.send(h);this.m.out_queue.length>0;)this.send(this.m.out_queue.pop());setTimeout(function(a){a.mqtt_ping()},6e4,this.m)},ws_onclose:function(b){a.Log("mqtt close error: "+b.data,3),this.m?this.closeFlag?this.m.disconnect():this.m.onreconnect():this.onreconnect()},ws_onmessage:function(b){var c=new Int8Array(b.data);buffer=b.data;for(var i,k,m,o,r=0;c.length>0&&r<1e3;){if((240&c[0])==q){a.Log("recieve a disconnect info !",3),this.closeFlag=!0,this.m.ws.close();break}switch(r++,240&c[0]){case d:i=c[1];var s=c[2];this.m.onconnect&&this.m.onconnect(s),buffer=buffer.slice(i+2),c=new Int8Array(buffer);break;case e:k=1;var t=1;i=0;var u=0,v=(6&c[0])>>1,w=1&c[0];o=0;do u++,m=c[k++],i+=(127&m)*t,t*=128;while(0!==(128&m));var x=256*c[k++]+c[k++],y=buffer.slice(k,k+x);k+=x;var z=a.AB2S(y);if(v>0){o=256*c[k++]+c[k++];var A=1==v?f:g;this.m.send_cmd_with_mid(A,o)}var B=buffer.slice(k,i+u+1),C=a.AB2S(B);buffer=buffer.slice(i+1+u),c=new Int8Array(buffer),this.m.onmessage&&this.m.onmessage(z,C,v,w);break;case g:case h:k=1,o=0;do u++,m=c[k++],i+=(127&m)*t,t*=128;while(0!==(128&m));o=256*c[k++]+c[k++],this.m.send_cmd_with_mid(j,o);break;case f:case j:case l:case n:case p:i=c[1],buffer=buffer.slice(i+2),c=new Int8Array(buffer)}}},get_remaining_count:function(a){return a>=0&&a<128?1:a>=128&&a<16384?2:a>=16384&&a<2097152?3:a>=2097152&&a<268435456?4:-1},generate_mid:function(){var a=this.mid;return this.mid++,256==this.mid&&(this.mid=0),a},queue:function(a){this.out_queue.push(a)},send_cmd_with_mid:function(a,b){var c=new ArrayBuffer(4),d=new Int8Array(c);d[0]=a,d[1]=2,d[2]=b/256,d[3]=b%256,1==this.ws.readyState?this.ws.send(c):this.queue(c)},unsubscribe:function(a){var b=4+a.length,c=this.get_remaining_count(b),d=new ArrayBuffer(1+c+b),e=new Int8Array(d),f=0;e[f++]=2|m;do digit=Math.floor(b%128),b=Math.floor(b/128),b>0&&(digit=128|digit),e[f++]=digit;while(b>0);e[f++]=0,e[f++]=this.generate_mid(),e[f++]=0,e[f++]=a.length;for(var g=0;g<a.length;g++)e[f++]=a.charCodeAt(g);1==this.ws.readyState?this.ws.send(d):this.queue(d)},subscribe:function(a,b){if(0!==b)return 1;var c=4+a.length+1,d=this.get_remaining_count(c),e=new ArrayBuffer(1+d+c),f=new Int8Array(e),g=0;f[g++]=2|k;do digit=Math.floor(c%128),c=Math.floor(c/128),c>0&&(digit=128|digit),f[g++]=digit;while(c>0);f[g++]=0,f[g++]=this.generate_mid(),f[g++]=0,f[g++]=a.length;for(var h=0;h<a.length;h++)f[g++]=a.charCodeAt(h);f[g++]=b,1==this.ws.readyState?this.ws.send(e):this.queue(e)},publish:function(a,b,c,d){if(0!==c)return 1;var f,g=2+a.length+b.length,h=this.get_remaining_count(g),i=new ArrayBuffer(1+h+g),j=new Int8Array(i),k=0;d=d?1:0,j[k++]=e|c<<1|d;do digit=Math.floor(g%128),g=Math.floor(g/128),g>0&&(digit=128|digit),j[k++]=digit;while(g>0);for(j[k++]=0,j[k++]=a.length,f=0;f<a.length;f++)j[k++]=a.charCodeAt(f);for(f=0;f<b.length;f++)j[k++]=b.charCodeAt(f);1==this.ws.readyState?this.ws.send(i):this.queue(i)}}}(nTalk);